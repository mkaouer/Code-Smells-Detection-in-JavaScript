<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">

<title>C:/release/quickfix/src/C++/Session.cpp Source File</title>

<link href="quickfix.css" rel="stylesheet" type="text/css">

<table cellspacing="0" cellpadding="0" border="0">

  <tr>

   <td><img src="images/outsideTopLeft.gif"></td>

   <td width="100%" class="outsideTop">&nbsp;</td>

   <td><img src="images/outsideTopRight.gif"></td>

  </tr>

  <tr>

   <td class="outsideLeft">&nbsp;</td>

   <td>

	<img src="images/QuickFIX.jpg" align="middle" border=0>

	&nbsp;&nbsp;

	<a href="index.html">Index</a>&nbsp;

	<a href="files.html">Source Files</a>&nbsp;

	<a href="annotated.html">Annotated Class List</a>&nbsp;

	<a href="classes.html">Alphabetical Class List</a>&nbsp;

	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;

	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;

   </td>

   <td class="outsideRight">&nbsp;</td>

  </tr>

  <tr>

   <td><img src="images/outsideBottomLeft.gif"></td>

   <td width=100% class="outsideBottom">&nbsp;</td>

   <td><img src="images/outsideBottomRight.gif"></td>

  </tr>

</table>

</head><body bgcolor="#ffffff">

<!-- Generated by Doxygen 1.2.17 -->
<h1>C:/release/quickfix/src/C++/Session.cpp</h1><a href="_session_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* ====================================================================</span>
00002 <span class="comment">* The QuickFIX Software License, Version 1.0</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 2001 ThoughtWorks, Inc.  All rights</span>
00005 <span class="comment">* reserved.</span>
00006 <span class="comment">*</span>
00007 <span class="comment">* Redistribution and use in source and binary forms, with or without</span>
00008 <span class="comment">* modification, are permitted provided that the following conditions</span>
00009 <span class="comment">* are met:</span>
00010 <span class="comment">*</span>
00011 <span class="comment">* 1. Redistributions of source code must retain the above copyright</span>
00012 <span class="comment">*    notice, this list of conditions and the following disclaimer.</span>
00013 <span class="comment">*</span>
00014 <span class="comment">* 2. Redistributions in binary form must reproduce the above copyright</span>
00015 <span class="comment">*    notice, this list of conditions and the following disclaimer in</span>
00016 <span class="comment">*    the documentation and/or other materials provided with the</span>
00017 <span class="comment">*    distribution.</span>
00018 <span class="comment">*</span>
00019 <span class="comment">* 3. The end-user documentation included with the redistribution,</span>
00020 <span class="comment">*    if any, must include the following acknowledgment:</span>
00021 <span class="comment">*       "This product includes software developed by</span>
00022 <span class="comment">*        ThoughtWorks, Inc. (http://www.thoughtworks.com/)."</span>
00023 <span class="comment">*    Alternately, this acknowledgment may appear in the software itself,</span>
00024 <span class="comment">*    if and wherever such third-party acknowledgments normally appear.</span>
00025 <span class="comment">*</span>
00026 <span class="comment">* 4. The names "QuickFIX" and "ThoughtWorks, Inc." must</span>
00027 <span class="comment">*    not be used to endorse or promote products derived from this</span>
00028 <span class="comment">*    software without prior written permission. For written</span>
00029 <span class="comment">*    permission, please contact quickfix-users@lists.sourceforge.net.</span>
00030 <span class="comment">*</span>
00031 <span class="comment">* 5. Products derived from this software may not be called "QuickFIX",</span>
00032 <span class="comment">*    nor may "QuickFIX" appear in their name, without prior written</span>
00033 <span class="comment">*    permission of ThoughtWorks, Inc.</span>
00034 <span class="comment">*</span>
00035 <span class="comment">* THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span>
00036 <span class="comment">* WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
00037 <span class="comment">* OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
00038 <span class="comment">* DISCLAIMED.  IN NO EVENT SHALL THOUGHTWORKS INC OR</span>
00039 <span class="comment">* ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00040 <span class="comment">* SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00041 <span class="comment">* LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span>
00042 <span class="comment">* USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
00043 <span class="comment">* ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
00044 <span class="comment">* OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span>
00045 <span class="comment">* OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
00046 <span class="comment">* SUCH DAMAGE.</span>
00047 <span class="comment">* ====================================================================</span>
00048 <span class="comment">*/</span>
00049 
00050 <span class="preprocessor">#ifdef _MSC_VER</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#include "stdafx.h"</span>
00052 <span class="preprocessor">#else</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00054 <span class="preprocessor">#endif</span>
00055 <span class="preprocessor"></span>
00056 <span class="preprocessor">#include "<a class="code" href="_session_8h.html">Session.h</a>"</span>
00057 <span class="preprocessor">#include "<a class="code" href="_values_8h.html">Values.h</a>"</span>
00058 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00059 <span class="preprocessor">#include &lt;iostream&gt;</span>
00060 
00061 <span class="keyword">namespace </span>FIX
00062 {
<a name="l00063"></a><a class="code" href="class_f_i_x_1_1_session.html#r0">00063</a> Session::Sessions Session::s_sessions;
<a name="l00064"></a><a class="code" href="class_f_i_x_1_1_session.html#r1">00064</a> Session::Sessions Session::s_registered;
<a name="l00065"></a><a class="code" href="class_f_i_x_1_1_session.html#r2">00065</a> <a class="code" href="class_f_i_x_1_1_mutex.html">Mutex</a> Session::s_mutex;
00066 
<a name="l00067"></a><a class="code" href="class_f_i_x_1_1_session.html#a0">00067</a> Session::Session( <a class="code" href="class_f_i_x_1_1_application.html">Application</a>&amp; application,
00068                   <a class="code" href="class_f_i_x_1_1_message_store_factory.html">MessageStoreFactory</a>&amp; messageStoreFactory,
00069                   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID,
00070                   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>&amp; dataDictionary,
00071                   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; startTime,
00072                   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; endTime,
00073                   <span class="keywordtype">int</span> heartBtInt, <a class="code" href="class_f_i_x_1_1_log_factory.html">LogFactory</a>* pLogFactory )
00074     : m_application( application ),
00075     m_sessionID( sessionID ),
00076     m_startTime( startTime ), m_endTime( endTime ),
00077     m_checkLatency( true ), m_maxLatency( 120 ),
00078     m_resetOnLogout( false ), m_resetOnDisconnect( false ),
00079     m_dataDictionary( dataDictionary ),
00080     m_messageStoreFactory( messageStoreFactory ),
00081     m_pLogFactory( pLogFactory ),
00082     m_pResponder( 0 )
00083 {
00084   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a19">heartBtInt</a>( heartBtInt );
00085   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">initiate</a>( heartBtInt != 0 );
00086   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a15">store</a>( <a class="code" href="class_f_i_x_1_1_session.html#o10">m_messageStoreFactory</a>.<a class="code" href="class_f_i_x_1_1_message_store_factory.html#a1">create</a>( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> ) );
00087   <span class="keywordflow">if</span> ( m_pLogFactory )
00088     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a17">log</a>( <a class="code" href="class_f_i_x_1_1_session.html#o11">m_pLogFactory</a>-&gt;<a class="code" href="class_f_i_x_1_1_log_factory.html#a1">create</a>( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> ) );
00089 
00090 
00091   <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> creationTime = <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a45">getCreationTime</a>();
00092   <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00093 
00094   <span class="keywordflow">if</span> ( creationTime &gt; now ||
00095        !<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_startTime</a>, <a class="code" href="class_f_i_x_1_1_session.html#o3">m_endTime</a>, now ) ||
00096        !<a class="code" href="class_f_i_x_1_1_session.html#d12">isSameSession</a>( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_startTime</a>, <a class="code" href="class_f_i_x_1_1_session.html#o3">m_endTime</a>, now, creationTime ) )
00097   {
00098     <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>();
00099   }
00100 
00101   <a class="code" href="class_f_i_x_1_1_session.html#f0">addSession</a>( *<span class="keyword">this</span> );
00102   <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a1">onCreate</a>( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00103   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Created session"</span> );
00104 }
00105 
<a name="l00106"></a><a class="code" href="class_f_i_x_1_1_session.html#a1">00106</a> Session::~Session()
00107 {
00108   <a class="code" href="class_f_i_x_1_1_session.html#f1">removeSession</a>( *<span class="keyword">this</span> );
00109   <a class="code" href="class_f_i_x_1_1_session.html#o10">m_messageStoreFactory</a>.<a class="code" href="class_f_i_x_1_1_message_store_factory.html#a2">destroy</a>( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a15">store</a>() );
00110   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o11">m_pLogFactory</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a17">log</a>() )
00111     <a class="code" href="class_f_i_x_1_1_session.html#o11">m_pLogFactory</a>-&gt;<a class="code" href="class_f_i_x_1_1_log_factory.html#a2">destroy</a>( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a17">log</a>() );
00112 }
00113 
<a name="l00114"></a><a class="code" href="class_f_i_x_1_1_session.html#c4">00114</a> <span class="keywordtype">void</span> Session::fill( <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header )
00115 {
00116   <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00117   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a21">lastSentTime</a>( now );
00118   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>() );
00119   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a2">getSenderCompID</a>() );
00120   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getTargetCompID</a>() );
00121   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>( <a class="code" href="class_f_i_x_1_1_session.html#a20">getExpectedSenderNum</a>() ) );
00122   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a>() );
00123 }
00124 
<a name="l00125"></a><a class="code" href="class_f_i_x_1_1_session.html#a16">00125</a> <span class="keywordtype">void</span> Session::next()
00126 {
00127   <span class="keywordflow">try</span>
00128   {
00129     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00130     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c6">checkSessionTime</a>( now ) )
00131     { <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); <span class="keywordflow">return</span> ; }
00132 
00133     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>() )
00134     {
00135       <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a25">shouldSendLogon</a>() )
00136       {
00137         <a class="code" href="class_f_i_x_1_1_session.html#c26">generateLogon</a>();
00138         <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Initiated logon request"</span> );
00139       }
00140       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a26">alreadySentLogon</a>() &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a27">logonTimedOut</a>() )
00141       {
00142         <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Timed out waiting for logon response"</span> );
00143         <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00144       }
00145       <span class="keywordflow">return</span> ;
00146     }
00147 
00148     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a19">heartBtInt</a>() == 0 ) <span class="keywordflow">return</span> ;
00149 
00150     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a28">logoutTimedOut</a>() )
00151     {
00152       <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Timed out waiting for logout response"</span> );
00153       <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00154     }
00155 
00156     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a29">withinHeartBeat</a>() ) <span class="keywordflow">return</span> ;
00157 
00158     <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a30">timedOut</a>() )
00159     {
00160       <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Timed out waiting for heartbeat"</span> );
00161       <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00162     }
00163     <span class="keywordflow">else</span>
00164     {
00165       <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a32">needTestRequest</a>() )
00166       {
00167         <a class="code" href="class_f_i_x_1_1_session.html#c32">generateTestRequest</a>( <span class="stringliteral">"TEST"</span> );
00168         <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a13">testRequest</a>( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a13">testRequest</a>() + 1 );
00169         <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Sent test request TEST"</span> );
00170       }
00171       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a31">needHeartbeat</a>() )
00172       {
00173         <a class="code" href="class_f_i_x_1_1_session.html#c30">generateHeartbeat</a>();
00174       }
00175     }
00176   }
00177   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_i_o_exception.html">FIX::IOException</a>&amp; )
00178   {
00179     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Error Reading/Writing in MessageStore"</span> );
00180     <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00181   }
00182 }
00183 
<a name="l00184"></a><a class="code" href="class_f_i_x_1_1_session.html#c19">00184</a> <span class="keywordtype">void</span> Session::nextLogon( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; logon )
00185 {
00186   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a25">shouldSendLogon</a>() )
00187   {
00188     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Received logon response before sending request"</span> );
00189     <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00190     <span class="keywordflow">return</span> ;
00191   }
00192 
00193   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00194   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00195   logon.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( senderCompID );
00196   logon.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( targetCompID );
00197 
00198   <span class="keywordtype">bool</span> verified = <a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>( logon, <span class="keyword">false</span>, <span class="keyword">true</span> );
00199   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#c9">isCorrectCompID</a>( senderCompID, targetCompID ) )
00200     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>( <span class="keyword">true</span> );
00201   <span class="keywordflow">if</span> ( !verified ) <span class="keywordflow">return</span> ;
00202 
00203   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a9">initiate</a>() )
00204   {
00205     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a19">heartBtInt</a>() );
00206     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Received logon request"</span> );
00207     <a class="code" href="class_f_i_x_1_1_session.html#c26">generateLogon</a>( logon );
00208     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Responding to logon request"</span> );
00209   }
00210   <span class="keywordflow">else</span>
00211     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Received logon response"</span> );
00212 
00213   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00214   logon.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00215   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#c7">isTargetTooHigh</a>( msgSeqNum ) )
00216   {
00217     <a class="code" href="class_f_i_x_1_1_session.html#c16">doTargetTooHigh</a>( logon );
00218   }
00219   <span class="keywordflow">else</span>
00220   {
00221     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00222     <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00223   }
00224 
00225   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>() )
00226     <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a2">onLogon</a>( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00227 }
00228 
<a name="l00229"></a><a class="code" href="class_f_i_x_1_1_session.html#c20">00229</a> <span class="keywordtype">void</span> Session::nextHeartbeat( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; heartbeat )
00230 {
00231   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>( heartbeat ) ) <span class="keywordflow">return</span> ;
00232   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00233   <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00234 }
00235 
<a name="l00236"></a><a class="code" href="class_f_i_x_1_1_session.html#c21">00236</a> <span class="keywordtype">void</span> Session::nextTestRequest( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; testRequest )
00237 {
00238   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>( testRequest ) ) <span class="keywordflow">return</span> ;
00239   <a class="code" href="class_f_i_x_1_1_session.html#c30">generateHeartbeat</a>( testRequest );
00240   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00241   <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00242 }
00243 
<a name="l00244"></a><a class="code" href="class_f_i_x_1_1_session.html#c22">00244</a> <span class="keywordtype">void</span> Session::nextLogout( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; logout )
00245 {
00246   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>( logout, <span class="keyword">false</span>, <span class="keyword">false</span> ) ) <span class="keywordflow">return</span> ;
00247   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>() )
00248   {
00249     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Received logout request"</span> );
00250     <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00251     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Sending logout response"</span> );
00252   }
00253   <span class="keywordflow">else</span>
00254     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Received logout response"</span> );
00255 
00256   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00257   <span class="keywordflow">if</span> ( m_resetOnLogout ) <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>();
00258   <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00259 }
00260 
<a name="l00261"></a><a class="code" href="class_f_i_x_1_1_session.html#c23">00261</a> <span class="keywordtype">void</span> Session::nextReject( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject )
00262 {
00263   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>( reject ) ) <span class="keywordflow">return</span> ;
00264   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00265   <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00266 }
00267 
<a name="l00268"></a><a class="code" href="class_f_i_x_1_1_session.html#c24">00268</a> <span class="keywordtype">void</span> Session::nextSequenceReset( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; sequenceReset )
00269 {
00270   <span class="keywordtype">bool</span> isGapFill = <span class="keyword">false</span>;
00271   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a> gapFillFlag;
00272   <span class="keywordflow">if</span> ( sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a12">isSetField</a>( gapFillFlag ) )
00273   {
00274     sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( gapFillFlag );
00275     isGapFill = gapFillFlag;
00276   }
00277 
00278   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>( sequenceReset, isGapFill, isGapFill ) ) <span class="keywordflow">return</span> ;
00279 
00280   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a> newSeqNo;
00281   <span class="keywordflow">if</span> ( sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a12">isSetField</a>( newSeqNo ) )
00282   {
00283     sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( newSeqNo );
00284 
00285     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Received SequenceReset FROM: "</span> + IntConvertor::convert( <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() ) +
00286                      <span class="stringliteral">" TO: "</span> + IntConvertor::convert( newSeqNo ) );
00287 
00288     <span class="keywordflow">if</span> ( newSeqNo &gt; <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() )
00289       <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a42">setNextTargetMsgSeqNum</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>( newSeqNo ) );
00290     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( newSeqNo &lt; <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() )
00291       <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( sequenceReset, 5 );
00292   }
00293 }
00294 
<a name="l00295"></a><a class="code" href="class_f_i_x_1_1_session.html#c25">00295</a> <span class="keywordtype">void</span> Session::nextResendRequest( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; resendRequest )
00296 {
00297   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>( resendRequest, <span class="keyword">false</span>, <span class="keyword">false</span> ) ) <span class="keywordflow">return</span> ;
00298   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a11">BeginSeqNo</a> beginSeqNo;
00299   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a20">EndSeqNo</a> endSeqNo;
00300   resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( beginSeqNo );
00301   resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( endSeqNo );
00302   std::vector &lt; std::string &gt; messages;
00303 
00304   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Received ResendRequest FROM: "</span> + IntConvertor::convert( beginSeqNo ) +
00305                    <span class="stringliteral">" TO: "</span> + IntConvertor::convert( endSeqNo ) );
00306 
00307   std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>();
00308   <span class="keywordflow">if</span> ( beginString &gt;= FIX::BeginString_FIX42 &amp;&amp; endSeqNo == 0 ||
00309        beginString &lt;= FIX::BeginString_FIX42 &amp;&amp; endSeqNo == 999999 )
00310   { endSeqNo = <a class="code" href="class_f_i_x_1_1_session.html#a20">getExpectedSenderNum</a>() - 1; }
00311 
00312   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a37">get</a>( beginSeqNo, endSeqNo, messages );
00313 
00314   std::vector &lt; std::string &gt; ::iterator i;
00315   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00316   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00317   <span class="keywordtype">int</span> begin = 0;
00318 
00319   <span class="keywordflow">for</span> ( i = messages.begin(); i != messages.end(); ++i )
00320   {
00321     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> msg( *i, <a class="code" href="class_f_i_x_1_1_session.html#o9">m_dataDictionary</a> );
00322     msg.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00323     msg.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00324     <span class="keywordflow">if</span> ( Message::isAdminMsgType( msgType ) )
00325     {
00326       <span class="keywordflow">if</span> ( !begin ) begin = msgSeqNum;
00327     }
00328     <span class="keywordflow">else</span>
00329     {
00330       <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#c3">resend</a>( msg ) )
00331       {
00332         <span class="keywordflow">if</span> ( begin ) <a class="code" href="class_f_i_x_1_1_session.html#c29">generateSequenceReset</a>( begin, msgSeqNum );
00333         <a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>( msg.<a class="code" href="class_f_i_x_1_1_message.html#a6">toString</a>() );
00334         <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Resending Message: "</span> + IntConvertor::convert( msgSeqNum ) );
00335         begin = 0;
00336       }
00337       <span class="keywordflow">else</span>
00338       { <span class="keywordflow">if</span> ( !begin ) begin = msgSeqNum; }
00339     }
00340   }
00341   <span class="keywordflow">if</span> ( begin ) <a class="code" href="class_f_i_x_1_1_session.html#c29">generateSequenceReset</a>( begin, msgSeqNum + 1 );
00342 
00343   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00344 }
00345 
<a name="l00346"></a><a class="code" href="class_f_i_x_1_1_session.html#a15">00346</a> <span class="keywordtype">bool</span> Session::send( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00347 {
00348   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> l( <a class="code" href="class_f_i_x_1_1_session.html#o13">m_mutex</a> );
00349 
00350   message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a15">removeField</a>( FIELD::PossDupFlag );
00351   message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a15">removeField</a>( FIELD::OrigSendingTime );
00352   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( message );
00353 }
00354 
<a name="l00355"></a><a class="code" href="class_f_i_x_1_1_session.html#c2">00355</a> <span class="keywordtype">bool</span> Session::sendRaw( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keywordtype">int</span> num )
00356 {
00357   <span class="keywordflow">try</span>
00358   {
00359     <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;
00360     <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>();
00361     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00362     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00363 
00364     <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( header );
00365 
00366     <span class="keywordflow">if</span> ( num )
00367       header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>( num ) );
00368 
00369     <span class="keywordflow">if</span> ( Message::isAdminMsgType( msgType ) )
00370     {
00371       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a4">toAdmin</a>( message, <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00372       <span class="keywordflow">if</span> (
00373         msgType == <span class="stringliteral">"A"</span> || msgType == <span class="stringliteral">"5"</span>
00374         || msgType == <span class="stringliteral">"2"</span> || msgType == <span class="stringliteral">"4"</span>
00375         || <a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()
00376       )
00377         result = <a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>( message.<a class="code" href="class_f_i_x_1_1_message.html#a6">toString</a>() );
00378     }
00379     <span class="keywordflow">else</span>
00380     {
00381       <span class="keywordflow">try</span>
00382       {
00383         <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a5">toApp</a>( message, <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00384         <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>() ) result = <a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>( message.<a class="code" href="class_f_i_x_1_1_message.html#a6">toString</a>() );
00385       }
00386       <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_do_not_send.html">DoNotSend</a>&amp; ) {}}
00387 
00388     <span class="keywordflow">if</span> ( !num )
00389     {
00390       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00391       header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00392       <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a36">set</a>( msgSeqNum, message.<a class="code" href="class_f_i_x_1_1_message.html#a6">toString</a>() );
00393       <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a43">incrNextSenderMsgSeqNum</a>();
00394     }
00395     <span class="keywordflow">return</span> result;
00396   }
00397   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_i_o_exception.html">IOException</a>&amp; )
00398   { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00399 }
00400 
<a name="l00401"></a><a class="code" href="class_f_i_x_1_1_session.html#c1">00401</a> <span class="keywordtype">bool</span> Session::send( <span class="keyword">const</span> std::string string )
00402 {
00403   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#o12">m_pResponder</a> ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00404   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a48">onOutgoing</a>( string );
00405   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#o12">m_pResponder</a>-&gt;<a class="code" href="class_f_i_x_1_1_session_1_1_responder.html#a1">send</a>( string );
00406 }
00407 
<a name="l00408"></a><a class="code" href="class_f_i_x_1_1_session.html#a19">00408</a> <span class="keywordtype">void</span> Session::disconnect()
00409 {
00410   <span class="keywordflow">if</span> ( m_pResponder )
00411   {
00412     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Disconnecting"</span> );
00413     <a class="code" href="class_f_i_x_1_1_session.html#o12">m_pResponder</a>-&gt;<a class="code" href="class_f_i_x_1_1_session_1_1_responder.html#a2">disconnect</a>();
00414     <a class="code" href="class_f_i_x_1_1_session.html#o12">m_pResponder</a> = 0;
00415   }
00416 
00417   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>() || <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>() )
00418   {
00419     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>( <span class="keyword">false</span> );
00420     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>( <span class="keyword">false</span> );
00421     <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a3">onLogout</a>( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00422   }
00423 
00424   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>( <span class="keyword">false</span> );
00425   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a35">clearQueue</a>();
00426   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o7">m_resetOnDisconnect</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a1">connected</a>() )
00427   { <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a1">connected</a>( <span class="keyword">false</span> ); <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); }
00428 }
00429 
<a name="l00430"></a><a class="code" href="class_f_i_x_1_1_session.html#c3">00430</a> <span class="keywordtype">bool</span> Session::resend( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00431 {
00432   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00433   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00434   <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>();
00435   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( sendingTime );
00436   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00437 
00438   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>( sendingTime ) );
00439   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a>() );
00440   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>( <span class="keyword">true</span> ) );
00441 
00442   <span class="keywordflow">try</span>
00443   {
00444     <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a5">toApp</a>( message, <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00445     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00446   }
00447   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_do_not_send.html">DoNotSend</a>&amp; )
00448   { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00449 }
00450 
<a name="l00451"></a><a class="code" href="class_f_i_x_1_1_session.html#c26">00451</a> <span class="keywordtype">void</span> Session::generateLogon()
00452 {
00453   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logon;
00454   logon.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"A"</span> ) );
00455   logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a>( 0 ) );
00456   logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a19">heartBtInt</a>() );
00457   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( logon.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00458   <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00459   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a23">lastReceivedTime</a>( now );
00460   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a13">testRequest</a>( 0 );
00461   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>( <span class="keyword">true</span> );
00462   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( logon );
00463 }
00464 
<a name="l00465"></a><a class="code" href="class_f_i_x_1_1_session.html#c27">00465</a> <span class="keywordtype">void</span> Session::generateLogon( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; aLogon )
00466 {
00467   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logon;
00468   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a> encryptMethod;
00469   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a111">HeartBtInt</a> heartBtInt;
00470   logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a>( 0 ) );
00471   aLogon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( heartBtInt );
00472   logon.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"A"</span> ) );
00473   logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( heartBtInt );
00474   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( logon.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00475   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( logon );
00476   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a7">sentLogon</a>( <span class="keyword">true</span> );
00477 }
00478 
<a name="l00479"></a><a class="code" href="class_f_i_x_1_1_session.html#c28">00479</a> <span class="keywordtype">void</span> Session::generateResendRequest( <span class="keyword">const</span> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>&amp; msgSeqNum )
00480 {
00481   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> resendRequest;
00482   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a11">BeginSeqNo</a> beginSeqNo( ( <span class="keywordtype">int</span> ) <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() );
00483   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a20">EndSeqNo</a> endSeqNo( msgSeqNum - 1 );
00484   resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"2"</span> ) );
00485   resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( beginSeqNo );
00486   resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( endSeqNo );
00487   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00488   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( resendRequest );
00489   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Sent ResendRequest FROM: "</span> + IntConvertor::convert( beginSeqNo ) +
00490                    <span class="stringliteral">" TO: "</span> + IntConvertor::convert( endSeqNo ) );
00491 
00492 }
00493 
00494 <span class="keywordtype">void</span> Session::generateSequenceReset
<a name="l00495"></a><a class="code" href="class_f_i_x_1_1_session.html#c29">00495</a> ( <span class="keywordtype">int</span> beginSeqNo, <span class="keywordtype">int</span> endSeqNo )
00496 {
00497   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> sequenceReset;
00498   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a> newSeqNo( endSeqNo );
00499   sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"4"</span> ) );
00500   sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>( <span class="keyword">true</span> ) );
00501   sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>() );
00502   sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( newSeqNo );
00503   fill( sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00504   sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>( beginSeqNo ) );
00505   sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a>( <span class="keyword">true</span> ) );
00506   sendRaw( sequenceReset, beginSeqNo );
00507   m_state.onEvent( <span class="stringliteral">"Sent SequenceReset TO: "</span> + IntConvertor::convert( newSeqNo ) );
00508 }
00509 
<a name="l00510"></a><a class="code" href="class_f_i_x_1_1_session.html#c30">00510</a> <span class="keywordtype">void</span> Session::generateHeartbeat()
00511 {
00512   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> heartbeat;
00513   heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"0"</span> ) );
00514   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00515   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( heartbeat );
00516 }
00517 
<a name="l00518"></a><a class="code" href="class_f_i_x_1_1_session.html#c31">00518</a> <span class="keywordtype">void</span> Session::generateHeartbeat( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; testRequest )
00519 {
00520   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> heartbeat;
00521   heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"0"</span> ) );
00522   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00523   <span class="keywordflow">try</span>
00524   {
00525     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a115">TestReqID</a> testReqID;
00526     testRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( testReqID );
00527     heartbeat.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( testReqID );
00528   }
00529   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) {}
00530 
00531   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( heartbeat );
00532 }
00533 
<a name="l00534"></a><a class="code" href="class_f_i_x_1_1_session.html#c32">00534</a> <span class="keywordtype">void</span> Session::generateTestRequest( <span class="keyword">const</span> std::string&amp; id )
00535 {
00536   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> testRequest;
00537   testRequest.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"1"</span> ) );
00538   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( testRequest.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00539   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a115">TestReqID</a> testReqID( id );
00540   testRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( testReqID );
00541 
00542   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( testRequest );
00543 }
00544 
<a name="l00545"></a><a class="code" href="class_f_i_x_1_1_session.html#c33">00545</a> <span class="keywordtype">void</span> Session::generateReject( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keywordtype">int</span> err, <span class="keywordtype">int</span> field )
00546 {
00547   std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>();
00548 
00549   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00550   reject.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"3"</span> ) );
00551   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00552 
00553   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00554   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00555   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a> possDupFlag( <span class="keyword">false</span> );
00556 
00557   message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00558   message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00559   <span class="keywordflow">if</span> ( message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a12">isSetField</a>( possDupFlag ) )
00560     message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( possDupFlag );
00561 
00562   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>( msgSeqNum ) );
00563   <span class="keywordflow">if</span> ( beginString &gt;= FIX::BeginString_FIX42 )
00564   {
00565     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>( msgType ) );
00566     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a336">SessionRejectReason</a>( err ) );
00567   }
00568   <span class="keywordflow">if</span> ( msgType != <a class="code" href="namespace_f_i_x.html#a86">MsgType_Logon</a> &amp;&amp; msgType != <a class="code" href="namespace_f_i_x.html#a90">MsgType_SequenceReset</a>
00569        &amp;&amp; !possDupFlag )
00570   { <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>(); }
00571 
00572 
00573   <span class="keyword">const</span> std::string* reason = 0;
00574   <span class="keywordflow">switch</span> ( err )
00575   {
00576     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a609">SessionRejectReason_INVALID_TAG_NUMBER</a>:
00577     reason = &amp;<a class="code" href="namespace_f_i_x.html#a650">SessionRejectReason_INVALID_TAG_NUMBER_TEXT</a>;
00578     <span class="keywordflow">break</span>;
00579     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a610">SessionRejectReason_REQUIRED_TAG_MISSING</a>:
00580     reason = &amp;<a class="code" href="namespace_f_i_x.html#a651">SessionRejectReason_REQUIRED_TAG_MISSING_TEXT</a>;
00581     <span class="keywordflow">break</span>;
00582     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a611">SessionRejectReason_TAG_NOT_DEFINED_FOR_THIS_MESSAGE_TYPE</a>:
00583     reason = &amp;<a class="code" href="namespace_f_i_x.html#a652">SessionRejectReason_TAG_NOT_DEFINED_FOR_THIS_MESSAGE_TYPE_TEXT</a>;
00584     <span class="keywordflow">break</span>;
00585     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a613">SessionRejectReason_TAG_SPECIFIED_WITHOUT_A_VALUE</a>:
00586     reason = &amp;<a class="code" href="namespace_f_i_x.html#a654">SessionRejectReason_TAG_SPECIFIED_WITHOUT_A_VALUE_TEXT</a>;
00587     <span class="keywordflow">break</span>;
00588     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a614">SessionRejectReason_VALUE_IS_INCORRECT</a>:
00589     reason = &amp;<a class="code" href="namespace_f_i_x.html#a655">SessionRejectReason_VALUE_IS_INCORRECT_TEXT</a>;
00590     <span class="keywordflow">break</span>;
00591     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a615">SessionRejectReason_INCORRECT_DATA_FORMAT_FOR_VALUE</a>:
00592     reason = &amp;<a class="code" href="namespace_f_i_x.html#a656">SessionRejectReason_INCORRECT_DATA_FORMAT_FOR_VALUE_TEXT</a>;
00593     <span class="keywordflow">break</span>;
00594     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a618">SessionRejectReason_COMPID_PROBLEM</a>:
00595     reason = &amp;<a class="code" href="namespace_f_i_x.html#a659">SessionRejectReason_COMPID_PROBLEM_TEXT</a>;
00596     <span class="keywordflow">break</span>;
00597     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a619">SessionRejectReason_SENDINGTIME_ACCURACY_PROBLEM</a>:
00598     reason = &amp;<a class="code" href="namespace_f_i_x.html#a660">SessionRejectReason_SENDINGTIME_ACCURACY_PROBLEM_TEXT</a>;
00599     <span class="keywordflow">break</span>;
00600     <span class="keywordflow">case</span> <a class="code" href="namespace_f_i_x.html#a620">SessionRejectReason_E</a>:
00601     reason = &amp;<a class="code" href="namespace_f_i_x.html#a661">SessionRejectReason_E_TEXT</a>;
00602   };
00603 
00604   <span class="keywordflow">if</span> ( reason &amp;&amp; ( field || err == <a class="code" href="namespace_f_i_x.html#a609">SessionRejectReason_INVALID_TAG_NUMBER</a> ) )
00605   {
00606     <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, field, *reason );
00607     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString() + <span class="stringliteral">" Rejected: "</span>
00608                      + *reason + <span class="stringliteral">":"</span> + IntConvertor::convert( field ) );
00609   }
00610   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( reason )
00611   {
00612     <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, *reason );
00613     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString() + <span class="stringliteral">" Rejected: "</span> + *reason );
00614   }
00615   <span class="keywordflow">else</span>
00616     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Message "</span> + msgSeqNum.getString() + <span class="stringliteral">" Rejected"</span> );
00617 
00618   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( reject );
00619 }
00620 
<a name="l00621"></a><a class="code" href="class_f_i_x_1_1_session.html#c34">00621</a> <span class="keywordtype">void</span> Session::generateReject( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keyword">const</span> std::string&amp; str )
00622 {
00623   std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>();
00624 
00625   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00626   reject.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <span class="stringliteral">"3"</span> ) );
00627   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00628 
00629   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00630   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00631   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a> possDupFlag( <span class="keyword">false</span> );
00632 
00633   message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00634   message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00635   <span class="keywordflow">if</span> ( beginString &gt;= FIX::BeginString_FIX42 )
00636     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>( msgType ) );
00637   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>( msgSeqNum ) );
00638 
00639   <span class="keywordflow">if</span> ( msgType != <a class="code" href="namespace_f_i_x.html#a86">MsgType_Logon</a> &amp;&amp; msgType != <a class="code" href="namespace_f_i_x.html#a90">MsgType_SequenceReset</a>
00640        &amp;&amp; !possDupFlag )
00641   { <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>(); }
00642 
00643   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>( str ) );
00644   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( reject );
00645   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Rejecting Message: "</span> + IntConvertor::convert( msgSeqNum ) );
00646 }
00647 
<a name="l00648"></a><a class="code" href="class_f_i_x_1_1_session.html#c35">00648</a> <span class="keywordtype">void</span> Session::generateBusinessReject( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keywordtype">int</span> err )
00649 {
00650   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00651   reject.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <a class="code" href="namespace_f_i_x.html#a127">MsgType_BusinessMessageReject</a> ) );
00652   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00653   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00654   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00655   message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00656   message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00657   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>( msgType ) );
00658   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>( msgSeqNum ) );
00659   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a343">BusinessRejectReason</a>( err ) );
00660   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00661 
00662   <span class="keywordflow">if</span> ( err == 3 )
00663     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>( <span class="stringliteral">"Unsupported Message Type"</span> ) );
00664   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( reject );
00665   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Rejecting Message: "</span> + IntConvertor::convert( msgSeqNum ) );
00666 }
00667 
<a name="l00668"></a><a class="code" href="class_f_i_x_1_1_session.html#c36">00668</a> <span class="keywordtype">void</span> Session::generateLogout( <span class="keyword">const</span> std::string&amp; text )
00669 {
00670   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logout;
00671   logout.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>( <a class="code" href="namespace_f_i_x.html#a91">MsgType_Logout</a> ) );
00672   <a class="code" href="class_f_i_x_1_1_session.html#c4">fill</a>( logout.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>() );
00673   <span class="keywordflow">if</span> ( text.length() )
00674     logout.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>( text ) );
00675   <a class="code" href="class_f_i_x_1_1_session.html#c2">sendRaw</a>( logout );
00676   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>( <span class="keyword">true</span> );
00677 }
00678 
<a name="l00679"></a><a class="code" href="class_f_i_x_1_1_session.html#c37">00679</a> <span class="keywordtype">void</span> Session::populateRejectReason( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject, <span class="keywordtype">int</span> field,
00680                                     <span class="keyword">const</span> std::string&amp; text )
00681 {
00682   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>() &gt;= FIX::BeginString_FIX42 )
00683   {
00684     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>( field ) );
00685     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>( text ) );
00686   }
00687   <span class="keywordflow">else</span>
00688   {
00689     std::stringstream stream;
00690     stream &lt;&lt; text &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; field &lt;&lt; <span class="stringliteral">")"</span>;
00691     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>( stream.str() ) );
00692   }
00693 }
00694 
<a name="l00695"></a><a class="code" href="class_f_i_x_1_1_session.html#c38">00695</a> <span class="keywordtype">void</span> Session::populateRejectReason( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject, <span class="keyword">const</span> std::string&amp; text )
00696 {
00697   reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a5">setField</a>( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>( text ) );
00698 }
00699 
<a name="l00700"></a><a class="code" href="class_f_i_x_1_1_session.html#c39">00700</a> <span class="keywordtype">bool</span> Session::verify( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg, <span class="keywordtype">bool</span> checkTooHigh,
00701                       <span class="keywordtype">bool</span> checkTooLow )
00702 {
00703   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00704   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00705   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00706   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00707   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00708 
00709   <span class="keywordflow">try</span>
00710   {
00711     <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>();
00712     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( senderCompID );
00713     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( targetCompID );
00714     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( sendingTime );
00715     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00716     header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00717 
00718     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c10">validLogonState</a>( msgType ) )
00719       <span class="keywordflow">throw</span> std::exception();
00720     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c5">isGoodTime</a>( sendingTime ) )
00721       <a class="code" href="class_f_i_x_1_1_session.html#c12">doBadTime</a>( msg );
00722     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c9">isCorrectCompID</a>( senderCompID, targetCompID ) )
00723       <a class="code" href="class_f_i_x_1_1_session.html#c13">doBadCompID</a>( msg );
00724 
00725     <span class="keywordflow">if</span> ( checkTooHigh &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#c7">isTargetTooHigh</a>( msgSeqNum ) )
00726     {
00727       <a class="code" href="class_f_i_x_1_1_session.html#c16">doTargetTooHigh</a>( msg );
00728       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00729     }
00730     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( checkTooLow &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#c8">isTargetTooLow</a>( msgSeqNum ) )
00731     {
00732       <a class="code" href="class_f_i_x_1_1_session.html#c15">doTargetTooLow</a>( msg );
00733       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00734     }
00735 
00736     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00737     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a23">lastReceivedTime</a>( now );
00738     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a13">testRequest</a>( 0 );
00739   }
00740   <span class="keywordflow">catch</span> ( std::exception&amp; )
00741   { <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>(); <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00742 
00743   <a class="code" href="class_f_i_x_1_1_session.html#c11">fromCallback</a>( msgType, msg, <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00744   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00745 }
00746 
<a name="l00747"></a><a class="code" href="class_f_i_x_1_1_session.html#c42">00747</a> <span class="keywordtype">bool</span> Session::get( <span class="keywordtype">int</span> b, <span class="keywordtype">int</span> e, std::vector &lt; Message &gt; &amp;m )<span class="keyword"> const</span>
00748 <span class="keyword"></span>{
00749   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00750 }
00751 
<a name="l00752"></a><a class="code" href="class_f_i_x_1_1_session.html#c10">00752</a> <span class="keywordtype">bool</span> Session::validLogonState( <span class="keyword">const</span> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType )
00753 {
00754   <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a86">MsgType_Logon</a> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>()
00755        || msgType != <a class="code" href="namespace_f_i_x.html#a86">MsgType_Logon</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>() )
00756     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00757   <span class="keywordflow">if</span> ( msgType != <a class="code" href="namespace_f_i_x.html#a91">MsgType_Logout</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a5">sentLogout</a>() )
00758     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00759   <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a90">MsgType_SequenceReset</a> ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00760   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00761 }
00762 
<a name="l00763"></a><a class="code" href="class_f_i_x_1_1_session.html#c11">00763</a> <span class="keywordtype">void</span> Session::fromCallback( <span class="keyword">const</span> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg,
00764                             <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00765 {
00766   <span class="keywordflow">if</span> ( Message::isAdminMsgType( msgType ) )
00767     <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a6">fromAdmin</a>( msg, <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00768   <span class="keywordflow">else</span>
00769     <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a7">fromApp</a>( msg, <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
00770 }
00771 
<a name="l00772"></a><a class="code" href="class_f_i_x_1_1_session.html#c12">00772</a> <span class="keywordtype">void</span> Session::doBadTime( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
00773 {
00774   <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( msg, 10 );
00775   <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00776 }
00777 
<a name="l00778"></a><a class="code" href="class_f_i_x_1_1_session.html#c13">00778</a> <span class="keywordtype">void</span> Session::doBadCompID( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
00779 {
00780   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a3">receivedLogon</a>() )
00781     <span class="keywordflow">throw</span> std::exception();
00782   <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( msg, 9 );
00783   <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00784 }
00785 
<a name="l00786"></a><a class="code" href="class_f_i_x_1_1_session.html#c14">00786</a> <span class="keywordtype">bool</span> Session::doPossDup( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
00787 {
00788   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a> &amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>();
00789   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a> origSendingTime;
00790   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00791 
00792   <span class="keywordflow">if</span> ( !header.<a class="code" href="class_f_i_x_1_1_field_map.html#a12">isSetField</a>( origSendingTime ) )
00793   {
00794     <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( msg, 1, origSendingTime.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>() );
00795     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00796   }
00797   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( origSendingTime );
00798   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( sendingTime );
00799 
00800   <span class="keywordflow">if</span> ( origSendingTime &gt; sendingTime )
00801   {
00802     <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( msg, 10 );
00803     <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00804     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00805   }
00806   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00807 }
00808 
<a name="l00809"></a><a class="code" href="class_f_i_x_1_1_session.html#c15">00809</a> <span class="keywordtype">bool</span> Session::doTargetTooLow( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
00810 {
00811   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a> &amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>();
00812   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00813   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a> possDupFlag;
00814   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00815   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00816   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( possDupFlag );
00817   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00818 
00819   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"MsgSeqNum too low RECEIVED: "</span> + IntConvertor::convert( msgSeqNum ) +
00820                    <span class="stringliteral">" EXPECTED: "</span> + IntConvertor::convert( <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() ) +
00821                    <span class="stringliteral">" PosDup: "</span> + BoolConvertor::convert( possDupFlag ) );
00822 
00823   <span class="keywordflow">if</span> ( !possDupFlag )
00824     <span class="keywordflow">throw</span> std::exception();
00825   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#c14">doPossDup</a>( msg );
00826 }
00827 
<a name="l00828"></a><a class="code" href="class_f_i_x_1_1_session.html#c16">00828</a> <span class="keywordtype">void</span> Session::doTargetTooHigh( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg )
00829 {
00830   <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_field_map.html">Header</a> &amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>();
00831   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00832   header.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgSeqNum );
00833 
00834   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"MsgSeqNum too high RECEIVED: "</span> + IntConvertor::convert( msgSeqNum ) +
00835                    <span class="stringliteral">" EXPECTED: "</span> + IntConvertor::convert( <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() ) );
00836 
00837   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a33">queue</a>( msgSeqNum, msg );
00838   <a class="code" href="class_f_i_x_1_1_session.html#c28">generateResendRequest</a>( msgSeqNum );
00839 }
00840 
<a name="l00841"></a><a class="code" href="class_f_i_x_1_1_session.html#c17">00841</a> <span class="keywordtype">void</span> Session::nextQueued()
00842 {
00843   <span class="keywordflow">while</span> ( <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>( <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() ) ) {}}
00844 
<a name="l00845"></a><a class="code" href="class_f_i_x_1_1_session.html#c18">00845</a> <span class="keywordtype">bool</span> Session::nextQueued( <span class="keywordtype">int</span> num )
00846 {
00847   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> msg;
00848   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00849 
00850   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a34">retreive</a>( num, msg ) )
00851   {
00852     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Processing QUEUED message: "</span> + IntConvertor::convert( num ) );
00853     msg.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00854     <span class="keywordflow">if</span> ( msgType != <a class="code" href="namespace_f_i_x.html#a86">MsgType_Logon</a> )
00855       <a class="code" href="class_f_i_x_1_1_session.html#a16">next</a>( msg.<a class="code" href="class_f_i_x_1_1_message.html#a6">toString</a>() );
00856     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00857   }
00858   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00859 }
00860 
<a name="l00861"></a><a class="code" href="class_f_i_x_1_1_session.html#a17">00861</a> <span class="keywordtype">void</span> Session::next( <span class="keyword">const</span> std::string&amp; msg )
00862 {
00863   <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a47">onIncoming</a>( msg );
00864   <a class="code" href="class_f_i_x_1_1_session.html#a16">next</a>( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>( msg, <a class="code" href="class_f_i_x_1_1_session.html#o9">m_dataDictionary</a> ) );
00865 }
00866 
<a name="l00867"></a><a class="code" href="class_f_i_x_1_1_session.html#a18">00867</a> <span class="keywordtype">void</span> Session::next( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00868 {
00869   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00870   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00871   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00872   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00873 
00874   <span class="keywordflow">try</span>
00875   {
00876     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a1">connected</a>( <span class="keyword">true</span> );
00877 
00878     <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c6">checkSessionTime</a>( <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>() ) )
00879     { <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); <span class="keywordflow">return</span> ; }
00880 
00881     message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( msgType );
00882     message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( beginString );
00883     message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( senderCompID );
00884     message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( targetCompID );
00885 
00886     <span class="keywordflow">if</span> ( beginString != <a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>() )
00887       <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_unsupported_version.html">UnsupportedVersion</a>();
00888 
00889     <a class="code" href="class_f_i_x_1_1_session.html#o9">m_dataDictionary</a>.<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a34">validate</a>( message );
00890 
00891     <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a86">MsgType_Logon</a> )
00892       <a class="code" href="class_f_i_x_1_1_session.html#c19">nextLogon</a>( message );
00893     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a85">MsgType_Heartbeat</a> )
00894       <a class="code" href="class_f_i_x_1_1_session.html#c20">nextHeartbeat</a>( message );
00895     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a87">MsgType_TestRequest</a> )
00896       <a class="code" href="class_f_i_x_1_1_session.html#c21">nextTestRequest</a>( message );
00897     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a90">MsgType_SequenceReset</a> )
00898       <a class="code" href="class_f_i_x_1_1_session.html#c24">nextSequenceReset</a>( message );
00899     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a91">MsgType_Logout</a> )
00900       <a class="code" href="class_f_i_x_1_1_session.html#c22">nextLogout</a>( message );
00901     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a88">MsgType_ResendRequest</a> )
00902       <a class="code" href="class_f_i_x_1_1_session.html#c25">nextResendRequest</a>( message );
00903     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a89">MsgType_Reject</a> )
00904       <a class="code" href="class_f_i_x_1_1_session.html#c23">nextReject</a>( message );
00905     <span class="keywordflow">else</span>
00906     {
00907       <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>( message ) ) <span class="keywordflow">return</span> ;
00908       <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00909     }
00910     <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00911   }
00912 <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_message_parse_error.html">MessageParseError</a>&amp; ) {}
00913   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_required_tag_missing.html">RequiredTagMissing</a> &amp; e )
00914   { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, 1, e.field ); }
00915   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a> &amp; e )
00916   {
00917     <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, 1, e.field );
00918     <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a86">MsgType_Logon</a> )
00919       <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00920   }
00921   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_invalid_tag_number.html">InvalidTagNumber</a> &amp; e )
00922   { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, 0, e.field ); }
00923   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_no_tag_value.html">NoTagValue</a> &amp; e )
00924   { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, 4, e.field ); }
00925   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_tag_not_defined_for_message.html">TagNotDefinedForMessage</a> &amp; e )
00926   { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, 2, e.field ); }
00927   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_invalid_message_type.html">InvalidMessageType</a>&amp; )
00928   { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, 11 ); }
00929   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_unsupported_message_type.html">UnsupportedMessageType</a>&amp; )
00930   {
00931     <span class="keywordflow">if</span> ( beginString &gt;= FIX::BeginString_FIX42 )
00932       <a class="code" href="class_f_i_x_1_1_session.html#c35">generateBusinessReject</a>( message, 3 );
00933     <span class="keywordflow">else</span>
00934       <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, <span class="stringliteral">"Unsupported message type"</span> );
00935   }
00936   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_fields_out_of_order.html">FieldsOutOfOrder</a> &amp; e )
00937   { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, e.what() ); }
00938   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_incorrect_data_format.html">IncorrectDataFormat</a> &amp; e )
00939   { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, 6, e.field ); }
00940   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_incorrect_tag_value.html">IncorrectTagValue</a> &amp; e )
00941   { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>( message, 5, e.field ); }
00942   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>&amp; ) {}
00943   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_reject_logon.html">RejectLogon</a>&amp; )
00944   {
00945     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Logon rejected"</span> );
00946     <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00947   }
00948   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_unsupported_version.html">UnsupportedVersion</a>&amp; )
00949   {
00950     <span class="keywordflow">if</span> ( msgType == <a class="code" href="namespace_f_i_x.html#a91">MsgType_Logout</a> )
00951       <a class="code" href="class_f_i_x_1_1_session.html#c22">nextLogout</a>( message );
00952     <span class="keywordflow">else</span>
00953     {
00954       <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>( <span class="stringliteral">"Incorrect BeginString"</span> );
00955       <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a44">incrNextTargetMsgSeqNum</a>();
00956     }
00957   }
00958   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_i_o_exception.html">IOException</a>&amp; )
00959   {
00960     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_state</a>.<a class="code" href="class_f_i_x_1_1_session_state.html#a49">onEvent</a>( <span class="stringliteral">"Error Reading/Writing in MessageStore"</span> );
00961     <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00962   }
00963 }
00964 
<a name="l00965"></a><a class="code" href="class_f_i_x_1_1_session.html#d0">00965</a> <span class="keywordtype">bool</span> Session::sendToTarget( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00966 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp; )
00967 {
00968   <span class="keywordflow">try</span>
00969   {
00970     <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a> sessionID = message.getSessionID();
00971     <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* pSession = lookupSession( sessionID );
00972     <span class="keywordflow">if</span> ( !pSession ) <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>();
00973     <span class="keywordtype">bool</span> result = pSession-&gt;<a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>( message );
00974     <span class="keywordflow">return</span> result;
00975   }
00976 <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) { <span class="keywordflow">throw</span> <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>(); }
00977 }
00978 
<a name="l00979"></a><a class="code" href="class_f_i_x_1_1_session.html#d1">00979</a> <span class="keywordtype">bool</span> Session::sendToTarget( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00980 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp; )
00981 {
00982   message.setSessionID( sessionID );
00983   <span class="keywordflow">return</span> sendToTarget( message );
00984 }
00985 
00986 <span class="keywordtype">bool</span> Session::sendToTarget
<a name="l00987"></a><a class="code" href="class_f_i_x_1_1_session.html#d2">00987</a> ( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keyword">const</span> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>&amp; senderCompID,
00988   <span class="keyword">const</span> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>&amp; targetCompID )
00989 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp; )
00990 {
00991   message.getHeader().setField( senderCompID );
00992   message.getHeader().setField( targetCompID );
00993   <span class="keywordflow">return</span> sendToTarget( message );
00994 }
00995 
00996 <span class="keywordtype">bool</span> Session::sendToTarget
<a name="l00997"></a><a class="code" href="class_f_i_x_1_1_session.html#d3">00997</a> ( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <span class="keyword">const</span> std::string&amp; sender, <span class="keyword">const</span> std::string&amp; target )
00998 <span class="keywordflow">throw</span>( <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp; )
00999 { <span class="keywordflow">return</span> sendToTarget( message, <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>( sender ), <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>( target ) ); }
01000 
<a name="l01001"></a><a class="code" href="class_f_i_x_1_1_session.html#d4">01001</a> <span class="keywordtype">bool</span> Session::doesSessionExist( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01002 {
01003   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( <a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a> );
01004   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( sessionID );
01005 }
01006 
<a name="l01007"></a><a class="code" href="class_f_i_x_1_1_session.html#d5">01007</a> <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::lookupSession( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01008 {
01009   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( <a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a> );
01010   Sessions::iterator find = <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( sessionID );
01011   <span class="keywordflow">if</span> ( find != <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() )
01012     <span class="keywordflow">return</span> find-&gt;second;
01013   <span class="keywordflow">else</span>
01014     <span class="keywordflow">return</span> 0;
01015 }
01016 
<a name="l01017"></a><a class="code" href="class_f_i_x_1_1_session.html#d6">01017</a> <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::lookupSession( <span class="keyword">const</span> std::string&amp; string, <span class="keywordtype">bool</span> reverse )
01018 {
01019   <a class="code" href="class_f_i_x_1_1_message.html">Message</a> message;
01020   <span class="keywordflow">if</span> ( !message.<a class="code" href="class_f_i_x_1_1_message.html#a11">setStringHeader</a>( string ) )
01021     <span class="keywordflow">return</span> 0;
01022 
01023   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
01024   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
01025   <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
01026   <span class="keywordflow">try</span>
01027   {
01028     message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( beginString );
01029     message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( senderCompID );
01030     message.<a class="code" href="class_f_i_x_1_1_message.html#a12">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>( targetCompID );
01031   }
01032   <span class="keywordflow">catch</span> ( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) { <span class="keywordflow">return</span> 0; }
01033 
01034   <span class="keywordflow">if</span> ( reverse )
01035   {
01036     <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#d5">lookupSession</a>( <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>( beginString, <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>( targetCompID ),
01037                                      <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>( senderCompID ) ) );
01038   }
01039   <span class="keywordflow">else</span>
01040   {
01041     <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#d5">lookupSession</a>( <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>( beginString, senderCompID, targetCompID ) );
01042   }
01043 }
01044 
<a name="l01045"></a><a class="code" href="class_f_i_x_1_1_session.html#d7">01045</a> <span class="keywordtype">bool</span> Session::isSessionRegistered( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01046 {
01047   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( <a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a> );
01048   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.find( sessionID );
01049 }
01050 
<a name="l01051"></a><a class="code" href="class_f_i_x_1_1_session.html#d8">01051</a> <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::registerSession( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01052 {
01053   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( <a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a> );
01054   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* pSession = <a class="code" href="class_f_i_x_1_1_session.html#d5">lookupSession</a>( sessionID );
01055   <span class="keywordflow">if</span> ( pSession == 0 ) <span class="keywordflow">return</span> 0;
01056   <span class="keywordflow">if</span> ( <a class="code" href="class_f_i_x_1_1_session.html#d7">isSessionRegistered</a>( sessionID ) ) <span class="keywordflow">return</span> 0;
01057   <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>[ sessionID ] = pSession;
01058   <span class="keywordflow">return</span> pSession;
01059 }
01060 
<a name="l01061"></a><a class="code" href="class_f_i_x_1_1_session.html#d9">01061</a> <span class="keywordtype">void</span> Session::unregisterSession( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
01062 {
01063   <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.erase( sessionID );
01064 }
01065 
<a name="l01066"></a><a class="code" href="class_f_i_x_1_1_session.html#d10">01066</a> <span class="keywordtype">int</span> Session::numSessions()
01067 {
01068   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( <a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a> );
01069   <span class="keywordflow">return</span> <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.size();
01070 }
01071 
<a name="l01072"></a><a class="code" href="class_f_i_x_1_1_session.html#f0">01072</a> <span class="keywordtype">bool</span> Session::addSession( <a class="code" href="class_f_i_x_1_1_session.html">Session</a>&amp; s )
01073 {
01074   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( <a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a> );
01075   Sessions::iterator it = <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( s.<a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
01076   <span class="keywordflow">if</span> ( it == <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() )
01077   {
01078     <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>[ s.<a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> ] = &amp;s;
01079     <span class="keywordflow">return</span> <span class="keyword">true</span>;
01080   }
01081   <span class="keywordflow">else</span>
01082     <span class="keywordflow">return</span> <span class="keyword">false</span>;
01083 }
01084 
<a name="l01085"></a><a class="code" href="class_f_i_x_1_1_session.html#f1">01085</a> <span class="keywordtype">void</span> Session::removeSession( <a class="code" href="class_f_i_x_1_1_session.html">Session</a>&amp; s )
01086 {
01087   <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker( <a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a> );
01088   <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
01089   <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#o1">m_sessionID</a> );
01090 }
01091 
<a name="l01092"></a><a class="code" href="class_f_i_x_1_1_session.html#d11">01092</a> <span class="keywordtype">bool</span> Session::isSessionTime( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; start, <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; end,
01093                              <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time )
01094 {
01095   <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a> timeOnly( time );
01096 
01097   <span class="keywordflow">if</span> ( start &lt; end )
01098     <span class="keywordflow">return</span> ( timeOnly &gt;= start &amp;&amp; timeOnly &lt;= end );
01099   <span class="keywordflow">else</span>
01100     <span class="keywordflow">return</span> ( timeOnly &gt;= start || timeOnly &lt;= end );
01101 }
01102 
<a name="l01103"></a><a class="code" href="class_f_i_x_1_1_session.html#d12">01103</a> <span class="keywordtype">bool</span> Session::isSameSession( <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; start,
01104                              <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; end,
01105                              <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time1,
01106                              <span class="keyword">const</span> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time2 )
01107 {
01108   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>( start, end, time1 ) ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
01109   <span class="keywordflow">if</span> ( !<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>( start, end, time2 ) ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
01110 
01111   <span class="keywordflow">if</span> ( time1 == time2 ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
01112 
01113   <a class="code" href="class_f_i_x_1_1_utc_date.html">UtcDate</a> time1Date( time1 );
01114   <a class="code" href="class_f_i_x_1_1_utc_date.html">UtcDate</a> time2Date( time2 );
01115 
01116   <span class="keywordflow">if</span> ( start &lt; end )
01117     <span class="keywordflow">return</span> time1Date == time2Date;
01118   <span class="keywordflow">else</span>
01119     <span class="keywordflow">return</span> abs( time1Date - time2Date ) &lt;= 1;
01120 
01121   <span class="keywordflow">return</span> <span class="keyword">false</span>;
01122 }
01123 }
</pre></div><hr><address><small>

Generated on Wed Oct 30 21:17:55 2002 for QuickFIX by <a href="http://www.doxygen.org/index.html">

<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>

</a> 1.2.17 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,

 &copy;&nbsp;1997-2001</small></address>

</body>

</html>

