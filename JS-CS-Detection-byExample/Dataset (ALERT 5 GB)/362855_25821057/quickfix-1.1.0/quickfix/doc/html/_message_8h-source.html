<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>D:/release/quickfix/src/C++/Message.h Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.16 -->
<h1>D:/release/quickfix/src/C++/Message.h</h1><a href="_message_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* -*- C++ -*- */</font>
00002 <font class="comment">/* ====================================================================</font>
00003 <font class="comment"> * The QuickFIX Software License, Version 1.0</font>
00004 <font class="comment"> *</font>
00005 <font class="comment"> * Copyright (c) 2001 ThoughtWorks, Inc.  All rights</font>
00006 <font class="comment"> * reserved.</font>
00007 <font class="comment"> *</font>
00008 <font class="comment"> * Redistribution and use in source and binary forms, with or without</font>
00009 <font class="comment"> * modification, are permitted provided that the following conditions</font>
00010 <font class="comment"> * are met:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> * 1. Redistributions of source code must retain the above copyright</font>
00013 <font class="comment"> *    notice, this list of conditions and the following disclaimer.</font>
00014 <font class="comment"> *</font>
00015 <font class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</font>
00016 <font class="comment"> *    notice, this list of conditions and the following disclaimer in</font>
00017 <font class="comment"> *    the documentation and/or other materials provided with the</font>
00018 <font class="comment"> *    distribution.</font>
00019 <font class="comment"> *</font>
00020 <font class="comment"> * 3. The end-user documentation included with the redistribution,</font>
00021 <font class="comment"> *    if any, must include the following acknowledgment:</font>
00022 <font class="comment"> *       "This product includes software developed by</font>
00023 <font class="comment"> *        ThoughtWorks, Inc. (http://www.thoughtworks.com/)."</font>
00024 <font class="comment"> *    Alternately, this acknowledgment may appear in the software itself,</font>
00025 <font class="comment"> *    if and wherever such third-party acknowledgments normally appear.</font>
00026 <font class="comment"> *</font>
00027 <font class="comment"> * 4. The names "QuickFIX" and "ThoughtWorks, Inc." must</font>
00028 <font class="comment"> *    not be used to endorse or promote products derived from this</font>
00029 <font class="comment"> *    software without prior written permission. For written</font>
00030 <font class="comment"> *    permission, please contact quickfix-users@lists.sourceforge.net.</font>
00031 <font class="comment"> *</font>
00032 <font class="comment"> * 5. Products derived from this software may not be called "QuickFIX",</font>
00033 <font class="comment"> *    nor may "QuickFIX" appear in their name, without prior written</font>
00034 <font class="comment"> *    permission of ThoughtWorks, Inc.</font>
00035 <font class="comment"> *</font>
00036 <font class="comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</font>
00037 <font class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</font>
00038 <font class="comment"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</font>
00039 <font class="comment"> * DISCLAIMED.  IN NO EVENT SHALL THOUGHTWORKS INC OR</font>
00040 <font class="comment"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</font>
00041 <font class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</font>
00042 <font class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</font>
00043 <font class="comment"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</font>
00044 <font class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</font>
00045 <font class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</font>
00046 <font class="comment"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</font>
00047 <font class="comment"> * SUCH DAMAGE.</font>
00048 <font class="comment"> * ====================================================================</font>
00049 <font class="comment"> */</font>
00050 
00051 <font class="preprocessor">#ifndef FIX_MESSAGE</font>
00052 <font class="preprocessor"></font><font class="preprocessor">#define FIX_MESSAGE</font>
00053 <font class="preprocessor"></font>
00054 <font class="preprocessor">#ifdef _MSC_VER</font>
00055 <font class="preprocessor"></font><font class="preprocessor">#pragma warning( disable: 4786 )</font>
00056 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00057 <font class="preprocessor"></font>
00058 <font class="preprocessor">#include "<a class="code" href="_field_map_8h.html">FieldMap.h</a>"</font>
00059 <font class="preprocessor">#include "<a class="code" href="_fields_8h.html">Fields.h</a>"</font>
00060 <font class="preprocessor">#include "<a class="code" href="_group_8h.html">Group.h</a>"</font>
00061 <font class="preprocessor">#include "<a class="code" href="_session_i_d_8h.html">SessionID.h</a>"</font>
00062 <font class="preprocessor">#include "<a class="code" href="_data_dictionary_8h.html">DataDictionary.h</a>"</font>
00063 <font class="preprocessor">#include &lt;vector&gt;</font>
00064 
00065 <font class="keyword">namespace </font>FIX
00066 {
<a name="l00067"></a><a class="code" href="namespace_f_i_x.html#a54">00067</a>   <font class="keyword">typedef</font> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a> <a class="code" href="namespace_f_i_x.html#a54">Header</a>;
<a name="l00068"></a><a class="code" href="namespace_f_i_x.html#a55">00068</a>   <font class="keyword">typedef</font> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a> <a class="code" href="namespace_f_i_x.html#a55">Trailer</a>;
00069 
<a name="l00070"></a><a class="code" href="namespace_f_i_x.html#a56">00070</a>   <font class="keyword">static</font> FIELD::Field <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a56">headerOrder</a>[] = {
00071     FIELD::BeginString,
00072     FIELD::BodyLength,
00073     FIELD::MsgType
00074   };
00075 
<a name="l00085"></a><a class="code" href="class_f_i_x_1_1_message.html">00085</a>   <font class="keyword">class </font><a class="code" href="class_f_i_x_1_1_message.html">Message</a> : <font class="keyword">public</font> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>
00086   {
<a name="l00087"></a><a class="code" href="class_f_i_x_1_1_message.html#l0">00087</a>     <font class="keyword">friend</font> <font class="keyword">class </font><a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>;
<a name="l00088"></a><a class="code" href="class_f_i_x_1_1_message.html#l1">00088</a>     <font class="keyword">friend</font> <font class="keyword">class </font><a class="code" href="class_f_i_x_1_1_session.html">Session</a>;
00089 
<a name="l00090"></a><a class="code" href="class_f_i_x_1_1_message.html#u3">00090</a>     <font class="keyword">enum</font> <a class="code" href="class_f_i_x_1_1_message.html#u3">field_type</a> { <a class="code" href="class_f_i_x_1_1_message.html#u3u0">header</a>, <a class="code" href="class_f_i_x_1_1_message.html#u3u1">body</a>, <a class="code" href="class_f_i_x_1_1_message.html#u3u2">trailer</a> };
00091 
00092   <font class="keyword">public</font>:
<a name="l00093"></a><a class="code" href="class_f_i_x_1_1_message.html#a0">00093</a>     <a class="code" href="class_f_i_x_1_1_message.html#a0">Message</a>()
00094       : <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>::<a class="code" href="class_f_i_x_1_1_message.html#u3u0">header</a>)),
00095         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>::<a class="code" href="class_f_i_x_1_1_message.html#u3u2">trailer</a>)),
00096         <a class="code" href="class_f_i_x_1_1_message.html#n2">m_validStructure</a>(true) {}
00097 
<a name="l00099"></a><a class="code" href="class_f_i_x_1_1_message.html#a1">00099</a>     <a class="code" href="class_f_i_x_1_1_message.html#a0">Message</a>( <font class="keyword">const</font> std::string&amp; string ) <font class="keywordflow">throw</font>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>&amp; )
00100       : <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>(message_order::header)),
00101         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>(message_order::trailer)),
00102         <a class="code" href="class_f_i_x_1_1_message.html#n2">m_validStructure</a>(<font class="keyword">true</font>)
00103     {
00104       <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_message.html#a6">setString</a>(string))
00105         <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>();
00106     }
00107 
<a name="l00109"></a><a class="code" href="class_f_i_x_1_1_message.html#a2">00109</a>     <a class="code" href="class_f_i_x_1_1_message.html#a0">Message</a>( <font class="keyword">const</font> std::string&amp; string, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>&amp; dataDictionary ) 
00110       <font class="keywordflow">throw</font>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>&amp; )
00111       : <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>(message_order::header)),
00112         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>(message_order::trailer)),
00113         <a class="code" href="class_f_i_x_1_1_message.html#n2">m_validStructure</a>(<font class="keyword">true</font>)
00114     {
00115       <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_message.html#a6">setString</a>(string, &amp;dataDictionary))
00116         <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>();
00117     }
00118 
<a name="l00119"></a><a class="code" href="class_f_i_x_1_1_message.html#a3">00119</a>     <font class="keywordtype">void</font> <a class="code" href="class_f_i_x_1_1_message.html#a3">addGroup</a>( <a class="code" href="class_f_i_x_1_1_group.html">Group</a>&amp; group )
00120     {
00121       FieldMap::addGroup(group.<a class="code" href="class_f_i_x_1_1_group.html#a2">field</a>(), group);
00122     }
00123 
<a name="l00124"></a><a class="code" href="class_f_i_x_1_1_message.html#a4">00124</a>     <a class="code" href="class_f_i_x_1_1_group.html">Group</a>&amp; <a class="code" href="class_f_i_x_1_1_message.html#a4">getGroup</a>( <font class="keywordtype">unsigned</font> num, <a class="code" href="class_f_i_x_1_1_group.html">Group</a>&amp; group ) <font class="keyword">const</font> <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp;)
00125     {
00126       group.<a class="code" href="class_f_i_x_1_1_field_map.html#a15">clear</a>();
00127       <font class="keywordflow">return</font> static_cast&lt;Group&amp;&gt;(FieldMap::getGroup(num, group.field(), group));
00128     }
00129 
00130   <font class="keyword">protected</font>:
00131     <font class="comment">// Constructor for derived classes</font>
<a name="l00132"></a><a class="code" href="class_f_i_x_1_1_message.html#b0">00132</a>     <a class="code" href="class_f_i_x_1_1_message.html#a0">Message</a>( <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a>&amp; beginString, <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType )
00133       : <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>::<a class="code" href="class_f_i_x_1_1_message.html#u3u0">header</a>)),
00134         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>(<a class="code" href="struct_f_i_x_1_1message__order.html">message_order</a>::<a class="code" href="class_f_i_x_1_1_message.html#u3u2">trailer</a>)),
00135         <a class="code" href="class_f_i_x_1_1_message.html#n2">m_validStructure</a>(true)
00136     {
00137       <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(beginString);
00138       <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(msgType);
00139     }
00140 
00141   <font class="keyword">public</font>:
<a name="l00143"></a><a class="code" href="class_f_i_x_1_1_message.html#a5">00143</a>     std::string <a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>()<font class="keyword"> const</font>
00144 <font class="keyword">    </font>{
00145       <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>( <a class="code" href="class_f_i_x_1_1_message.html#a14">bodyLength</a>() );
00146       <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>( <a class="code" href="class_f_i_x_1_1_message.html#a15">checkSum</a>() );
00147 
00148       <font class="keywordflow">return</font>
00149         <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a16">calculateString</a>() +
00150         FieldMap::calculateString() +
00151         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a16">calculateString</a>();
00152     }
00153 
<a name="l00160"></a><a class="code" href="class_f_i_x_1_1_message.html#a6">00160</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#a6">setString</a>( <font class="keyword">const</font> std::string&amp; string, 
00161                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>* pDataDictionary = 0 )
00162     {
00163       <a class="code" href="class_f_i_x_1_1_message.html#c1">clear</a>();
00164 
00165       std::string::size_type pos = 0;
00166       <font class="keywordtype">int</font> count = 0;
00167       std::string msg;
00168 
00169       <font class="keyword">static</font> FIELD::Field <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a56">headerOrder</a>[] = {
00170         FIELD::BeginString,
00171         FIELD::BodyLength,
00172         FIELD::MsgType
00173       };
00174 
00175       <a class="code" href="class_f_i_x_1_1_message.html#u3">field_type</a> type = <a class="code" href="class_f_i_x_1_1_message.html#u3u0">header</a>;
00176 
00177       <font class="keywordflow">while</font>(pos &lt; string.size())
00178         {
00179           <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a> field = <a class="code" href="class_f_i_x_1_1_message.html#c0">extractField</a>(string,pos);
00180           <font class="keywordflow">if</font> (count &lt; 3 &amp;&amp; <a class="code" href="namespace_f_i_x.html#a56">headerOrder</a>[count++] != field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>())
00181             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00182 
00183           <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>(field) )
00184           { 
00185             <font class="keywordflow">if</font>(type != <a class="code" href="class_f_i_x_1_1_message.html#u3u0">header</a>) <a class="code" href="class_f_i_x_1_1_message.html#n2">m_validStructure</a> = <font class="keyword">false</font>;
00186             <font class="keywordflow">if</font>(field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>() == FIELD::MsgType)
00187               msg = field.<a class="code" href="class_f_i_x_1_1_field_base.html#a2">getString</a>();
00188             <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(field); 
00189           }
00190           <font class="keywordflow">else</font> <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_message.html#d3">isTrailerField</a>(field) )
00191           { 
00192             type = <a class="code" href="class_f_i_x_1_1_message.html#u3u2">trailer</a>;
00193             <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(field); 
00194           }
00195           <font class="keywordflow">else</font>    
00196           { 
00197             <font class="keywordflow">if</font>(type == <a class="code" href="class_f_i_x_1_1_message.html#u3u2">trailer</a>) <a class="code" href="class_f_i_x_1_1_message.html#n2">m_validStructure</a> = <font class="keyword">false</font>;
00198             type = <a class="code" href="class_f_i_x_1_1_message.html#u3u1">body</a>;
00199             <a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(field); 
00200             <font class="keywordflow">if</font>(pDataDictionary)
00201             {
00202               <a class="code" href="class_f_i_x_1_1_message.html#a7">setGroup</a>(msg, field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>(), string, pos, *<font class="keyword">this</font>, 
00203                        *pDataDictionary); 
00204             }
00205           }
00206         }
00207       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#c2">validate</a>();
00208     }
00209 
<a name="l00210"></a><a class="code" href="class_f_i_x_1_1_message.html#a7">00210</a>     <font class="keywordtype">void</font> <a class="code" href="class_f_i_x_1_1_message.html#a7">setGroup</a>(<font class="keyword">const</font> std::string&amp; msg, <font class="keywordtype">int</font> group, <font class="keyword">const</font> std::string&amp; string, 
00211                   std::string::size_type&amp; pos, <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a>&amp; map,
00212                   <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>&amp; dataDictionary)
00213     {
00214       <font class="keywordtype">int</font> delim;
00215       <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>* pDD = 0;
00216       <font class="keywordflow">if</font>(!dataDictionary.<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a24">getGroup</a>(msg, group, delim, pDD)) <font class="keywordflow">return</font>;
00217       <a class="code" href="class_f_i_x_1_1_group.html">Group</a>* pGroup = 0;
00218       
00219       <font class="keywordflow">while</font>(pos &lt; string.size())
00220       {
00221         std::string::size_type oldPos = pos;
00222         <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a> field = <a class="code" href="class_f_i_x_1_1_message.html#c0">extractField</a>(string,pos);
00223         <font class="keywordflow">if</font>(field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>() == delim)
00224         {
00225           <font class="keywordflow">if</font>(pGroup) { map.<a class="code" href="class_f_i_x_1_1_field_map.html#a10">addGroup</a>(group, *pGroup); <font class="keyword">delete</font> pGroup; }
00226           pGroup = <font class="keyword">new</font> <a class="code" href="class_f_i_x_1_1_group.html">Group</a>(field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>(), delim);
00227         }
00228         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(!pDD-&gt;<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a10">isField</a>(field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>()))
00229         {
00230           map.<a class="code" href="class_f_i_x_1_1_field_map.html#a10">addGroup</a>(group, *pGroup); <font class="keyword">delete</font> pGroup;
00231           pos = oldPos;
00232           <font class="keywordflow">return</font>;
00233         }
00234         
00235         <font class="keywordflow">if</font>(!pGroup) <font class="keywordflow">return</font>;
00236         pGroup-&gt;<a class="code" href="class_f_i_x_1_1_field_map.html#a6">addField</a>(field);
00237         <a class="code" href="class_f_i_x_1_1_message.html#a7">setGroup</a>(msg, field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>(), string, pos, *pGroup, *pDD);
00238       }
00239     }
00240 
<a name="l00246"></a><a class="code" href="class_f_i_x_1_1_message.html#a8">00246</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#a8">setStringHeader</a>( <font class="keyword">const</font> std::string&amp; string )
00247     {
00248       <a class="code" href="class_f_i_x_1_1_message.html#c1">clear</a>();
00249 
00250       std::string::size_type pos = 0;
00251       <font class="keywordtype">int</font> count = 0;
00252 
00253       <font class="keywordflow">while</font>(pos &lt; string.size())
00254         {
00255           <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a> field = <a class="code" href="class_f_i_x_1_1_message.html#c0">extractField</a>(string,pos);
00256           <font class="keywordflow">if</font> (count &lt; 3 &amp;&amp; <a class="code" href="namespace_f_i_x.html#a56">headerOrder</a>[count++] != field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>())
00257             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00258 
00259           <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>(field) )
00260             <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(field);
00261           <font class="keywordflow">else</font> <font class="keywordflow">break</font>;
00262         }
00263       <font class="keywordflow">return</font> <font class="keyword">true</font>;
00264     }
00265 
<a name="l00267"></a><a class="code" href="class_f_i_x_1_1_message.html#a9">00267</a>     <font class="keyword">const</font> Header&amp; <a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>; }
<a name="l00269"></a><a class="code" href="class_f_i_x_1_1_message.html#a10">00269</a>     Header&amp; <a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() { <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>; }
<a name="l00271"></a><a class="code" href="class_f_i_x_1_1_message.html#a11">00271</a>     <font class="keyword">const</font> Header&amp; <a class="code" href="class_f_i_x_1_1_message.html#a11">getTrailer</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>; }
<a name="l00273"></a><a class="code" href="class_f_i_x_1_1_message.html#a12">00273</a>     Header&amp; <a class="code" href="class_f_i_x_1_1_message.html#a11">getTrailer</a>() { <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>; }
00274 
<a name="l00275"></a><a class="code" href="class_f_i_x_1_1_message.html#a13">00275</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#a13">hasValidStructure</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n2">m_validStructure</a>; }
00276 
<a name="l00277"></a><a class="code" href="class_f_i_x_1_1_message.html#a14">00277</a>     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a13">BodyLength</a> <a class="code" href="class_f_i_x_1_1_message.html#a14">bodyLength</a>()<font class="keyword"> const</font>
00278 <font class="keyword">    </font>{
00279       <font class="keywordflow">return</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a13">BodyLength</a>
00280         (<a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a17">calculateLength</a>()
00281          + <a class="code" href="class_f_i_x_1_1_field_map.html#a17">calculateLength</a>()
00282          + <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a17">calculateLength</a>());
00283     }
00284 
<a name="l00285"></a><a class="code" href="class_f_i_x_1_1_message.html#a15">00285</a>     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a14">CheckSum</a> <a class="code" href="class_f_i_x_1_1_message.html#a15">checkSum</a>()<font class="keyword"> const</font>
00286 <font class="keyword">    </font>{
00287       <font class="keywordflow">return</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a14">CheckSum</a>
00288         ((<a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a18">calculateTotal</a>()
00289           + <a class="code" href="class_f_i_x_1_1_field_map.html#a18">calculateTotal</a>()
00290           + <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a18">calculateTotal</a>()) % 256);
00291     }
00292 
<a name="l00293"></a><a class="code" href="class_f_i_x_1_1_message.html#d0">00293</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d0">isAdminMsgType</a>( <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType )
00294     {
00295       <font class="keywordflow">if</font>( !msgType.getValue().length() ) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00296       <font class="keywordflow">return</font> strchr
00297         (<font class="stringliteral">"0A12345"</font>,
00298          msgType.getValue().c_str()[0]) != 0;
00299     }
00300 
<a name="l00301"></a><a class="code" href="class_f_i_x_1_1_message.html#d1">00301</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>( <font class="keywordtype">int</font> field )
00302     {
00303       <font class="keywordflow">switch</font>( field )
00304         {
00305         <font class="keywordflow">case</font> FIELD::BeginString:
00306         <font class="keywordflow">case</font> FIELD::BodyLength:
00307         <font class="keywordflow">case</font> FIELD::MsgType:
00308         <font class="keywordflow">case</font> FIELD::SenderCompID:
00309         <font class="keywordflow">case</font> FIELD::TargetCompID:
00310         <font class="keywordflow">case</font> FIELD::OnBehalfOfCompID:
00311         <font class="keywordflow">case</font> FIELD::DeliverToCompID:
00312         <font class="keywordflow">case</font> FIELD::SecureDataLen:
00313         <font class="keywordflow">case</font> FIELD::MsgSeqNum:
00314         <font class="keywordflow">case</font> FIELD::SenderSubID:
00315         <font class="keywordflow">case</font> FIELD::SenderLocationID:
00316         <font class="keywordflow">case</font> FIELD::TargetSubID:
00317         <font class="keywordflow">case</font> FIELD::TargetLocationID:
00318         <font class="keywordflow">case</font> FIELD::OnBehalfOfSubID:
00319         <font class="keywordflow">case</font> FIELD::OnBehalfOfLocationID:
00320         <font class="keywordflow">case</font> FIELD::DeliverToSubID:
00321         <font class="keywordflow">case</font> FIELD::DeliverToLocationID:
00322         <font class="keywordflow">case</font> FIELD::PossDupFlag:
00323         <font class="keywordflow">case</font> FIELD::PossResend:
00324         <font class="keywordflow">case</font> FIELD::SendingTime:
00325         <font class="keywordflow">case</font> FIELD::OrigSendingTime:
00326         <font class="keywordflow">case</font> FIELD::XmlDataLen:
00327         <font class="keywordflow">case</font> FIELD::XmlData:
00328         <font class="keywordflow">case</font> FIELD::MessageEncoding:
00329         <font class="keywordflow">case</font> FIELD::LastMsgSeqNumProcessed:
00330         <font class="keywordflow">case</font> FIELD::OnBehalfOfSendingTime:
00331           <font class="keywordflow">return</font> <font class="keyword">true</font>;
00332         <font class="keywordflow">default</font>:
00333           <font class="keywordflow">return</font> <font class="keyword">false</font>;
00334         };
00335     }
<a name="l00336"></a><a class="code" href="class_f_i_x_1_1_message.html#d2">00336</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a>&amp; field )
00337     {
00338       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>(field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>());
00339     }
00340 
<a name="l00341"></a><a class="code" href="class_f_i_x_1_1_message.html#d3">00341</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d3">isTrailerField</a>( <font class="keywordtype">int</font> field )
00342     {
00343       <font class="keywordflow">switch</font>( field )
00344         {
00345         <font class="keywordflow">case</font> FIELD::SignatureLength:
00346         <font class="keywordflow">case</font> FIELD::Signature:
00347         <font class="keywordflow">case</font> FIELD::CheckSum:
00348           <font class="keywordflow">return</font> <font class="keyword">true</font>;
00349         <font class="keywordflow">default</font>:
00350           <font class="keywordflow">return</font> <font class="keyword">false</font>;
00351         };
00352     }
<a name="l00353"></a><a class="code" href="class_f_i_x_1_1_message.html#d4">00353</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d3">isTrailerField</a>( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a>&amp; field )
00354     {
00355       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#d3">isTrailerField</a>(field.<a class="code" href="class_f_i_x_1_1_field_base.html#a1">getField</a>());
00356     }
00357 
<a name="l00359"></a><a class="code" href="class_f_i_x_1_1_message.html#a16">00359</a>     <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a> <a class="code" href="class_f_i_x_1_1_message.html#a16">getSessionID</a>() <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp;)
00360     {
00361       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00362       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00363       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00364 
00365       <a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(beginString);
00366       <a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(senderCompID);
00367       <a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(targetCompID);
00368 
00369       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>(beginString, senderCompID, targetCompID);
00370     }
00371 
<a name="l00373"></a><a class="code" href="class_f_i_x_1_1_message.html#a17">00373</a>     <font class="keywordtype">void</font> <a class="code" href="class_f_i_x_1_1_message.html#a17">setSessionID</a>( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00374     {
00375       <a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(sessionID.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>());
00376       <a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(sessionID.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a2">getSenderCompID</a>());
00377       <a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(sessionID.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getTargetCompID</a>());
00378     }
00379 
00380   <font class="keyword">private</font>:
00381     FieldBase <a class="code" href="class_f_i_x_1_1_message.html#c0">extractField</a>
<a name="l00382"></a><a class="code" href="class_f_i_x_1_1_message.html#c0">00382</a>     (<font class="keyword">const</font> std::string&amp; string, std::string::size_type&amp; pos)
00383     {
00384       FIELD::Field field;
00385       std::string fieldString;
00386       std::string valueString;
00387 
00388       std::string::size_type equalSign = string.find_first_of(<font class="charliteral">'='</font>, pos);
00389       fieldString = string.substr(pos, equalSign - pos);
00390 
00391       std::string::size_type soh =
00392         string.find_first_of(<font class="charliteral">'\001'</font>, equalSign+1);
00393       valueString = string.substr(equalSign+1, soh - (equalSign+1));
00394 
00395       std::stringstream stream(fieldString);
00396       stream &gt;&gt; field;
00397 
00398       pos = soh+1;
00399       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_field_base.html">FieldBase</a>( field, valueString );
00400     }
00401 
<a name="l00402"></a><a class="code" href="class_f_i_x_1_1_message.html#c1">00402</a>     <font class="keywordtype">void</font> <a class="code" href="class_f_i_x_1_1_message.html#c1">clear</a>()
00403     {
00404       <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a15">clear</a>();
00405       FieldMap::clear();
00406       <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a15">clear</a>();
00407     }
00408 
<a name="l00409"></a><a class="code" href="class_f_i_x_1_1_message.html#c2">00409</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#c2">validate</a>()
00410     {
00411       <font class="keywordflow">try</font>
00412         {
00413           <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a13">BodyLength</a> aBodyLength;
00414           <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(aBodyLength);
00415           <font class="keywordflow">if</font>(aBodyLength != <a class="code" href="class_f_i_x_1_1_message.html#a14">bodyLength</a>()) 
00416             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00417 
00418           <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a14">CheckSum</a> aCheckSum;
00419           <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(aCheckSum);
00420           <font class="keywordflow">return</font> aCheckSum == <a class="code" href="class_f_i_x_1_1_message.html#a15">checkSum</a>();
00421         }
00422       <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) { <font class="keywordflow">return</font> <font class="keyword">false</font>; }
00423     }
00424 
00425   <font class="keyword">protected</font>:
<a name="l00426"></a><a class="code" href="class_f_i_x_1_1_message.html#n0">00426</a>     <font class="keyword">mutable</font> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a> <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>;
<a name="l00427"></a><a class="code" href="class_f_i_x_1_1_message.html#n1">00427</a>     <font class="keyword">mutable</font> <a class="code" href="class_f_i_x_1_1_field_map.html">FieldMap</a> <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>;
<a name="l00428"></a><a class="code" href="class_f_i_x_1_1_message.html#n2">00428</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#n2">m_validStructure</a>;
00429   };
00432   <font class="keyword">inline</font> std::ostream&amp; <font class="keyword">operator</font> &lt;&lt;
<a name="l00433"></a><a class="code" href="namespace_f_i_x.html#a799">00433</a>   (std::ostream&amp; stream, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message)
00434   {
00435     stream &lt;&lt; message.getString();
00436     <font class="keywordflow">return</font> stream;
00437   }
00438 
<a name="l00440"></a><a class="code" href="namespace_f_i_x.html#a800">00440</a>   <font class="keyword">inline</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> <a class="code" href="namespace_f_i_x.html#a800">identifyType</a>( <font class="keyword">const</font> std::string&amp; message )
00441     <font class="keywordflow">throw</font>( <a class="code" href="struct_f_i_x_1_1_message_parse_error.html">MessageParseError</a>&amp; )
00442   {
00443     std::string::size_type pos = message.find(<font class="stringliteral">"\00135="</font>);
00444     <font class="keywordflow">if</font>( pos == std::string::npos ) <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_message_parse_error.html">MessageParseError</a>();
00445 
00446     std::string::size_type startValue = pos + 4;
00447     std::string::size_type soh = message.find_first_of(<font class="charliteral">'\001'</font>, startValue);
00448     <font class="keywordflow">if</font>( soh == std::string::npos ) <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_message_parse_error.html">MessageParseError</a>();
00449 
00450     std::string value = message.substr(startValue, soh - startValue);
00451     <font class="keywordflow">return</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(value);
00452   }
00453 }
00454 
00455 <font class="preprocessor">#endif //FIX_MESSAGE</font>
</pre></div><hr><address><small>
Generated on Tue Jun 11 23:07:23 2002 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.2.16 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
