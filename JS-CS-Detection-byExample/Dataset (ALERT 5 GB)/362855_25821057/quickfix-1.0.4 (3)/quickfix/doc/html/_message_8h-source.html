<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>C:/release/quickfix/src/C++/Message.h Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.12 -->
<h1>C:/release/quickfix/src/C++/Message.h</h1><a href="_message_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* -*- C++ -*- */</font>
00002 <font class="comment">/* ====================================================================</font>
00003 <font class="comment"> * The QuickFIX Software License, Version 1.0</font>
00004 <font class="comment"> *</font>
00005 <font class="comment"> * Copyright (c) 2001 ThoughtWorks, Inc.  All rights</font>
00006 <font class="comment"> * reserved.</font>
00007 <font class="comment"> *</font>
00008 <font class="comment"> * Redistribution and use in source and binary forms, with or without</font>
00009 <font class="comment"> * modification, are permitted provided that the following conditions</font>
00010 <font class="comment"> * are met:</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> * 1. Redistributions of source code must retain the above copyright</font>
00013 <font class="comment"> *    notice, this list of conditions and the following disclaimer.</font>
00014 <font class="comment"> *</font>
00015 <font class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</font>
00016 <font class="comment"> *    notice, this list of conditions and the following disclaimer in</font>
00017 <font class="comment"> *    the documentation and/or other materials provided with the</font>
00018 <font class="comment"> *    distribution.</font>
00019 <font class="comment"> *</font>
00020 <font class="comment"> * 3. The end-user documentation included with the redistribution,</font>
00021 <font class="comment"> *    if any, must include the following acknowledgment:</font>
00022 <font class="comment"> *       "This product includes software developed by</font>
00023 <font class="comment"> *        ThoughtWorks, Inc. (http://www.thoughtworks.com/)."</font>
00024 <font class="comment"> *    Alternately, this acknowledgment may appear in the software itself,</font>
00025 <font class="comment"> *    if and wherever such third-party acknowledgments normally appear.</font>
00026 <font class="comment"> *</font>
00027 <font class="comment"> * 4. The names "QuickFIX" and "ThoughtWorks, Inc." must</font>
00028 <font class="comment"> *    not be used to endorse or promote products derived from this</font>
00029 <font class="comment"> *    software without prior written permission. For written</font>
00030 <font class="comment"> *    permission, please contact quickfix-users@lists.sourceforge.net.</font>
00031 <font class="comment"> *</font>
00032 <font class="comment"> * 5. Products derived from this software may not be called "QuickFIX",</font>
00033 <font class="comment"> *    nor may "QuickFIX" appear in their name, without prior written</font>
00034 <font class="comment"> *    permission of ThoughtWorks, Inc.</font>
00035 <font class="comment"> *</font>
00036 <font class="comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</font>
00037 <font class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</font>
00038 <font class="comment"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</font>
00039 <font class="comment"> * DISCLAIMED.  IN NO EVENT SHALL THOUGHTWORKS INC OR</font>
00040 <font class="comment"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</font>
00041 <font class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</font>
00042 <font class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</font>
00043 <font class="comment"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</font>
00044 <font class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</font>
00045 <font class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</font>
00046 <font class="comment"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</font>
00047 <font class="comment"> * SUCH DAMAGE.</font>
00048 <font class="comment"> * ====================================================================</font>
00049 <font class="comment"> */</font>
00050 
00051 <font class="preprocessor">#ifndef FIX_MESSAGE</font>
00052 <font class="preprocessor"></font><font class="preprocessor">#define FIX_MESSAGE</font>
00053 <font class="preprocessor"></font>
00054 <font class="preprocessor">#ifdef _MSC_VER</font>
00055 <font class="preprocessor"></font><font class="preprocessor">#pragma warning( disable: 4786 )</font>
00056 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00057 <font class="preprocessor"></font>
00058 <font class="preprocessor">#include "<a class="code" href="_field_map_8h.html">FieldMap.h</a>"</font>
00059 <font class="preprocessor">#include "<a class="code" href="_fields_8h.html">Fields.h</a>"</font>
00060 <font class="preprocessor">#include "<a class="code" href="_group_8h.html">Group.h</a>"</font>
00061 <font class="preprocessor">#include "<a class="code" href="_session_i_d_8h.html">SessionID.h</a>"</font>
00062 <font class="preprocessor">#include &lt;vector&gt;</font>
00063 
00064 <font class="keyword">namespace </font>FIX
00065 {
00066   <font class="keyword">typedef</font> FieldMap <a class="code" href="namespace_f_i_x.html#a53">Header</a>;
00067   <font class="keyword">typedef</font> FieldMap <a class="code" href="namespace_f_i_x.html#a54">Trailer</a>;
00068 
<a name="l00078"></a><a class="code" href="class_f_i_x_1_1_message.html">00078</a>   <font class="keyword">class </font>Message : <font class="keyword">public</font> FieldMap
00079   {
<a name="l00080"></a><a class="code" href="class_f_i_x_1_1_message.html#l0">00080</a>     <font class="keyword">friend</font> <font class="keyword">class </font><a class="code" href="class_f_i_x_1_1_message.html#l0">MessageValidator</a>;
<a name="l00081"></a><a class="code" href="class_f_i_x_1_1_message.html#l1">00081</a>     <font class="keyword">friend</font> <font class="keyword">class </font><a class="code" href="class_f_i_x_1_1_message.html#l1">Session</a>;
00082 
<a name="l00083"></a><a class="code" href="class_f_i_x_1_1_message.html#u4">00083</a>     <font class="keyword">enum</font> <a class="code" href="class_f_i_x_1_1_message.html#u4">field_type</a> { <a class="code" href="class_f_i_x_1_1_message.html#u4u1">header</a>, <a class="code" href="class_f_i_x_1_1_message.html#u4u2">body</a>, <a class="code" href="class_f_i_x_1_1_message.html#u4u3">trailer</a> };
<a name="l00084"></a><a class="code" href="class_f_i_x_1_1_message.html#u0">00084</a>     <font class="keyword">typedef</font> std::map&lt;int, std::vector&lt;Group&gt; &gt; <a class="code" href="class_f_i_x_1_1_message.html#u0">Groups</a>;
00085 
00086   <font class="keyword">public</font>:
<a name="l00087"></a><a class="code" href="class_f_i_x_1_1_message.html#a0">00087</a>     <a class="code" href="class_f_i_x_1_1_message.html#a0">Message</a>()
00088       : <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>(message_order(message_order::<a class="code" href="class_f_i_x_1_1_message.html#u4u1">header</a>)),
00089         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>(message_order(message_order::<a class="code" href="class_f_i_x_1_1_message.html#u4u3">trailer</a>)),
00090         <a class="code" href="class_f_i_x_1_1_message.html#n3">m_validStructure</a>(true) {}
00091 
<a name="l00093"></a><a class="code" href="class_f_i_x_1_1_message.html#a1">00093</a>     <a class="code" href="class_f_i_x_1_1_message.html#a0">Message</a>( <font class="keyword">const</font> std::string&amp; string ) <font class="keywordflow">throw</font>( InvalidMessage&amp; )
00094       : <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>(message_order(message_order::header)),
00095         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>(message_order(message_order::trailer)),
00096         <a class="code" href="class_f_i_x_1_1_message.html#n3">m_validStructure</a>(<font class="keyword">true</font>)
00097     {
00098       <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_message.html#a5">setString</a>(string))
00099         <font class="keywordflow">throw</font> InvalidMessage();
00100     }
00101 
<a name="l00102"></a><a class="code" href="class_f_i_x_1_1_message.html#a2">00102</a>     <font class="keywordtype">void</font> <a class="code" href="class_f_i_x_1_1_message.html#a2">addGroup</a>( Group&amp; group )
00103     {
00104       <a class="code" href="class_f_i_x_1_1_message.html#n2">m_groups</a>[group.field()].push_back(group);
00105     }
00106 
<a name="l00107"></a><a class="code" href="class_f_i_x_1_1_message.html#a3">00107</a>     Group&amp; <a class="code" href="class_f_i_x_1_1_message.html#a3">getGroup</a>( <font class="keywordtype">unsigned</font> num, Group&amp; group ) <font class="keywordflow">throw</font>(FieldNotFound&amp;)
00108     {
00109       Groups::iterator i = <a class="code" href="class_f_i_x_1_1_message.html#n2">m_groups</a>.find(num);
00110       <font class="keywordflow">if</font>(i == <a class="code" href="class_f_i_x_1_1_message.html#n2">m_groups</a>.end()) <font class="keywordflow">throw</font> FieldNotFound(group.field());
00111       <font class="keywordflow">if</font>(i-&gt;second.size() &lt; num || num &lt; 0) <font class="keywordflow">throw</font> FieldNotFound(group.field());
00112       group = *(i-&gt;second.begin() + (num - 1));
00113       <font class="keywordflow">return</font> group;
00114     }
00115 
00116   <font class="keyword">protected</font>:
00117     <font class="comment">// Constructor for derived classes</font>
<a name="l00118"></a><a class="code" href="class_f_i_x_1_1_message.html#b0">00118</a>     <a class="code" href="class_f_i_x_1_1_message.html#a0">Message</a>( <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a>&amp; beginString, <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType )
00119       : <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>(message_order(message_order::<a class="code" href="class_f_i_x_1_1_message.html#u4u1">header</a>)),
00120         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>(message_order(message_order::<a class="code" href="class_f_i_x_1_1_message.html#u4u3">trailer</a>)),
00121         <a class="code" href="class_f_i_x_1_1_message.html#n3">m_validStructure</a>(true)
00122     {
00123       <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.setField(beginString);
00124       <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.setField(msgType);
00125     }
00126 
00127   <font class="keyword">public</font>:
<a name="l00129"></a><a class="code" href="class_f_i_x_1_1_message.html#a4">00129</a>     std::string <a class="code" href="class_f_i_x_1_1_message.html#a4">getString</a>()<font class="keyword"> const</font>
00130 <font class="keyword">    </font>{
00131       <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.setField( <a class="code" href="class_f_i_x_1_1_message.html#a11">bodyLength</a>() );
00132       <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.setField( <a class="code" href="class_f_i_x_1_1_message.html#a12">checkSum</a>() );
00133 
00134       <font class="keywordflow">return</font>
00135         <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.calculateString() +
00136         FieldMap::calculateString() +
00137         <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.calculateString();
00138     }
00139 
<a name="l00146"></a><a class="code" href="class_f_i_x_1_1_message.html#a5">00146</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#a5">setString</a>( <font class="keyword">const</font> std::string&amp; string )
00147     {
00148       <a class="code" href="class_f_i_x_1_1_message.html#c1">clear</a>();
00149 
00150       std::string::size_type pos = 0;
00151       <font class="keywordtype">int</font> count = 0;
00152 
00153       <font class="keyword">static</font> FIELD::Field <font class="keyword">const</font> headerOrder[] = {
00154         FIELD::BeginString,
00155         FIELD::BodyLength,
00156         FIELD::MsgType
00157       };
00158 
00159       <a class="code" href="class_f_i_x_1_1_message.html#u4">field_type</a> type = <a class="code" href="class_f_i_x_1_1_message.html#u4u1">header</a>;
00160 
00161       <font class="keywordflow">while</font>(pos &lt; string.size())
00162         {
00163           FieldBase field = <a class="code" href="class_f_i_x_1_1_message.html#c0">extractField</a>(string,pos);
00164           <font class="keywordflow">if</font> (count &lt; 3 &amp;&amp; headerOrder[count++] != field.getField())
00165             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00166 
00167           <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>(field) )
00168             { <font class="keywordflow">if</font>(type != <a class="code" href="class_f_i_x_1_1_message.html#u4u1">header</a>) <a class="code" href="class_f_i_x_1_1_message.html#n3">m_validStructure</a> = <font class="keyword">false</font>;
00169             <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.setField(field); }
00170           <font class="keywordflow">else</font>
00171             <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_message.html#d3">isTrailerField</a>(field) )
00172               { type = <a class="code" href="class_f_i_x_1_1_message.html#u4u3">trailer</a>;
00173               <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.setField(field); }
00174             <font class="keywordflow">else</font>
00175               { <font class="keywordflow">if</font>(type == <a class="code" href="class_f_i_x_1_1_message.html#u4u3">trailer</a>) <a class="code" href="class_f_i_x_1_1_message.html#n3">m_validStructure</a> = <font class="keyword">false</font>;
00176               type = <a class="code" href="class_f_i_x_1_1_message.html#u4u2">body</a>;
00177               <a class="code" href="class_f_i_x_1_1_field_map.html#a1">setField</a>(field); }
00178         }
00179       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#c2">validate</a>();
00180     }
00181 
<a name="l00183"></a><a class="code" href="class_f_i_x_1_1_message.html#a6">00183</a>     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; <a class="code" href="class_f_i_x_1_1_message.html#a6">getHeader</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>; }
<a name="l00185"></a><a class="code" href="class_f_i_x_1_1_message.html#a7">00185</a>     <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; <a class="code" href="class_f_i_x_1_1_message.html#a6">getHeader</a>() { <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>; }
<a name="l00187"></a><a class="code" href="class_f_i_x_1_1_message.html#a8">00187</a>     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; <a class="code" href="class_f_i_x_1_1_message.html#a8">getTrailer</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>; }
<a name="l00189"></a><a class="code" href="class_f_i_x_1_1_message.html#a9">00189</a>     <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; <a class="code" href="class_f_i_x_1_1_message.html#a8">getTrailer</a>() { <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>; }
00190 
<a name="l00191"></a><a class="code" href="class_f_i_x_1_1_message.html#a10">00191</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#a10">hasValidStructure</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#n3">m_validStructure</a>; }
00192 
<a name="l00193"></a><a class="code" href="class_f_i_x_1_1_message.html#a11">00193</a>     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a13">BodyLength</a> <a class="code" href="class_f_i_x_1_1_message.html#a11">bodyLength</a>()<font class="keyword"> const</font>
00194 <font class="keyword">    </font>{
00195       <font class="keywordflow">return</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a13">BodyLength</a>
00196         (<a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.calculateLength()
00197          + <a class="code" href="class_f_i_x_1_1_field_map.html#a12">calculateLength</a>()
00198          + <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.calculateLength());
00199     }
00200 
<a name="l00201"></a><a class="code" href="class_f_i_x_1_1_message.html#a12">00201</a>     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a14">CheckSum</a> <a class="code" href="class_f_i_x_1_1_message.html#a12">checkSum</a>()<font class="keyword"> const</font>
00202 <font class="keyword">    </font>{
00203       <font class="keywordflow">return</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a14">CheckSum</a>
00204         ((<a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.calculateTotal()
00205           + <a class="code" href="class_f_i_x_1_1_field_map.html#a13">calculateTotal</a>()
00206           + <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.calculateTotal()) % 256);
00207     }
00208 
<a name="l00209"></a><a class="code" href="class_f_i_x_1_1_message.html#d0">00209</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d0">isAdminMsgType</a>( <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType )
00210     {
00211       <font class="keywordflow">if</font>( !msgType.getValue().length() ) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00212       <font class="keywordflow">return</font> strchr
00213         (<font class="stringliteral">"0A12345"</font>,
00214          msgType.getValue().c_str()[0]) != 0;
00215     }
00216 
<a name="l00217"></a><a class="code" href="class_f_i_x_1_1_message.html#d1">00217</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>( <font class="keywordtype">int</font> field )
00218     {
00219       <font class="keywordflow">switch</font>( field )
00220         {
00221         <font class="keywordflow">case</font> FIELD::BeginString:
00222         <font class="keywordflow">case</font> FIELD::BodyLength:
00223         <font class="keywordflow">case</font> FIELD::MsgType:
00224         <font class="keywordflow">case</font> FIELD::SenderCompID:
00225         <font class="keywordflow">case</font> FIELD::TargetCompID:
00226         <font class="keywordflow">case</font> FIELD::OnBehalfOfCompID:
00227         <font class="keywordflow">case</font> FIELD::DeliverToCompID:
00228         <font class="keywordflow">case</font> FIELD::SecureDataLen:
00229         <font class="keywordflow">case</font> FIELD::MsgSeqNum:
00230         <font class="keywordflow">case</font> FIELD::SenderSubID:
00231         <font class="keywordflow">case</font> FIELD::SenderLocationID:
00232         <font class="keywordflow">case</font> FIELD::TargetSubID:
00233         <font class="keywordflow">case</font> FIELD::TargetLocationID:
00234         <font class="keywordflow">case</font> FIELD::OnBehalfOfSubID:
00235         <font class="keywordflow">case</font> FIELD::OnBehalfOfLocationID:
00236         <font class="keywordflow">case</font> FIELD::DeliverToSubID:
00237         <font class="keywordflow">case</font> FIELD::DeliverToLocationID:
00238         <font class="keywordflow">case</font> FIELD::PossDupFlag:
00239         <font class="keywordflow">case</font> FIELD::PossResend:
00240         <font class="keywordflow">case</font> FIELD::SendingTime:
00241         <font class="keywordflow">case</font> FIELD::OrigSendingTime:
00242         <font class="keywordflow">case</font> FIELD::XmlDataLen:
00243         <font class="keywordflow">case</font> FIELD::XmlData:
00244         <font class="keywordflow">case</font> FIELD::MessageEncoding:
00245         <font class="keywordflow">case</font> FIELD::LastMsgSeqNumProcessed:
00246         <font class="keywordflow">case</font> FIELD::OnBehalfOfSendingTime:
00247           <font class="keywordflow">return</font> <font class="keyword">true</font>;
00248         <font class="keywordflow">default</font>:
00249           <font class="keywordflow">return</font> <font class="keyword">false</font>;
00250         };
00251     }
<a name="l00252"></a><a class="code" href="class_f_i_x_1_1_message.html#d2">00252</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>( <font class="keyword">const</font> FieldBase&amp; field )
00253     {
00254       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#d1">isHeaderField</a>(field.getField());
00255     }
00256 
<a name="l00257"></a><a class="code" href="class_f_i_x_1_1_message.html#d3">00257</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d3">isTrailerField</a>( <font class="keywordtype">int</font> field )
00258     {
00259       <font class="keywordflow">switch</font>( field )
00260         {
00261         <font class="keywordflow">case</font> FIELD::SignatureLength:
00262         <font class="keywordflow">case</font> FIELD::Signature:
00263         <font class="keywordflow">case</font> FIELD::CheckSum:
00264           <font class="keywordflow">return</font> <font class="keyword">true</font>;
00265         <font class="keywordflow">default</font>:
00266           <font class="keywordflow">return</font> <font class="keyword">false</font>;
00267         };
00268     }
<a name="l00269"></a><a class="code" href="class_f_i_x_1_1_message.html#d4">00269</a>     <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#d3">isTrailerField</a>( <font class="keyword">const</font> FieldBase&amp; field )
00270     {
00271       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_message.html#d3">isTrailerField</a>(field.getField());
00272     }
00273 
<a name="l00275"></a><a class="code" href="class_f_i_x_1_1_message.html#a13">00275</a>     SessionID <a class="code" href="class_f_i_x_1_1_message.html#a13">getSessionID</a>() <font class="keywordflow">throw</font>(FieldNotFound&amp;)
00276     {
00277       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00278       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00279       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00280 
00281       <a class="code" href="class_f_i_x_1_1_message.html#a6">getHeader</a>().getField(beginString);
00282       <a class="code" href="class_f_i_x_1_1_message.html#a6">getHeader</a>().getField(senderCompID);
00283       <a class="code" href="class_f_i_x_1_1_message.html#a6">getHeader</a>().getField(targetCompID);
00284 
00285       <font class="keywordflow">return</font> SessionID(beginString, senderCompID, targetCompID);
00286     }
00287 
<a name="l00289"></a><a class="code" href="class_f_i_x_1_1_message.html#a14">00289</a>     <font class="keywordtype">void</font> <a class="code" href="class_f_i_x_1_1_message.html#a14">setSessionID</a>( <font class="keyword">const</font> SessionID&amp; sessionID )
00290     {
00291       <a class="code" href="class_f_i_x_1_1_message.html#a6">getHeader</a>().setField(sessionID.getBeginString());
00292       <a class="code" href="class_f_i_x_1_1_message.html#a6">getHeader</a>().setField(sessionID.getSenderCompID());
00293       <a class="code" href="class_f_i_x_1_1_message.html#a6">getHeader</a>().setField(sessionID.getTargetCompID());
00294     }
00295 
00296   <font class="keyword">private</font>:
00297     FieldBase <a class="code" href="class_f_i_x_1_1_message.html#c0">extractField</a>
<a name="l00298"></a><a class="code" href="class_f_i_x_1_1_message.html#c0">00298</a>     (<font class="keyword">const</font> std::string string, std::string::size_type&amp; pos)
00299     {
00300       FIELD::Field field;
00301       std::string fieldString;
00302       std::string valueString;
00303 
00304       std::string::size_type equalSign = string.find_first_of(<font class="charliteral">'='</font>, pos);
00305       fieldString = string.substr(pos, equalSign - pos);
00306 
00307       std::string::size_type soh =
00308         string.find_first_of(<font class="charliteral">'\001'</font>, equalSign+1);
00309       valueString = string.substr(equalSign+1, soh - (equalSign+1));
00310 
00311       std::stringstream stream(fieldString);
00312       stream &gt;&gt; field;
00313 
00314       pos = soh+1;
00315       <font class="keywordflow">return</font> FieldBase( field, valueString );
00316     }
00317 
<a name="l00318"></a><a class="code" href="class_f_i_x_1_1_message.html#c1">00318</a>     <font class="keywordtype">void</font> <a class="code" href="class_f_i_x_1_1_message.html#c1">clear</a>()
00319     {
00320       <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>.clear();
00321       FieldMap::clear();
00322       <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.clear();
00323     }
00324 
<a name="l00325"></a><a class="code" href="class_f_i_x_1_1_message.html#c2">00325</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#c2">validate</a>()
00326     {
00327       <font class="keywordflow">try</font>
00328         {
00329           <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a14">CheckSum</a> aCheckSum;
00330           <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>.getField(aCheckSum);
00331           <font class="keywordflow">return</font> aCheckSum == <a class="code" href="class_f_i_x_1_1_message.html#a12">checkSum</a>();
00332         }
00333       <font class="keywordflow">catch</font>( FieldNotFound&amp; ) { <font class="keywordflow">return</font> <font class="keyword">false</font>; }
00334     }
00335 
00336   <font class="keyword">protected</font>:
<a name="l00337"></a><a class="code" href="class_f_i_x_1_1_message.html#n0">00337</a>     <font class="keyword">mutable</font> <a class="code" href="class_f_i_x_1_1_field_map.html#a0">FieldMap</a> <a class="code" href="class_f_i_x_1_1_message.html#n0">m_header</a>;
<a name="l00338"></a><a class="code" href="class_f_i_x_1_1_message.html#n1">00338</a>     <font class="keyword">mutable</font> <a class="code" href="class_f_i_x_1_1_field_map.html#a0">FieldMap</a> <a class="code" href="class_f_i_x_1_1_message.html#n1">m_trailer</a>;
<a name="l00339"></a><a class="code" href="class_f_i_x_1_1_message.html#n2">00339</a>     <a class="code" href="class_f_i_x_1_1_message.html#u0">Groups</a> <a class="code" href="class_f_i_x_1_1_message.html#n2">m_groups</a>;
<a name="l00340"></a><a class="code" href="class_f_i_x_1_1_message.html#n3">00340</a>     <font class="keywordtype">bool</font> <a class="code" href="class_f_i_x_1_1_message.html#n3">m_validStructure</a>;
00341   };
00344   <font class="keyword">inline</font> std::ostream&amp; <font class="keyword">operator</font> &lt;&lt;
00345   (std::ostream&amp; stream, <font class="keyword">const</font> Message&amp; message)
00346   {
00347     stream &lt;&lt; message.getString();
00348     <font class="keywordflow">return</font> stream;
00349   }
00350 
00352   <font class="keyword">inline</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> <a class="code" href="namespace_f_i_x.html#a647">identifyType</a>( <font class="keyword">const</font> std::string&amp; message )
00353     <font class="keywordflow">throw</font>( MessageParseError&amp; )
00354   {
00355     std::string::size_type pos = message.find(<font class="stringliteral">"\00135="</font>);
00356     <font class="keywordflow">if</font>( pos == std::string::npos ) <font class="keywordflow">throw</font> MessageParseError();
00357 
00358     std::string::size_type startValue = pos + 4;
00359     std::string::size_type soh = message.find_first_of(<font class="charliteral">'\001'</font>, startValue);
00360     <font class="keywordflow">if</font>( soh == std::string::npos ) <font class="keywordflow">throw</font> MessageParseError();
00361 
00362     std::string value = message.substr(startValue, soh - startValue);
00363     <font class="keywordflow">return</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(value);
00364   }
00365 }
00366 
00367 <font class="preprocessor">#endif //FIX_MESSAGE</font>
</font></pre></div><hr><address><small>
Generated on Fri Mar 29 15:45:34 2002 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.2.12 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
