<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>D:/release/quickfix/src/C++/Session.cpp Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.16 -->
<h1>D:/release/quickfix/src/C++/Session.cpp</h1><a href="_session_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* ====================================================================</font>
00002 <font class="comment"> * The QuickFIX Software License, Version 1.0</font>
00003 <font class="comment"> *</font>
00004 <font class="comment"> * Copyright (c) 2001 ThoughtWorks, Inc.  All rights</font>
00005 <font class="comment"> * reserved.</font>
00006 <font class="comment"> *</font>
00007 <font class="comment"> * Redistribution and use in source and binary forms, with or without</font>
00008 <font class="comment"> * modification, are permitted provided that the following conditions</font>
00009 <font class="comment"> * are met:</font>
00010 <font class="comment"> *</font>
00011 <font class="comment"> * 1. Redistributions of source code must retain the above copyright</font>
00012 <font class="comment"> *    notice, this list of conditions and the following disclaimer.</font>
00013 <font class="comment"> *</font>
00014 <font class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</font>
00015 <font class="comment"> *    notice, this list of conditions and the following disclaimer in</font>
00016 <font class="comment"> *    the documentation and/or other materials provided with the</font>
00017 <font class="comment"> *    distribution.</font>
00018 <font class="comment"> *</font>
00019 <font class="comment"> * 3. The end-user documentation included with the redistribution,</font>
00020 <font class="comment"> *    if any, must include the following acknowledgment:</font>
00021 <font class="comment"> *       "This product includes software developed by</font>
00022 <font class="comment"> *        ThoughtWorks, Inc. (http://www.thoughtworks.com/)."</font>
00023 <font class="comment"> *    Alternately, this acknowledgment may appear in the software itself,</font>
00024 <font class="comment"> *    if and wherever such third-party acknowledgments normally appear.</font>
00025 <font class="comment"> *</font>
00026 <font class="comment"> * 4. The names "QuickFIX" and "ThoughtWorks, Inc." must</font>
00027 <font class="comment"> *    not be used to endorse or promote products derived from this</font>
00028 <font class="comment"> *    software without prior written permission. For written</font>
00029 <font class="comment"> *    permission, please contact quickfix-users@lists.sourceforge.net.</font>
00030 <font class="comment"> *</font>
00031 <font class="comment"> * 5. Products derived from this software may not be called "QuickFIX",</font>
00032 <font class="comment"> *    nor may "QuickFIX" appear in their name, without prior written</font>
00033 <font class="comment"> *    permission of ThoughtWorks, Inc.</font>
00034 <font class="comment"> *</font>
00035 <font class="comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</font>
00036 <font class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</font>
00037 <font class="comment"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</font>
00038 <font class="comment"> * DISCLAIMED.  IN NO EVENT SHALL THOUGHTWORKS INC OR</font>
00039 <font class="comment"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</font>
00040 <font class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</font>
00041 <font class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</font>
00042 <font class="comment"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</font>
00043 <font class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</font>
00044 <font class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</font>
00045 <font class="comment"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</font>
00046 <font class="comment"> * SUCH DAMAGE.</font>
00047 <font class="comment"> * ====================================================================</font>
00048 <font class="comment"> */</font>
00049 
00050 <font class="preprocessor">#ifdef _MSC_VER</font>
00051 <font class="preprocessor"></font><font class="preprocessor">#include "stdafx.h"</font>
00052 <font class="preprocessor">#else</font>
00053 <font class="preprocessor"></font><font class="preprocessor">#include "config.h"</font>
00054 <font class="preprocessor">#endif</font>
00055 <font class="preprocessor"></font>
00056 <font class="preprocessor">#include "<a class="code" href="_session_8h.html">Session.h</a>"</font>
00057 <font class="preprocessor">#include "<a class="code" href="_values_8h.html">Values.h</a>"</font>
00058 <font class="preprocessor">#include &lt;algorithm&gt;</font>
00059 <font class="preprocessor">#include &lt;iostream&gt;</font>
00060 
00061 <font class="keyword">namespace </font>FIX
00062 {
<a name="l00063"></a><a class="code" href="class_f_i_x_1_1_session.html#r0">00063</a>   Session::Sessions Session::s_sessions;
<a name="l00064"></a><a class="code" href="class_f_i_x_1_1_session.html#r1">00064</a>   Session::Sessions Session::s_registered;
<a name="l00065"></a><a class="code" href="class_f_i_x_1_1_session.html#r2">00065</a>   <a class="code" href="class_f_i_x_1_1_mutex.html">Mutex</a> Session::s_mutex;
00066 
<a name="l00067"></a><a class="code" href="class_f_i_x_1_1_session.html#a0">00067</a>   Session::Session( <a class="code" href="class_f_i_x_1_1_application.html">Application</a>&amp; application,
00068                     <a class="code" href="class_f_i_x_1_1_message_store_factory.html">MessageStoreFactory</a>&amp; factory,
00069                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID,
00070                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>&amp; dataDictionary,
00071                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; startTime,
00072                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; endTime,
00073                     <font class="keywordtype">int</font> heartBtInt )
00074   : m_application(application), m_pResponder(0),
00075     m_sessionID(sessionID), m_heartBtInt(heartBtInt),
00076     m_startTime(startTime), m_endTime(endTime),
00077     m_checkLatency(true), m_maxLatency(120), m_logonTimeout(10),
00078     m_resetOnLogout(false), m_resetOnDisconnect(false),
00079     m_connected(false), m_receivedLogon(false), m_sentLogout(false), 
00080     m_sentLogon(false),
00081     m_dataDictionary(dataDictionary), m_factory(factory)
00082   {
00083     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_initiate</a> = (heartBtInt != 0);
00084     <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a> = <a class="code" href="class_f_i_x_1_1_session.html#o19">m_factory</a>.<a class="code" href="class_f_i_x_1_1_message_store_factory.html#a1">create</a>(sessionID);
00085 
00086     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> creationTime = <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a10">getCreationTime</a>();
00087     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00088 
00089     <font class="keywordflow">if</font>(creationTime &gt; now ||
00090       !<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>(startTime, endTime, now) ||
00091       !<a class="code" href="class_f_i_x_1_1_session.html#d12">isSameSession</a>(startTime, endTime, now, creationTime))
00092     {
00093       <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>();
00094     }
00095 
00096     <a class="code" href="class_f_i_x_1_1_session.html#f0">addSession</a>(*<font class="keyword">this</font>);
00097   }
00098 
<a name="l00099"></a><a class="code" href="class_f_i_x_1_1_session.html#a1">00099</a>   Session::~Session()
00100   {
00101     <a class="code" href="class_f_i_x_1_1_session.html#f1">removeSession</a>(*<font class="keyword">this</font>);
00102     <a class="code" href="class_f_i_x_1_1_session.html#o19">m_factory</a>.<a class="code" href="class_f_i_x_1_1_message_store_factory.html#a2">destroy</a>(<a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>);
00103   }
00104 
<a name="l00105"></a><a class="code" href="class_f_i_x_1_1_session.html#c5">00105</a>   <font class="keywordtype">void</font> Session::fill( <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header )
00106   {
00107     <a class="code" href="class_f_i_x_1_1_session.html#o16">m_lastSentTime</a>.<a class="code" href="class_f_i_x_1_1_utc_time_stamp.html#a21">setCurrent</a>();
00108     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>() );
00109     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a2">getSenderCompID</a>() );
00110     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getTargetCompID</a>() );
00111     header.setField( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(<a class="code" href="class_f_i_x_1_1_session.html#a20">getExpectedSenderNum</a>()) );
00112     header.setField( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a>() );
00113   }
00114 
<a name="l00115"></a><a class="code" href="class_f_i_x_1_1_session.html#a16">00115</a>   <font class="keywordtype">void</font> Session::next()
00116   {
00117     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#o22">m_mutex</a>);
00118 
00119     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00120     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c7">checkSessionTime</a>(now))
00121     { <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); <font class="keywordflow">return</font>; }
00122     
00123     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() )
00124       {
00125         <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o15">m_initiate</a> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#o14">m_sentLogon</a>)
00126             <a class="code" href="class_f_i_x_1_1_session.html#c26">generateLogon</a>();
00127         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o15">m_initiate</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o14">m_sentLogon</a>)
00128           {
00129             <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00130             <font class="keywordflow">if</font>(now - <a class="code" href="class_f_i_x_1_1_session.html#o17">m_lastReceivedTime</a> &gt;= <a class="code" href="class_f_i_x_1_1_session.html#o8">m_logonTimeout</a>)
00131               <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00132           }
00133         <font class="keywordflow">return</font>;
00134       }
00135 
00136     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a> == 0 ) <font class="keywordflow">return</font>;
00137     
00138     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o13">m_sentLogout</a> &amp;&amp; (now - <a class="code" href="class_f_i_x_1_1_session.html#o17">m_lastReceivedTime</a> &gt;= 2))
00139       <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00140 
00141     <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o16">m_lastSentTime</a>) &lt; <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>) <font class="keywordflow">return</font>;
00142 
00143     <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o17">m_lastReceivedTime</a>) &gt;= (5 * <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>))
00144       <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00145     <font class="keywordflow">else</font>
00146       <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o17">m_lastReceivedTime</a>) &gt;= (1.2 * <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>))
00147         <a class="code" href="class_f_i_x_1_1_session.html#c32">generateTestRequest</a>();
00148       <font class="keywordflow">else</font>
00149         <a class="code" href="class_f_i_x_1_1_session.html#c30">generateHeartbeat</a>();
00150   }
00151 
<a name="l00152"></a><a class="code" href="class_f_i_x_1_1_session.html#c19">00152</a>   <font class="keywordtype">void</font> Session::nextLogon( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; logon )
00153   {
00154     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#o15">m_initiate</a> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#o14">m_sentLogon</a> )
00155       { <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>(); <font class="keywordflow">return</font>; }
00156 
00157     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00158     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00159     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(senderCompID);
00160     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(targetCompID);
00161 
00162     <font class="keywordtype">bool</font> verified = <a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>(logon, <font class="keyword">false</font>, <font class="keyword">true</font>);
00163     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#c10">isCorrectCompID</a>(senderCompID, targetCompID))
00164       <a class="code" href="class_f_i_x_1_1_session.html#o12">m_receivedLogon</a> = <font class="keyword">true</font>;
00165     <font class="keywordflow">if</font>(!verified) <font class="keywordflow">return</font>;
00166 
00167     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#o15">m_initiate</a> )
00168       {
00169         logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(<a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>);
00170         <a class="code" href="class_f_i_x_1_1_session.html#c26">generateLogon</a>(logon);
00171       }
00172 
00173     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00174     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgSeqNum);
00175     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#c8">isTargetTooHigh</a>(msgSeqNum) )
00176       {
00177         <a class="code" href="class_f_i_x_1_1_session.html#c17">doTargetTooHigh</a>(logon);
00178       }
00179     <font class="keywordflow">else</font>
00180       {
00181         <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00182         <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00183       }
00184  
00185     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()) 
00186       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a2">onLogon</a>(<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00187   }
00188 
<a name="l00189"></a><a class="code" href="class_f_i_x_1_1_session.html#c20">00189</a>   <font class="keywordtype">void</font> Session::nextHeartbeat( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; heartbeat )
00190   {
00191     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>(heartbeat) ) <font class="keywordflow">return</font>;
00192     <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00193     <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00194   }
00195 
<a name="l00196"></a><a class="code" href="class_f_i_x_1_1_session.html#c21">00196</a>   <font class="keywordtype">void</font> Session::nextTestRequest( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; testRequest )
00197   {
00198     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>(testRequest) ) <font class="keywordflow">return</font>;
00199     <a class="code" href="class_f_i_x_1_1_session.html#c30">generateHeartbeat</a>( testRequest );
00200     <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00201     <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00202   }
00203 
<a name="l00204"></a><a class="code" href="class_f_i_x_1_1_session.html#c22">00204</a>   <font class="keywordtype">void</font> Session::nextLogout( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; logout )
00205   {
00206     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>(logout, <font class="keyword">false</font>, <font class="keyword">false</font>) ) <font class="keywordflow">return</font>;
00207     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a3">sentLogout</a>() ) <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00208     <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00209     <font class="keywordflow">if</font>( m_resetOnLogout ) <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>();
00210     <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00211   }
00212 
<a name="l00213"></a><a class="code" href="class_f_i_x_1_1_session.html#c23">00213</a>   <font class="keywordtype">void</font> Session::nextReject( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject )
00214   {
00215     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>(reject) ) <font class="keywordflow">return</font>;
00216     <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00217     <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00218   }
00219 
<a name="l00220"></a><a class="code" href="class_f_i_x_1_1_session.html#c24">00220</a>   <font class="keywordtype">void</font> Session::nextSequenceReset( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; sequenceReset )
00221   {
00222     <font class="keywordtype">bool</font> isGapFill = <font class="keyword">false</font>;
00223     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a> gapFillFlag;
00224     <font class="keywordflow">if</font>( sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a12">isSetField</a>(gapFillFlag) )
00225       {
00226         sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(gapFillFlag);
00227         isGapFill = gapFillFlag;
00228       }
00229 
00230     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>(sequenceReset, isGapFill, isGapFill) ) <font class="keywordflow">return</font>;
00231 
00232     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a> newSeqNo;
00233     <font class="keywordflow">if</font>(sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a12">isSetField</a>(newSeqNo))
00234       {
00235         sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(newSeqNo);
00236         <font class="keywordflow">if</font>( newSeqNo &gt; <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() )
00237           <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a7">setNextTargetMsgSeqNum</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(newSeqNo));
00238         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( newSeqNo &lt; <a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>() )
00239           <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(sequenceReset, 5);
00240       }
00241   }
00242 
<a name="l00243"></a><a class="code" href="class_f_i_x_1_1_session.html#c25">00243</a>   <font class="keywordtype">void</font> Session::nextResendRequest( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; resendRequest )
00244   {
00245     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>(resendRequest, <font class="keyword">false</font>, <font class="keyword">false</font>) ) <font class="keywordflow">return</font>;
00246     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a11">BeginSeqNo</a> beginSeqNo;
00247     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a20">EndSeqNo</a> endSeqNo;
00248     resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(beginSeqNo);
00249     resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(endSeqNo);
00250     std::vector&lt;Message&gt; messages;
00251 
00252     std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>();
00253     <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42 &amp;&amp; endSeqNo == 0 ||
00254        beginString &lt;= FIX::BeginString_FIX42 &amp;&amp; endSeqNo == 999999)
00255     { endSeqNo = <a class="code" href="class_f_i_x_1_1_session.html#a20">getExpectedSenderNum</a>() - 1; }
00256 
00257     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a2">get</a>(beginSeqNo, endSeqNo, messages))
00258       {
00259         std::vector&lt;Message&gt;::iterator i;
00260         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00261         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00262         <font class="keywordtype">int</font> begin = 0;
00263 
00264         <font class="keywordflow">for</font>( i = messages.begin(); i != messages.end(); ++i )
00265           {
00266             i-&gt;getHeader().getField(msgSeqNum);
00267             i-&gt;getHeader().getField(msgType);
00268             <font class="keywordflow">if</font>( Message::isAdminMsgType(msgType) )
00269               {
00270                 <font class="keywordflow">if</font>(!begin) begin = msgSeqNum;
00271               }
00272             <font class="keywordflow">else</font>
00273               {
00274                 <font class="keywordflow">if</font>(begin) <a class="code" href="class_f_i_x_1_1_session.html#c29">generateSequenceReset</a>(begin, msgSeqNum);
00275                 <a class="code" href="class_f_i_x_1_1_session.html#c4">resend</a>(*i);
00276                 begin = 0;
00277               }
00278           }
00279         <font class="keywordflow">if</font>(begin) <a class="code" href="class_f_i_x_1_1_session.html#c29">generateSequenceReset</a>(begin, msgSeqNum+1);
00280       }
00281     <font class="keywordflow">else</font>
00282       <a class="code" href="class_f_i_x_1_1_session.html#c29">generateSequenceReset</a>(beginSeqNo, <a class="code" href="class_f_i_x_1_1_session.html#a20">getExpectedSenderNum</a>());
00283 
00284     <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00285   }
00286 
<a name="l00287"></a><a class="code" href="class_f_i_x_1_1_session.html#a15">00287</a>   <font class="keywordtype">bool</font> Session::send( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00288   {
00289     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#o22">m_mutex</a>);
00290 
00291     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().removeField(FIELD::PossDupFlag);
00292     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().removeField(FIELD::OrigSendingTime);
00293     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(message);
00294   }
00295 
<a name="l00296"></a><a class="code" href="class_f_i_x_1_1_session.html#c3">00296</a>   <font class="keywordtype">bool</font> Session::sendRaw( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keywordtype">int</font> msgSeqNum )
00297   {
00298     <font class="keywordtype">bool</font> result = <font class="keyword">false</font>;
00299     <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00300     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00301     header.getField(msgType);
00302 
00303     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>(header);
00304 
00305     <font class="keywordflow">if</font>(msgSeqNum)
00306       header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(msgSeqNum));
00307 
00308     <font class="keywordflow">if</font>(Message::isAdminMsgType(msgType))
00309     {
00310       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a4">toAdmin</a>(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00311       <font class="keywordflow">if</font>(
00312           msgType == <font class="stringliteral">"A"</font> || msgType == <font class="stringliteral">"5"</font> 
00313           || msgType == <font class="stringliteral">"2"</font> || msgType == <font class="stringliteral">"4"</font>
00314           || <a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()
00315         )
00316         result = <a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>(message.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00317     }
00318     <font class="keywordflow">else</font>
00319     {
00320       <font class="keywordflow">try</font>
00321       {
00322         <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a5">toApp</a>(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00323         <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()) result = <a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>(message.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00324       }
00325       <font class="keywordflow">catch</font>(<a class="code" href="struct_f_i_x_1_1_do_not_send.html">DoNotSend</a>&amp;) {}
00326     }
00327 
00328     <font class="keywordflow">if</font>(!msgSeqNum)
00329     {
00330       <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a1">set</a>(message);
00331       <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a8">incrNextSenderMsgSeqNum</a>();
00332     }
00333     <font class="keywordflow">return</font> result;
00334   }
00335 
<a name="l00336"></a><a class="code" href="class_f_i_x_1_1_session.html#a19">00336</a>   <font class="keywordtype">void</font> Session::disconnect()
00337   {
00338     <font class="keywordflow">if</font>(m_pResponder)
00339     {
00340       <a class="code" href="class_f_i_x_1_1_session.html#o1">m_pResponder</a>-&gt;<a class="code" href="class_f_i_x_1_1_session_1_1_responder.html#a2">disconnect</a>();
00341       <a class="code" href="class_f_i_x_1_1_session.html#o1">m_pResponder</a> = 0;
00342     }
00343 
00344     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() || <a class="code" href="class_f_i_x_1_1_session.html#a2">sentLogon</a>())
00345     {
00346       <a class="code" href="class_f_i_x_1_1_session.html#o12">m_receivedLogon</a> = <font class="keyword">false</font>;
00347       <a class="code" href="class_f_i_x_1_1_session.html#o14">m_sentLogon</a> = <font class="keyword">false</font>;
00348       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a3">onLogout</a>(<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00349     }
00350 
00351     <a class="code" href="class_f_i_x_1_1_session.html#o13">m_sentLogout</a> = <font class="keyword">false</font>;
00352     <a class="code" href="class_f_i_x_1_1_session.html#o21">m_queue</a>.clear();
00353     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#o10">m_resetOnDisconnect</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o11">m_connected</a> ) 
00354     { <a class="code" href="class_f_i_x_1_1_session.html#o11">m_connected</a> = <font class="keyword">false</font>; <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); }
00355   }
00356 
<a name="l00357"></a><a class="code" href="class_f_i_x_1_1_session.html#c4">00357</a>   <font class="keywordtype">void</font> Session::resend( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00358   {
00359     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00360     <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00361     header.getField(sendingTime);
00362 
00363     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>(sendingTime));
00364     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a>());
00365     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00366 
00367     <font class="keywordflow">try</font>
00368     {
00369       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a5">toApp</a>(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00370       <a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>(message.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00371     }
00372     <font class="keywordflow">catch</font>(<a class="code" href="struct_f_i_x_1_1_do_not_send.html">DoNotSend</a>&amp;)
00373     {
00374       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00375       header.getField(msgSeqNum);
00376 
00377       <a class="code" href="class_f_i_x_1_1_message.html">Message</a> sequenceReset;
00378       <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00379       sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"4"</font>));
00380       sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00381       sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>(sendingTime));
00382       sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(msgSeqNum);
00383       sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a>(msgSeqNum+1));
00384       sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a>(<font class="keyword">true</font>));
00385       <a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>(sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00386     }
00387   }
00388 
<a name="l00389"></a><a class="code" href="class_f_i_x_1_1_session.html#c26">00389</a>   <font class="keywordtype">void</font> Session::generateLogon()
00390   {
00391     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logon;
00392     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"A"</font>));
00393     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a>(0));
00394     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>);
00395     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00396     <a class="code" href="class_f_i_x_1_1_session.html#o17">m_lastReceivedTime</a>.<a class="code" href="class_f_i_x_1_1_utc_time_stamp.html#a21">setCurrent</a>();
00397     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_sentLogon</a> = <font class="keyword">true</font>;
00398     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logon);
00399   }
00400 
<a name="l00401"></a><a class="code" href="class_f_i_x_1_1_session.html#c27">00401</a>   <font class="keywordtype">void</font> Session::generateLogon( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; aLogon )
00402   {
00403     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logon;
00404     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a> encryptMethod;
00405     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a111">HeartBtInt</a> heartBtInt;
00406     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a>(0));
00407     aLogon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(heartBtInt);    
00408     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"A"</font>));
00409     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(heartBtInt);
00410     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00411     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logon);
00412     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_sentLogon</a> = <font class="keyword">true</font>;
00413   }
00414 
<a name="l00415"></a><a class="code" href="class_f_i_x_1_1_session.html#c28">00415</a>   <font class="keywordtype">void</font> Session::generateResendRequest( <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>&amp; msgSeqNum )
00416   {
00417     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> resendRequest;
00418     resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"2"</font>));
00419     resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a11">BeginSeqNo</a>((<font class="keywordtype">int</font>)<a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>()));
00420     resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a20">EndSeqNo</a>(msgSeqNum - 1));
00421     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00422     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(resendRequest);
00423   }
00424 
00425   <font class="keywordtype">void</font> Session::generateSequenceReset
<a name="l00426"></a><a class="code" href="class_f_i_x_1_1_session.html#c29">00426</a>   ( <font class="keywordtype">int</font> beginSeqNo, <font class="keywordtype">int</font> endSeqNo )
00427   {
00428     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> sequenceReset;
00429     sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"4"</font>));
00430     sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00431     sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>());
00432     sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a>(endSeqNo));
00433     fill( sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00434     sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(beginSeqNo));
00435     sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a>(<font class="keyword">true</font>));
00436     sendRaw(sequenceReset, beginSeqNo);
00437   }
00438 
<a name="l00439"></a><a class="code" href="class_f_i_x_1_1_session.html#c30">00439</a>   <font class="keywordtype">void</font> Session::generateHeartbeat()
00440   {
00441     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> heartbeat;
00442     heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"0"</font>));
00443     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00444     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(heartbeat);
00445   }
00446 
<a name="l00447"></a><a class="code" href="class_f_i_x_1_1_session.html#c31">00447</a>   <font class="keywordtype">void</font> Session::generateHeartbeat( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; testRequest )
00448   {
00449     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> heartbeat;
00450     heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"0"</font>));
00451     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00452     <font class="keywordflow">try</font>
00453       {
00454         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a115">TestReqID</a> testReqID;
00455         testRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(testReqID);
00456         heartbeat.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(testReqID);
00457       }
00458     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) {}
00459 
00460     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(heartbeat);
00461   }
00462 
<a name="l00463"></a><a class="code" href="class_f_i_x_1_1_session.html#c32">00463</a>   <font class="keywordtype">void</font> Session::generateTestRequest()
00464   {
00465     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> testRequest;
00466     testRequest.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"1"</font>));
00467     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( testRequest.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00468     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a115">TestReqID</a> testReqID(<font class="stringliteral">"TEST"</font>);
00469     testRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(testReqID);
00470 
00471     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(testRequest);
00472   }
00473 
<a name="l00474"></a><a class="code" href="class_f_i_x_1_1_session.html#c33">00474</a>   <font class="keywordtype">void</font> Session::generateReject( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keywordtype">int</font> err, <font class="keywordtype">int</font> field )
00475   {
00476     std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>();
00477 
00478     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00479     reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"3"</font>));
00480     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00481     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00482     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00483     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00484     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgSeqNum);    
00485     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00486     <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00487     {
00488       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00489       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a336">SessionRejectReason</a>(err));
00490     }
00491     <font class="keywordflow">if</font>( msgType != <font class="stringliteral">"A"</font> &amp;&amp; msgType != <font class="stringliteral">"4"</font>)
00492       <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00493 
00494     <font class="keywordflow">switch</font>( err )
00495       {
00496       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a602">SessionRejectReason_INVALID_TAG_NUMBER</a>:
00497         <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, field, 
00498           <a class="code" href="namespace_f_i_x.html#a643">SessionRejectReason_INVALID_TAG_NUMBER_TEXT</a> );
00499         <font class="keywordflow">break</font>;
00500       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a603">SessionRejectReason_REQUIRED_TAG_MISSING</a>:
00501         <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, field, 
00502           <a class="code" href="namespace_f_i_x.html#a644">SessionRejectReason_REQUIRED_TAG_MISSING_TEXT</a> );
00503         <font class="keywordflow">break</font>;
00504       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a604">SessionRejectReason_TAG_NOT_DEFINED_FOR_THIS_MESSAGE_TYPE</a>:
00505         <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, field, 
00506           <a class="code" href="namespace_f_i_x.html#a645">SessionRejectReason_TAG_NOT_DEFINED_FOR_THIS_MESSAGE_TYPE_TEXT</a> );
00507         <font class="keywordflow">break</font>;
00508       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a606">SessionRejectReason_TAG_SPECIFIED_WITHOUT_A_VALUE</a>:
00509         <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, field, 
00510           <a class="code" href="namespace_f_i_x.html#a647">SessionRejectReason_TAG_SPECIFIED_WITHOUT_A_VALUE_TEXT</a> );
00511         <font class="keywordflow">break</font>;
00512       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a607">SessionRejectReason_VALUE_IS_INCORRECT</a>:
00513         <font class="keywordflow">if</font>(field)
00514         {
00515           <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, field, 
00516             <a class="code" href="namespace_f_i_x.html#a648">SessionRejectReason_VALUE_IS_INCORRECT_TEXT</a> );
00517         }
00518         <font class="keywordflow">else</font>
00519           <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, <a class="code" href="namespace_f_i_x.html#a648">SessionRejectReason_VALUE_IS_INCORRECT_TEXT</a> );
00520         <font class="keywordflow">break</font>;
00521       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a608">SessionRejectReason_INCORRECT_DATA_FORMAT_FOR_VALUE</a>:
00522         <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, field, 
00523           <a class="code" href="namespace_f_i_x.html#a649">SessionRejectReason_INCORRECT_DATA_FORMAT_FOR_VALUE_TEXT</a> );
00524         <font class="keywordflow">break</font>;
00525       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a611">SessionRejectReason_COMPID_PROBLEM</a>:
00526         <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, <a class="code" href="namespace_f_i_x.html#a652">SessionRejectReason_COMPID_PROBLEM_TEXT</a> );
00527         <font class="keywordflow">break</font>;
00528       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a612">SessionRejectReason_SENDINGTIME_ACCURACY_PROBLEM</a>:
00529         <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, <a class="code" href="namespace_f_i_x.html#a653">SessionRejectReason_SENDINGTIME_ACCURACY_PROBLEM_TEXT</a> );
00530         <font class="keywordflow">break</font>;
00531       <font class="keywordflow">case</font> <a class="code" href="namespace_f_i_x.html#a613">SessionRejectReason_E</a>:
00532         <a class="code" href="class_f_i_x_1_1_session.html#c37">populateRejectReason</a>( reject, <a class="code" href="namespace_f_i_x.html#a654">SessionRejectReason_E_TEXT</a> );
00533       };
00534 
00535     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00536   }
00537 
<a name="l00538"></a><a class="code" href="class_f_i_x_1_1_session.html#c34">00538</a>   <font class="keywordtype">void</font> Session::generateReject( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keyword">const</font> std::string&amp; str )
00539   {
00540     std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>();
00541 
00542     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00543     reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"3"</font>));
00544     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00545     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00546     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00547     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00548     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgSeqNum);
00549     <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00550       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00551     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00552 
00553     <font class="keywordflow">if</font>( msgType != <font class="stringliteral">"A"</font> &amp;&amp; msgType != <font class="stringliteral">"4"</font>)
00554       <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00555     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(str));
00556     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00557   }
00558 
<a name="l00559"></a><a class="code" href="class_f_i_x_1_1_session.html#c35">00559</a>   <font class="keywordtype">void</font> Session::generateBusinessReject( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keywordtype">int</font> err )
00560   {
00561     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00562     reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"j"</font>));
00563     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00564     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00565     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00566     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00567     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgSeqNum);
00568     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00569     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00570     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a343">BusinessRejectReason</a>(err));
00571     <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00572 
00573     <font class="keywordflow">if</font>( err == 3 )
00574       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Unsupported Message Type"</font>));
00575     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00576   }
00577 
<a name="l00578"></a><a class="code" href="class_f_i_x_1_1_session.html#c36">00578</a>   <font class="keywordtype">void</font> Session::generateLogout( <font class="keyword">const</font> std::string&amp; text )
00579   {
00580     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logout;
00581     logout.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"5"</font>));
00582     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logout.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00583     <font class="keywordflow">if</font>(text.length())
00584       logout.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(text));
00585     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logout);
00586     <a class="code" href="class_f_i_x_1_1_session.html#o13">m_sentLogout</a> = <font class="keyword">true</font>;
00587   }
00588 
<a name="l00589"></a><a class="code" href="class_f_i_x_1_1_session.html#c37">00589</a>   <font class="keywordtype">void</font> Session::populateRejectReason( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject, <font class="keywordtype">int</font> field, 
00590     <font class="keyword">const</font> std::string&amp; text )
00591   {
00592     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>() &gt;= FIX::BeginString_FIX42)
00593     {
00594       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00595       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(text)); 
00596     }
00597     <font class="keywordflow">else</font>
00598     {
00599       std::stringstream stream;;
00600       stream &lt;&lt; text &lt;&lt; <font class="stringliteral">" ("</font> &lt;&lt; field &lt;&lt; <font class="stringliteral">")"</font>;
00601       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(stream.str())); 
00602     }
00603   }
00604 
<a name="l00605"></a><a class="code" href="class_f_i_x_1_1_session.html#c38">00605</a>   <font class="keywordtype">void</font> Session::populateRejectReason( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject, <font class="keyword">const</font> std::string&amp; text )
00606   {
00607     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(text)); 
00608   }
00609 
<a name="l00610"></a><a class="code" href="class_f_i_x_1_1_session.html#c39">00610</a>   <font class="keywordtype">bool</font> Session::verify( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg, <font class="keywordtype">bool</font> checkTooHigh, 
00611                         <font class="keywordtype">bool</font> checkTooLow )
00612   {
00613     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00614     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00615     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00616     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00617     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00618 
00619     <font class="keywordflow">try</font>
00620       {
00621         <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00622         header.getField(senderCompID);
00623         header.getField(targetCompID);
00624         header.getField(sendingTime);
00625         header.getField(msgType);
00626         header.getField(msgSeqNum);
00627 
00628         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c11">validLogonState</a>(msgType) )
00629           <font class="keywordflow">throw</font> std::exception();
00630         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c6">isGoodTime</a>(sendingTime) )
00631           <a class="code" href="class_f_i_x_1_1_session.html#c13">doBadTime</a>(msg);
00632         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c10">isCorrectCompID</a>(senderCompID, targetCompID) )
00633           <a class="code" href="class_f_i_x_1_1_session.html#c14">doBadCompID</a>(msg);
00634 
00635         <font class="keywordflow">if</font>( checkTooHigh &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#c8">isTargetTooHigh</a>(msgSeqNum) )
00636           {
00637             <a class="code" href="class_f_i_x_1_1_session.html#c17">doTargetTooHigh</a>(msg);
00638             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00639           }
00640         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( checkTooLow &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#c9">isTargetTooLow</a>(msgSeqNum) )
00641           {
00642             <a class="code" href="class_f_i_x_1_1_session.html#c16">doTargetTooLow</a>(msg);
00643             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00644           }
00645 
00646         <a class="code" href="class_f_i_x_1_1_session.html#o17">m_lastReceivedTime</a>.<a class="code" href="class_f_i_x_1_1_utc_time_stamp.html#a21">setCurrent</a>();
00647       }
00648     <font class="keywordflow">catch</font>( std::exception&amp; )
00649       { <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>(); <font class="keywordflow">return</font> <font class="keyword">false</font>; }
00650 
00651     <a class="code" href="class_f_i_x_1_1_session.html#c12">fromCallback</a>(msgType, msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00652     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00653   }
00654 
<a name="l00655"></a><a class="code" href="class_f_i_x_1_1_session.html#c11">00655</a>   <font class="keywordtype">bool</font> Session::validLogonState(<font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType)
00656   {
00657     <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"A"</font> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>()
00658         || msgType != <font class="stringliteral">"A"</font> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() )
00659       <font class="keywordflow">return</font> <font class="keyword">true</font>;
00660     <font class="keywordflow">if</font>( msgType != <font class="stringliteral">"5"</font> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#a3">sentLogout</a>() )
00661       <font class="keywordflow">return</font> <font class="keyword">true</font>;
00662     <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"4"</font> ) <font class="keywordflow">return</font> <font class="keyword">true</font>;
00663     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00664   }
00665 
<a name="l00666"></a><a class="code" href="class_f_i_x_1_1_session.html#c12">00666</a>   <font class="keywordtype">void</font> Session::fromCallback(<font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg, 
00667                              <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID)
00668   {
00669     <font class="keywordflow">if</font>(Message::isAdminMsgType(msgType))
00670       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a6">fromAdmin</a>(msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00671     <font class="keywordflow">else</font>
00672       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a7">fromApp</a>(msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00673   }
00674 
<a name="l00675"></a><a class="code" href="class_f_i_x_1_1_session.html#c13">00675</a>   <font class="keywordtype">void</font> Session::doBadTime(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00676   {
00677     <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(msg, 10);
00678     <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00679   }
00680 
<a name="l00681"></a><a class="code" href="class_f_i_x_1_1_session.html#c14">00681</a>   <font class="keywordtype">void</font> Session::doBadCompID(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00682   {
00683     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() )
00684       <font class="keywordflow">throw</font> std::exception();
00685     <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(msg, 9);
00686     <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00687   }
00688 
<a name="l00689"></a><a class="code" href="class_f_i_x_1_1_session.html#c15">00689</a>   <font class="keywordtype">bool</font> Session::doPossDup(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00690   {
00691     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00692     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a> origSendingTime;
00693     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00694 
00695     <font class="keywordflow">if</font>(!header.isSetField(origSendingTime))
00696       {
00697         <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(msg, 1, origSendingTime.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>());
00698         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00699       }
00700     header.getField(origSendingTime);
00701     header.getField(sendingTime);
00702 
00703     <font class="keywordflow">if</font>(origSendingTime &gt; sendingTime)
00704       {
00705         <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(msg, 10);
00706         <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00707         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00708       }
00709     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00710   }
00711 
<a name="l00712"></a><a class="code" href="class_f_i_x_1_1_session.html#c16">00712</a>   <font class="keywordtype">bool</font> Session::doTargetTooLow(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00713   {
00714     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00715     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00716     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a> possDupFlag;
00717     header.getField(msgType);
00718     header.getField(possDupFlag);
00719 
00720     <font class="keywordflow">if</font>(!possDupFlag) <font class="keywordflow">throw</font> std::exception();
00721     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#c15">doPossDup</a>(msg);
00722   }
00723 
<a name="l00724"></a><a class="code" href="class_f_i_x_1_1_session.html#c17">00724</a>   <font class="keywordtype">void</font> Session::doTargetTooHigh(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00725   {
00726     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00727     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00728     header.getField(msgSeqNum);
00729 
00730     <a class="code" href="class_f_i_x_1_1_session.html#c0">queue</a>(msgSeqNum, msg);
00731     <a class="code" href="class_f_i_x_1_1_session.html#c28">generateResendRequest</a>(msgSeqNum);
00732   }
00733 
<a name="l00734"></a><a class="code" href="class_f_i_x_1_1_session.html#c18">00734</a>   <font class="keywordtype">void</font> Session::nextQueued()
00735   {
00736     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> msg;
00737     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00738 
00739     <font class="keywordflow">while</font>(<a class="code" href="class_f_i_x_1_1_session.html#c1">retreive</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(<a class="code" href="class_f_i_x_1_1_session.html#a21">getExpectedTargetNum</a>()), msg))
00740       {
00741         msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00742         <font class="keywordflow">if</font>(msgType != <font class="stringliteral">"A"</font>)
00743           <a class="code" href="class_f_i_x_1_1_session.html#a16">next</a>(msg.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00744       }
00745   }
00746 
<a name="l00747"></a><a class="code" href="class_f_i_x_1_1_session.html#a17">00747</a>   <font class="keywordtype">void</font> Session::next( <font class="keyword">const</font> std::string&amp; msg )
00748   {
00749     <a class="code" href="class_f_i_x_1_1_session.html#a16">next</a>(<a class="code" href="class_f_i_x_1_1_message.html">Message</a>(msg, <a class="code" href="class_f_i_x_1_1_session.html#o18">m_dataDictionary</a>));
00750   }
00751 
<a name="l00752"></a><a class="code" href="class_f_i_x_1_1_session.html#a18">00752</a>   <font class="keywordtype">void</font> Session::next( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00753   {
00754     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#o22">m_mutex</a>);
00755     <a class="code" href="class_f_i_x_1_1_session.html#o11">m_connected</a> = <font class="keyword">true</font>;
00756 
00757     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c7">checkSessionTime</a>(<a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>()))
00758     { <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); <font class="keywordflow">return</font>; }
00759 
00760     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00761     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00762     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00763     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00764 
00765     <font class="keywordflow">try</font>
00766       {
00767         message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00768         message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(beginString);
00769         message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(senderCompID);
00770         message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(targetCompID);
00771 
00772         <font class="keywordflow">if</font>(beginString != <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>())
00773           <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_unsupported_version.html">UnsupportedVersion</a>();
00774 
00775         <a class="code" href="class_f_i_x_1_1_session.html#o18">m_dataDictionary</a>.<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a30">validate</a>(message);
00776 
00777         <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"A"</font> )
00778           <a class="code" href="class_f_i_x_1_1_session.html#c19">nextLogon</a>(message);
00779         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"0"</font> )
00780           <a class="code" href="class_f_i_x_1_1_session.html#c20">nextHeartbeat</a>(message);
00781         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"1"</font> )
00782           <a class="code" href="class_f_i_x_1_1_session.html#c21">nextTestRequest</a>(message);
00783         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"4"</font> )
00784           <a class="code" href="class_f_i_x_1_1_session.html#c24">nextSequenceReset</a>(message);
00785         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"5"</font> )
00786           <a class="code" href="class_f_i_x_1_1_session.html#c22">nextLogout</a>(message);
00787         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"2"</font> )
00788           <a class="code" href="class_f_i_x_1_1_session.html#c25">nextResendRequest</a>(message);
00789         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"3"</font> )
00790           <a class="code" href="class_f_i_x_1_1_session.html#c23">nextReject</a>(message);
00791         <font class="keywordflow">else</font>
00792           {
00793             <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c39">verify</a>(message)) <font class="keywordflow">return</font>;
00794             <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00795           }
00796         <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00797       }
00798     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_message_parse_error.html">MessageParseError</a>&amp; ) {}
00799     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_required_tag_missing.html">RequiredTagMissing</a>&amp; e )
00800       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 1, e.field); }
00801     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; e )
00802       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 1, e.field); 
00803         <font class="keywordflow">if</font>(msgType == <font class="stringliteral">"A"</font>) <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>();
00804       }
00805     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_invalid_tag_number.html">InvalidTagNumber</a>&amp; e )
00806       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 0, e.field); }
00807     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_no_tag_value.html">NoTagValue</a>&amp; e )
00808       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 4, e.field); }
00809     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_tag_not_defined_for_message.html">TagNotDefinedForMessage</a>&amp; e)
00810       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 2, e.field); }
00811     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_invalid_message_type.html">InvalidMessageType</a>&amp; )
00812       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 11); }
00813     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_unsupported_message_type.html">UnsupportedMessageType</a>&amp; )
00814       { <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00815           <a class="code" href="class_f_i_x_1_1_session.html#c35">generateBusinessReject</a>(message, 3); 
00816         <font class="keywordflow">else</font>
00817           <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, <font class="stringliteral">"Unsupported message type"</font>);
00818       }
00819     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_fields_out_of_order.html">FieldsOutOfOrder</a>&amp; e )
00820       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, e.what()); }
00821     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_incorrect_data_format.html">IncorrectDataFormat</a>&amp; e )
00822       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 6, e.field); }
00823     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_incorrect_tag_value.html">IncorrectTagValue</a>&amp; e )
00824       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 5, e.field); }
00825     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>&amp; ) {}
00826     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_reject_logon.html">RejectLogon</a>&amp; ) { <a class="code" href="class_f_i_x_1_1_session.html#a19">disconnect</a>(); }
00827     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_unsupported_version.html">UnsupportedVersion</a>&amp; )
00828       {
00829         <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"5"</font> )
00830           <a class="code" href="class_f_i_x_1_1_session.html#c22">nextLogout</a>(message);
00831         <font class="keywordflow">else</font>
00832           {
00833             <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>(<font class="stringliteral">"Incorrect BeginString"</font>);
00834             <a class="code" href="class_f_i_x_1_1_session.html#o20">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00835           }
00836       }
00837   }
00838 
<a name="l00839"></a><a class="code" href="class_f_i_x_1_1_session.html#d0">00839</a>   <font class="keywordtype">bool</font> Session::sendToTarget( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00840     <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp;)
00841   {
00842     <font class="keywordflow">try</font>
00843       {
00844         <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a> sessionID = message.getSessionID();
00845         <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* pSession = lookupSession(sessionID);
00846         <font class="keywordflow">if</font>( !pSession ) <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>();
00847         <font class="keywordtype">bool</font> result = pSession-&gt;<a class="code" href="class_f_i_x_1_1_session.html#a15">send</a>(message);
00848         <font class="keywordflow">return</font> result;
00849       }
00850     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; e ) { std::cout &lt;&lt; e.field &lt;&lt; std::endl; <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>(); }
00851   }
00852 
<a name="l00853"></a><a class="code" href="class_f_i_x_1_1_session.html#d1">00853</a>   <font class="keywordtype">bool</font> Session::sendToTarget( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00854     <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp;)
00855   {
00856     message.setSessionID(sessionID);
00857     <font class="keywordflow">return</font> sendToTarget(message);
00858   }
00859 
00860   <font class="keywordtype">bool</font> Session::sendToTarget
<a name="l00861"></a><a class="code" href="class_f_i_x_1_1_session.html#d2">00861</a>   ( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>&amp; senderCompID, 
00862     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>&amp; targetCompID )
00863     <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp;)
00864   {
00865     message.getHeader().setField(senderCompID);
00866     message.getHeader().setField(targetCompID);
00867     <font class="keywordflow">return</font> sendToTarget(message);
00868   }
00869 
00870   <font class="keywordtype">bool</font> Session::sendToTarget
<a name="l00871"></a><a class="code" href="class_f_i_x_1_1_session.html#d3">00871</a>   ( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keyword">const</font> std::string&amp; sender, <font class="keyword">const</font> std::string&amp; target )
00872     <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp;)
00873   { <font class="keywordflow">return</font> sendToTarget(message, <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>(sender), <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>(target)); }
00874 
<a name="l00875"></a><a class="code" href="class_f_i_x_1_1_session.html#d4">00875</a>   <font class="keywordtype">bool</font> Session::doesSessionExist( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00876   {
00877     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00878     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( sessionID );
00879   }
00880 
<a name="l00881"></a><a class="code" href="class_f_i_x_1_1_session.html#d5">00881</a>   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::lookupSession( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00882   {
00883     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00884     Sessions::iterator find = <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( sessionID );
00885     <font class="keywordflow">if</font>( find != <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() )
00886       <font class="keywordflow">return</font> find-&gt;second;
00887     <font class="keywordflow">else</font>
00888       <font class="keywordflow">return</font> 0;
00889   }
00890 
<a name="l00891"></a><a class="code" href="class_f_i_x_1_1_session.html#d6">00891</a>   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::lookupSession( <font class="keyword">const</font> std::string&amp; string, <font class="keywordtype">bool</font> reverse )
00892   {
00893     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> message;
00894     <font class="keywordflow">if</font>( !message.<a class="code" href="class_f_i_x_1_1_message.html#a8">setStringHeader</a>(string) )
00895       <font class="keywordflow">return</font> 0;
00896 
00897     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00898     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00899     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00900     <font class="keywordflow">try</font>
00901     {
00902       message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(beginString);
00903       message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(senderCompID);
00904       message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(targetCompID);
00905     }
00906     <font class="keywordflow">catch</font>(<a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp;) { <font class="keywordflow">return</font> 0; }
00907 
00908     <font class="keywordflow">if</font>(reverse)
00909     {
00910       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#d5">lookupSession</a>(<a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>(beginString, <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>(targetCompID), 
00911                           <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>(senderCompID)));
00912     }
00913     <font class="keywordflow">else</font>
00914     {
00915       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#d5">lookupSession</a>(<a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>(beginString, senderCompID, targetCompID));
00916     }
00917   }
00918 
<a name="l00919"></a><a class="code" href="class_f_i_x_1_1_session.html#d7">00919</a>   <font class="keywordtype">bool</font> Session::isSessionRegistered( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00920   {
00921     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00922     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.find( sessionID );
00923   }
00924 
<a name="l00925"></a><a class="code" href="class_f_i_x_1_1_session.html#d8">00925</a>   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::registerSession( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00926   {
00927     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00928     <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* pSession = <a class="code" href="class_f_i_x_1_1_session.html#d5">lookupSession</a>(sessionID);
00929     <font class="keywordflow">if</font>(pSession == 0) <font class="keywordflow">return</font> 0;
00930     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#d7">isSessionRegistered</a>(sessionID)) <font class="keywordflow">return</font> 0;
00931     <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>[sessionID] = pSession;
00932     <font class="keywordflow">return</font> pSession;
00933   }
00934 
<a name="l00935"></a><a class="code" href="class_f_i_x_1_1_session.html#d9">00935</a>   <font class="keywordtype">void</font> Session::unregisterSession( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00936   {
00937     <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.erase(sessionID);
00938   }
00939 
<a name="l00940"></a><a class="code" href="class_f_i_x_1_1_session.html#d10">00940</a>   <font class="keywordtype">int</font> Session::numSessions()
00941   {
00942     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00943     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.size();
00944   }
00945 
<a name="l00946"></a><a class="code" href="class_f_i_x_1_1_session.html#f0">00946</a>   <font class="keywordtype">bool</font> Session::addSession( <a class="code" href="class_f_i_x_1_1_session.html">Session</a>&amp; s )
00947   {
00948     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00949     Sessions::iterator it = <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( s.<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a> );
00950     <font class="keywordflow">if</font> (it == <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end())
00951       {
00952         <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>[s.<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>] = &amp;s;
00953         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00954       }
00955     <font class="keywordflow">else</font>
00956       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00957   }
00958 
<a name="l00959"></a><a class="code" href="class_f_i_x_1_1_session.html#f1">00959</a>   <font class="keywordtype">void</font> Session::removeSession( <a class="code" href="class_f_i_x_1_1_session.html">Session</a>&amp; s )
00960   {
00961     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00962     <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a> );
00963     <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a> );
00964   }
00965 
<a name="l00966"></a><a class="code" href="class_f_i_x_1_1_session.html#d11">00966</a>   <font class="keywordtype">bool</font> Session::isSessionTime(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; start, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; end,
00967                               <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time )
00968   {
00969     <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a> timeOnly(time);
00970 
00971     <font class="keywordflow">if</font>(start &lt; end)
00972       <font class="keywordflow">return</font>( timeOnly &gt;= start &amp;&amp; timeOnly &lt;= end );
00973     <font class="keywordflow">else</font>
00974       <font class="keywordflow">return</font>( timeOnly &gt;= start || timeOnly &lt;= end );
00975   }
00976 
<a name="l00977"></a><a class="code" href="class_f_i_x_1_1_session.html#d12">00977</a>   <font class="keywordtype">bool</font> Session::isSameSession(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; start, 
00978                               <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; end,
00979                               <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time1, 
00980                               <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time2 )
00981   {
00982     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>(start, end, time1)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00983     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>(start, end, time2)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00984 
00985     <font class="keywordflow">if</font>(time1 == time2) <font class="keywordflow">return</font> <font class="keyword">true</font>;
00986 
00987     <a class="code" href="class_f_i_x_1_1_utc_date.html">UtcDate</a> time1Date(time1);
00988     <a class="code" href="class_f_i_x_1_1_utc_date.html">UtcDate</a> time2Date(time2);
00989 
00990     <font class="keywordflow">if</font>(start &lt; end)
00991       <font class="keywordflow">return</font> time1Date == time2Date;
00992     <font class="keywordflow">else</font>
00993       <font class="keywordflow">return</font> abs(time1Date - time2Date) &lt;= 1;
00994       
00995     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00996   }
00997 
<a name="l00998"></a><a class="code" href="class_f_i_x_1_1_session.html#c0">00998</a>   <font class="keywordtype">void</font> Session::queue( <font class="keywordtype">int</font> msgSeqNum, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00999   {
01000     <a class="code" href="class_f_i_x_1_1_session.html#o21">m_queue</a>[msgSeqNum] = message;
01001   }
01002 
<a name="l01003"></a><a class="code" href="class_f_i_x_1_1_session.html#c1">01003</a>   <font class="keywordtype">bool</font> Session::retreive( <font class="keywordtype">int</font> msgSeqNum, <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
01004   {
01005     Messages::iterator i = <a class="code" href="class_f_i_x_1_1_session.html#o21">m_queue</a>.find(msgSeqNum);
01006     <font class="keywordflow">if</font>( i != <a class="code" href="class_f_i_x_1_1_session.html#o21">m_queue</a>.end() )
01007       {
01008         message = i-&gt;second;
01009         <a class="code" href="class_f_i_x_1_1_session.html#o21">m_queue</a>.erase(i);
01010         <font class="keywordflow">return</font> <font class="keyword">true</font>;
01011       }
01012     <font class="keywordflow">return</font> <font class="keyword">false</font>;
01013   }
01014 }
</pre></div><hr><address><small>
Generated on Wed Aug 7 16:06:38 2002 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.2.16 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
