#!/bin/sh
# -*- coding: utf-8 -*-
# Copyright (C) 2013 Laboratoire de Recherche et DÃ©veloppement
# de l'Epita (LRDE).
#
# This file is part of Spot, a model checking library.
#
# Spot is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# Spot is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
# License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

. ./defs
set -e

ltl2tgba=../../bin/ltl2tgba

cat >formulas <<'EOF'
1,14,X((a M F((!b & !c) | (b & c))) W (G!c U b))
1,5,X(((a & b) R (!a U !c)) R b)
1,10,XXG(Fa U Xb)
1,5,(!a M !b) W F!c
1,3,(b & Fa & GFc) R a
1,2,(a R (b W a)) W G(!a M (b | c))
1,11,(Fa W b) R (!a | Fc)
1,7,X(G(!a M !b) | G(a | G!a))
1,2,Fa W Gb
1,3,Ga | GFb
1,9,G((G!a & ((!b & X!c) | (b & Xc))) | (Fa & ((!b & Xc) | (b & X!c))))
1,5,a M G(F!b | X!a)
1,4,G!a R XFb
1,4,XF(!a | GFb)
1,6,G(F!a U !a) U Xa
1,5,(a | G(a M !b)) W Fc
1,6,Fa W Xb
1,10,X(a R ((!b & F!c) M X!a))
1,2,XG!a R Fb
1,4,GFc | (a & Fb)
1,6,X(a R (Fb R F!b))
1,2,G(Xa M Fa)
1,4,X(Gb | GFa)
1,9,X(Gc | XG((b & Ga) | (!b & F!a)))
1,2,Ga R Fb
1,3,G(a U (b | X((!a & !c) | (a & c))))
1,5,XG((G!a & F!b) | (Fa & (a | Gb)))
1,10,(a U X!a) | XG(!b & XFc)
1,4,X(G!a | GFa)
1,4,G(G!a | F!c | G!b)
EOF

$ltl2tgba -x tba-det --det --stats '%d,%s,%f' -F formulas/3 > out
diff formulas out

cat >in.tgba <<'EOF'
acc = "1";
"1", "2", "a", "1";
"1", "1", "!a",;
"2", "3", "a", "1";
"2", "1", "!a",;
"3", "3", "a",;
"3", "1", "!a",;
EOF

# FIXME: we should improve this output
cat >ex.tgba <<'EOF'
acc = "1";
"1", "2", "a",;
"1", "1", "!a",;
"1", "-1", "!a",;
"2", "3", "a",;
"2", "1", "!a",;
"2", "-1", "!a",;
"-1", "-1", "!a", "1";
"3", "3", "a",;
"3", "-3", "a",;
"3", "1", "!a",;
"3", "-1", "!a",;
"-3", "-3", "a", "1";
"-3", "-1", "!a", "1";
EOF

run 0 ../ltl2tgba -b -DC -X in.tgba > out.tgba
diff out.tgba ex.tgba


run 0 ../ltl2tgba -x -DC 'GFa & XGFb' > out.tgba
cat >ex.tgba <<EOF
digraph G {
  0 [label="", style=invis, height=0]
  0 -> 1
  1 [label="1"]
  1 -> 2 [label="1\n"]
  2 [label="2"]
  2 -> 2 [label="1\n"]
  2 -> 3 [label="!a\n"]
  2 -> 4 [label="!b\n"]
  3 [label="-4"]
  3 -> 3 [label="!a\n{Acc[1]}"]
  4 [label="-3"]
  4 -> 4 [label="!b\n{Acc[1]}"]
}
EOF
diff out.tgba ex.tgba
