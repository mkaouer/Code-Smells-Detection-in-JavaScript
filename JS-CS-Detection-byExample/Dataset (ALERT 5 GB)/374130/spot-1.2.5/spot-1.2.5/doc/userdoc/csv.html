<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Reading and writing CSV files</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="Reading and writing CSV files"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-08-21T17:43+0200"/>
<meta name="author" content="Alexandre Duret-Lutz"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="syntax.css" />
<link rel="stylesheet" type="text/css" href="http://spot.lip6.fr/css/spot-zenburn.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="org-div-home-and-up" style="text-align:center;white-space:nowrap;">
 <a accesskey="h" href="tools.html">UP</a> | <a accesskey="H" href="tools.html">HOME</a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Reading and writing CSV files</h1>

<p>This page discusses features available in Spot's command-line
tools to produce an consume CSV files.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Producing CSV files</a></li>
<li><a href="#sec-2">Reading CSV files</a></li>
<li><a href="#sec-3">Dealing with header lines</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Producing CSV files</h2>
<div class="outline-text-2" id="text-1">


<p>
All the tools that normally produce formulas (like <a href="genltl.html"><code>genltl</code></a>, <a href="randltl.html"><code>randltl</code></a>,
and <a href="ltlfilt.html"><code>ltlfilt</code></a>) have a <a href="ioltl.html"><code>&ndash;format</code> option</a>.  That can be used to
customize the way output is formatted.
</p>
<p>
For instance here is how we could use <code>genltl</code> to generate a CSV file
with three columns: the family name of the formula, its parameter, and
the formula itself.
</p>



<pre class="src src-sh">genltl --and-gf=1..5 --u-left=1..5 --format=<span class="org-string">'%F,%L,%f'</span> &gt; gen.csv
cat gen.csv
</pre>


<pre class="example">and-gf,1,GFp1
and-gf,2,GFp1 &amp; GFp2
and-gf,3,GFp1 &amp; GFp2 &amp; GFp3
and-gf,4,GFp1 &amp; GFp2 &amp; GFp3 &amp; GFp4
and-gf,5,GFp1 &amp; GFp2 &amp; GFp3 &amp; GFp4 &amp; GFp5
u-left,1,p1
u-left,2,p1 U p2
u-left,3,(p1 U p2) U p3
u-left,4,((p1 U p2) U p3) U p4
u-left,5,(((p1 U p2) U p3) U p4) U p5
</pre>


<p>
Tools that produce automata (like <a href="ltl2tgba.html"><code>ltl2tgba</code></a>, or <a href="dstar2tgba.html"><code>dstar2tgba</code></a>) have a
<code>--stats</code> option that can be used to output various statistics about
the constructed automaton (these statistics are shown <b>instead</b> of
printing the automaton).
</p>
<p>
For instance, the following command will translate all the previous
formulas, and show the resulting number of states (<code>%s</code>) and edges
(<code>%e</code>) of the automaton constructed for each formula.
</p>



<pre class="src src-sh">genltl --and-gf=1..5 --u-left=1..5 | ltl2tgba -F- --stats <span class="org-string">'%f,%s,%e'</span>
</pre>


<pre class="example">GFp1,1,2
G(Fp1 &amp; Fp2),1,4
G(Fp1 &amp; Fp2 &amp; Fp3),1,8
G(Fp1 &amp; Fp2 &amp; Fp3 &amp; Fp4),1,16
G(Fp1 &amp; Fp2 &amp; Fp3 &amp; Fp4 &amp; Fp5),1,32
p1,2,2
p1 U p2,2,3
(p1 U p2) U p3,4,10
((p1 U p2) U p3) U p4,8,34
(((p1 U p2) U p3) U p4) U p5,16,116
</pre>


<p>
If the translated formulas may contain commas, or double-quotes, this
simple output may prove difficult to process by other tools.  For
instance consider the translation of the following two formulas:
</p>



<pre class="src src-sh">ltl2tgba -f Xa -f <span class="org-string">'G("switch == on" -&gt; F"tab[3,5] &lt; 12")'</span> --stats <span class="org-string">'%f,%s,%e'</span>
</pre>

<pre class="example">
Xa,3,3
G(!"switch == on" | F"tab[3,5] &lt; 12"),2,4
</pre>


<p>
The second line of this input does no conform to <a href="https://www.rfc-editor.org/rfc/rfc4180.txt">RFC 4180</a> because
non-escaped fields are not allowed to contain comma or double-quotes.
To fix this, use <code>ltl2tgba</code>'s <code>--csv-escape</code> option: this causes
"<code>%f</code>" to produce a double-quoted string properly escaped.
</p>



<pre class="src src-sh">ltl2tgba -f Xa -f <span class="org-string">'G("switch == on" -&gt; F"tab[3,5] &lt; 12")'</span> --stats <span class="org-string">'%f,%s,%e'</span> --csv-escape
</pre>


<pre class="example">
"Xa",3,3
"G(!""switch == on"" | F""tab[3,5] &lt; 12"")",2,4
</pre>



<p>
The tool <a href="ltlcross.html"><code>ltlcross</code></a> has its own <code>--csv=FILENAME</code> option to format the
statistics it gathers in a CSV file, but you have very little control
hover how this CSV file is formatted (it can only be changed
via option such as <code>--products</code> or <code>--omit-missing</code>).
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Reading CSV files</h2>
<div class="outline-text-2" id="text-2">


<p>
All the tools that read formulas from files extend the filename syntax
to support the specification of a CSV column.  The notation
<code>filename/COL</code> denotes the column <code>COL</code> of that file.
</p>
<p>
For instance let's consider the file <code>gen.csv</code> built with the first command of
this page.  It contains:
</p>




<pre class="example">and-gf,1,GFp1
and-gf,2,GFp1 &amp; GFp2
and-gf,3,GFp1 &amp; GFp2 &amp; GFp3
and-gf,4,GFp1 &amp; GFp2 &amp; GFp3 &amp; GFp4
and-gf,5,GFp1 &amp; GFp2 &amp; GFp3 &amp; GFp4 &amp; GFp5
u-left,1,p1
u-left,2,p1 U p2
u-left,3,(p1 U p2) U p3
u-left,4,((p1 U p2) U p3) U p4
u-left,5,(((p1 U p2) U p3) U p4) U p5
</pre>


<p>
We can run <code>ltl2tgba</code> on the third column to produce
the same output as in a previous example:
</p>



<pre class="src src-sh">ltl2tgba -F gen.csv/3 --stats <span class="org-string">'%f,%s,%e'</span>
</pre>


<pre class="example">GFp1,1,2
G(Fp1 &amp; Fp2),1,4
G(Fp1 &amp; Fp2 &amp; Fp3),1,8
G(Fp1 &amp; Fp2 &amp; Fp3 &amp; Fp4),1,16
G(Fp1 &amp; Fp2 &amp; Fp3 &amp; Fp4 &amp; Fp5),1,32
p1,2,2
p1 U p2,2,3
(p1 U p2) U p3,4,10
((p1 U p2) U p3) U p4,8,34
(((p1 U p2) U p3) U p4) U p5,16,116
</pre>


<p>
When <code>ltlfilt</code> is used on a CSV file, it will preserve the
text before and after the matched formula in the CSV file.
For instance:
</p>



<pre class="src src-sh">ltlfilt -F gen.csv/3 --size-min=8 --relabel=abc
</pre>

<pre class="example">
and-gf,3,GFa &amp; GFb &amp; GFc
and-gf,4,GFa &amp; GFb &amp; GFc &amp; GFd
and-gf,5,GFa &amp; GFb &amp; GFc &amp; GFd &amp; GFe
u-left,5,(((a U b) U c) U d) U e
</pre>


<p>
For security, in case a formula may contain double-quotes or
commas, you should use the <code>--csv-escape</code> option:
</p>



<pre class="src src-sh">ltlfilt -F gen.csv/3 --size-min=8 --relabel=abc --csv-escape
</pre>

<pre class="example">
and-gf,3,"GFa &amp; GFb &amp; GFc"
and-gf,4,"GFa &amp; GFb &amp; GFc &amp; GFd"
and-gf,5,"GFa &amp; GFb &amp; GFc &amp; GFd &amp; GFe"
u-left,5,"(((a U b) U c) U d) U e"
</pre>


<p>
The preservation in the output of the text before and after the
selected column can be altered using the <code>--format</code> option.  The <code>%&lt;</code>
escape sequence represent the (comma-separated) data of all the
columns before the selected column, and <code>%&gt;</code> is the same for the
trailing data.  Note that the comma that separate formulas' column
from the other column are excluded and should be added in the format
string.
</p>
<p>
For instance this moves the first two columns after the formulas.
</p>



<pre class="src src-sh">ltlfilt -F gen.csv/3 --size-min=8 --csv-escape --format=<span class="org-string">'%f,%&lt;'</span>
</pre>

<pre class="example">
"GFp1 &amp; GFp2 &amp; GFp3",and-gf,3
"GFp1 &amp; GFp2 &amp; GFp3 &amp; GFp4",and-gf,4
"GFp1 &amp; GFp2 &amp; GFp3 &amp; GFp4 &amp; GFp5",and-gf,5
"(((p1 U p2) U p3) U p4) U p5",u-left,5
</pre>



<p>
Typical uses of <code>ltlfilt</code> on CSV file include:
</p><ul>
<li>Filtering lines based on an LTL criterion, as above.
</li>
<li>Changing the syntax of LTL formulas.  For instance <code>ltl2tgba</code>'s
  <code>--stats</code> option, and <code>ltlcross</code>'s <code>--csv</code> option always output
  formulas in Spot's format.  If that is inappropriate, simply
  use <code>ltlfilt</code> to rewrite the relevant column in your prefered
  syntax.
</li>
</ul>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Dealing with header lines</h2>
<div class="outline-text-2" id="text-3">


<p>
Some CSV contain a header lines that should not be processed.
The CSV file produced by <code>ltlcross</code> have such a line:
</p>



<pre class="src src-sh">randltl -n 2 a b | ltlfilt --remove-wm |
  ltlcross --csv=results.csv <span class="org-string">'ltl2tgba -s %f &gt;%N'</span> <span class="org-string">'ltl3ba -f %s &gt;%N'</span>
cat results.csv
</pre>

<pre class="example">
"formula","tool","exit_status","exit_code","time","states","edges","transitions","acc","scc","nonacc_scc","terminal_scc","weak_scc","strong_scc","nondet_states","nondet_aut","terminal_aut","weak_aut","strong_aut","product_states","product_transitions","product_scc"
"(1)","ltl2tgba -s %f &gt;%N","ok",0,0.0278263,1,1,1,1,1,0,1,0,0,0,0,1,0,0,200,3994,1
"(1)","ltl3ba -f %s &gt;%N","ok",0,0.0707275,1,1,1,1,1,0,1,0,0,0,0,1,0,0,200,3994,1
"(0)","ltl2tgba -s %f &gt;%N","ok",0,0.0425456,1,1,0,1,1,1,0,0,0,0,0,1,0,0,1,0,1
"(0)","ltl3ba -f %s &gt;%N","ok",0,0.00508576,1,0,0,1,1,1,0,0,0,0,0,1,0,0,1,0,1
"(G((0) R (F((b) -&gt; (X(a))))))","ltl2tgba -s %f &gt;%N","ok",0,0.0434527,2,4,8,1,1,0,0,0,1,0,0,0,0,1,399,8156,1
"(G((0) R (F((b) -&gt; (X(a))))))","ltl3ba -f %s &gt;%N","ok",0,0.00536754,3,9,25,1,1,0,0,0,1,3,1,0,0,1,600,25665,1
"(!(G((0) R (F((b) -&gt; (X(a)))))))","ltl2tgba -s %f &gt;%N","ok",0,0.0356183,2,3,6,1,2,1,0,1,0,1,1,0,1,0,399,6170,2
"(!(G((0) R (F((b) -&gt; (X(a)))))))","ltl3ba -f %s &gt;%N","ok",0,0.00470727,2,3,7,1,2,1,0,1,0,1,1,0,1,0,400,7118,3
</pre>


<p>
If we run <code>ltlfilt</code> on the first column, it will process the <code>formula</code>
header as if it was an LTL formula.
</p>



<pre class="src src-sh">ltlfilt -F results.csv/1 --format=<span class="org-string">'%f'</span> --unique
</pre>


<pre class="example">
formula
1
0
G(0 R F(b -&gt; Xa))
!G(0 R F(b -&gt; Xa))
</pre>


<p>
In such case, the syntax <code>FILENAME/-COL</code> (with a minus sign before the
column number) can be used to discard the first line of a CSV file.
</p>



<pre class="src src-sh">ltlfilt -F results.csv/-1 --format=<span class="org-string">'%f'</span> --unique
</pre>


<pre class="example">
1
0
G(0 R F(b -&gt; Xa))
!G(0 R F(b -&gt; Xa))
</pre>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2014-08-21T17:43+0200</p>
<p class="author">Author: Alexandre Duret-Lutz</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
