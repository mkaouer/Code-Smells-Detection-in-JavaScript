<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>D:/release/quickfix/src/C++/Session.cpp Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.16 -->
<h1>D:/release/quickfix/src/C++/Session.cpp</h1><a href="_session_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* ====================================================================</font>
00002 <font class="comment"> * The QuickFIX Software License, Version 1.0</font>
00003 <font class="comment"> *</font>
00004 <font class="comment"> * Copyright (c) 2001 ThoughtWorks, Inc.  All rights</font>
00005 <font class="comment"> * reserved.</font>
00006 <font class="comment"> *</font>
00007 <font class="comment"> * Redistribution and use in source and binary forms, with or without</font>
00008 <font class="comment"> * modification, are permitted provided that the following conditions</font>
00009 <font class="comment"> * are met:</font>
00010 <font class="comment"> *</font>
00011 <font class="comment"> * 1. Redistributions of source code must retain the above copyright</font>
00012 <font class="comment"> *    notice, this list of conditions and the following disclaimer.</font>
00013 <font class="comment"> *</font>
00014 <font class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</font>
00015 <font class="comment"> *    notice, this list of conditions and the following disclaimer in</font>
00016 <font class="comment"> *    the documentation and/or other materials provided with the</font>
00017 <font class="comment"> *    distribution.</font>
00018 <font class="comment"> *</font>
00019 <font class="comment"> * 3. The end-user documentation included with the redistribution,</font>
00020 <font class="comment"> *    if any, must include the following acknowledgment:</font>
00021 <font class="comment"> *       "This product includes software developed by</font>
00022 <font class="comment"> *        ThoughtWorks, Inc. (http://www.thoughtworks.com/)."</font>
00023 <font class="comment"> *    Alternately, this acknowledgment may appear in the software itself,</font>
00024 <font class="comment"> *    if and wherever such third-party acknowledgments normally appear.</font>
00025 <font class="comment"> *</font>
00026 <font class="comment"> * 4. The names "QuickFIX" and "ThoughtWorks, Inc." must</font>
00027 <font class="comment"> *    not be used to endorse or promote products derived from this</font>
00028 <font class="comment"> *    software without prior written permission. For written</font>
00029 <font class="comment"> *    permission, please contact quickfix-users@lists.sourceforge.net.</font>
00030 <font class="comment"> *</font>
00031 <font class="comment"> * 5. Products derived from this software may not be called "QuickFIX",</font>
00032 <font class="comment"> *    nor may "QuickFIX" appear in their name, without prior written</font>
00033 <font class="comment"> *    permission of ThoughtWorks, Inc.</font>
00034 <font class="comment"> *</font>
00035 <font class="comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</font>
00036 <font class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</font>
00037 <font class="comment"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</font>
00038 <font class="comment"> * DISCLAIMED.  IN NO EVENT SHALL THOUGHTWORKS INC OR</font>
00039 <font class="comment"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</font>
00040 <font class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</font>
00041 <font class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</font>
00042 <font class="comment"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</font>
00043 <font class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</font>
00044 <font class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</font>
00045 <font class="comment"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</font>
00046 <font class="comment"> * SUCH DAMAGE.</font>
00047 <font class="comment"> * ====================================================================</font>
00048 <font class="comment"> */</font>
00049 
00050 <font class="preprocessor">#ifdef _MSC_VER</font>
00051 <font class="preprocessor"></font><font class="preprocessor">#pragma warning( disable : 4503 4355 4786 )</font>
00052 <font class="preprocessor"></font><font class="preprocessor">#include "stdafx.h"</font>
00053 <font class="preprocessor">#else</font>
00054 <font class="preprocessor"></font><font class="preprocessor">#include "config.h"</font>
00055 <font class="preprocessor">#endif</font>
00056 <font class="preprocessor"></font>
00057 <font class="preprocessor">#include "<a class="code" href="_session_8h.html">Session.h</a>"</font>
00058 <font class="preprocessor">#include "<a class="code" href="_values_8h.html">Values.h</a>"</font>
00059 <font class="preprocessor">#include &lt;algorithm&gt;</font>
00060 <font class="preprocessor">#include &lt;iostream&gt;</font>
00061 
00062 <font class="keyword">namespace </font>FIX
00063 {
<a name="l00064"></a><a class="code" href="class_f_i_x_1_1_session.html#r0">00064</a>   Session::Sessions Session::s_sessions;
<a name="l00065"></a><a class="code" href="class_f_i_x_1_1_session.html#r1">00065</a>   Session::Sessions Session::s_registered;
<a name="l00066"></a><a class="code" href="class_f_i_x_1_1_session.html#r2">00066</a>   <a class="code" href="class_f_i_x_1_1_mutex.html">Mutex</a> Session::s_mutex;
00067 
<a name="l00068"></a><a class="code" href="class_f_i_x_1_1_session.html#a0">00068</a>   Session::Session( <a class="code" href="class_f_i_x_1_1_application.html">Application</a>&amp; application,
00069                     <a class="code" href="class_f_i_x_1_1_message_store_factory.html">MessageStoreFactory</a>&amp; factory,
00070                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID,
00071                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_data_dictionary.html">DataDictionary</a>&amp; dataDictionary,
00072                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; startTime,
00073                     <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; endTime,
00074                     <font class="keywordtype">int</font> heartBtInt )
00075   : m_application(application), m_pResponder(0),
00076     m_sessionID(sessionID), m_heartBtInt(heartBtInt),
00077     m_startTime(startTime), m_endTime(endTime),
00078     m_receivedLogon(false), m_sentLogout(false), m_sentLogon(false),
00079     m_dataDictionary(dataDictionary), m_factory(factory)
00080   {
00081     <a class="code" href="class_f_i_x_1_1_session.html#o9">m_initiate</a> = (heartBtInt != 0);
00082     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a> = <a class="code" href="class_f_i_x_1_1_session.html#o13">m_factory</a>.<a class="code" href="class_f_i_x_1_1_message_store_factory.html#a1">create</a>(sessionID);
00083 
00084     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> creationTime = <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a10">getCreationTime</a>();
00085     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00086 
00087     <font class="keywordflow">if</font>(creationTime &gt; now ||
00088       !<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>(startTime, endTime, now) ||
00089       !<a class="code" href="class_f_i_x_1_1_session.html#d11">isSameSession</a>(startTime, endTime, now, creationTime))
00090     {
00091       <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>();
00092     }
00093 
00094     <a class="code" href="class_f_i_x_1_1_session.html#f0">addSession</a>(*<font class="keyword">this</font>);
00095   }
00096 
<a name="l00097"></a><a class="code" href="class_f_i_x_1_1_session.html#a1">00097</a>   Session::~Session()
00098   {
00099     <a class="code" href="class_f_i_x_1_1_session.html#f1">removeSession</a>(*<font class="keyword">this</font>);
00100     <a class="code" href="class_f_i_x_1_1_session.html#o13">m_factory</a>.<a class="code" href="class_f_i_x_1_1_message_store_factory.html#a2">destroy</a>(<a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>);
00101   }
00102 
<a name="l00103"></a><a class="code" href="class_f_i_x_1_1_session.html#c5">00103</a>   <font class="keywordtype">void</font> Session::fill( <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header )
00104   {
00105     <a class="code" href="class_f_i_x_1_1_session.html#o10">m_lastSentTime</a>.<a class="code" href="class_f_i_x_1_1_utc_time_stamp.html#a21">setCurrent</a>();
00106     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>() );
00107     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a2">getSenderCompID</a>() );
00108     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a3">getTargetCompID</a>() );
00109     header.setField( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(<a class="code" href="class_f_i_x_1_1_session.html#a15">getExpectedSenderNum</a>()) );
00110     header.setField( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a>() );
00111   }
00112 
<a name="l00113"></a><a class="code" href="class_f_i_x_1_1_session.html#a11">00113</a>   <font class="keywordtype">void</font> Session::next()
00114   {
00115     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#o16">m_mutex</a>);
00116 
00117     <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00118     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c7">checkSessionTime</a>(now))
00119     { <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); <font class="keywordflow">return</font>; }
00120     
00121     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() )
00122       {
00123         <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o9">m_initiate</a> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogon</a>)
00124             <a class="code" href="class_f_i_x_1_1_session.html#c26">generateLogon</a>();
00125         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o9">m_initiate</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogon</a>)
00126           {
00127             <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a> now;
00128             <font class="keywordflow">if</font>(now - <a class="code" href="class_f_i_x_1_1_session.html#o11">m_lastReceivedTime</a> &gt;= 10)
00129               <a class="code" href="class_f_i_x_1_1_session.html#a14">disconnect</a>();
00130           }
00131         <font class="keywordflow">return</font>;
00132       }
00133 
00134     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a> == 0 ) <font class="keywordflow">return</font>;
00135     
00136     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o7">m_sentLogout</a> &amp;&amp; (now - <a class="code" href="class_f_i_x_1_1_session.html#o11">m_lastReceivedTime</a> &gt;= 2))
00137       <a class="code" href="class_f_i_x_1_1_session.html#a14">disconnect</a>();
00138 
00139     <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o10">m_lastSentTime</a>) &lt; <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>) <font class="keywordflow">return</font>;
00140 
00141     <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o11">m_lastReceivedTime</a>) &gt;= (5 * <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>))
00142       <a class="code" href="class_f_i_x_1_1_session.html#a14">disconnect</a>();
00143     <font class="keywordflow">else</font>
00144       <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o11">m_lastReceivedTime</a>) &gt;= (1.2 * <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>))
00145         <a class="code" href="class_f_i_x_1_1_session.html#c32">generateTestRequest</a>();
00146       <font class="keywordflow">else</font>
00147         <a class="code" href="class_f_i_x_1_1_session.html#c30">generateHeartbeat</a>();
00148   }
00149 
<a name="l00150"></a><a class="code" href="class_f_i_x_1_1_session.html#c19">00150</a>   <font class="keywordtype">void</font> Session::nextLogon( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; logon )
00151   {
00152     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#o9">m_initiate</a> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogon</a> )
00153       { <a class="code" href="class_f_i_x_1_1_session.html#a14">disconnect</a>(); <font class="keywordflow">return</font>; }
00154 
00155     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00156     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00157     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(senderCompID);
00158     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(targetCompID);
00159 
00160     <font class="keywordtype">bool</font> verified = <a class="code" href="class_f_i_x_1_1_session.html#c37">verify</a>(logon, <font class="keyword">false</font>, <font class="keyword">true</font>);
00161     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#c10">isCorrectCompID</a>(senderCompID, targetCompID))
00162       <a class="code" href="class_f_i_x_1_1_session.html#o6">m_receivedLogon</a> = <font class="keyword">true</font>;
00163     <font class="keywordflow">if</font>(!verified) <font class="keywordflow">return</font>;
00164 
00165     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#o9">m_initiate</a> )
00166       {
00167         logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(<a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>);
00168         <a class="code" href="class_f_i_x_1_1_session.html#c26">generateLogon</a>(logon);
00169       }
00170 
00171     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00172     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgSeqNum);
00173     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#c8">isTargetTooHigh</a>(msgSeqNum) )
00174       {
00175         <a class="code" href="class_f_i_x_1_1_session.html#c17">doTargetTooHigh</a>(logon);
00176       }
00177     <font class="keywordflow">else</font>
00178       {
00179         <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00180         <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00181       }
00182  
00183     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()) 
00184       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a2">onLogon</a>(<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00185   }
00186 
<a name="l00187"></a><a class="code" href="class_f_i_x_1_1_session.html#c20">00187</a>   <font class="keywordtype">void</font> Session::nextHeartbeat( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; heartbeat )
00188   {
00189     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c37">verify</a>(heartbeat) ) <font class="keywordflow">return</font>;
00190     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00191     <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00192   }
00193 
<a name="l00194"></a><a class="code" href="class_f_i_x_1_1_session.html#c21">00194</a>   <font class="keywordtype">void</font> Session::nextTestRequest( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; testRequest )
00195   {
00196     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c37">verify</a>(testRequest) ) <font class="keywordflow">return</font>;
00197     <a class="code" href="class_f_i_x_1_1_session.html#c30">generateHeartbeat</a>( testRequest );
00198     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00199     <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00200   }
00201 
<a name="l00202"></a><a class="code" href="class_f_i_x_1_1_session.html#c22">00202</a>   <font class="keywordtype">void</font> Session::nextLogout( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; logout )
00203   {
00204     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c37">verify</a>(logout, <font class="keyword">false</font>, <font class="keyword">false</font>) ) <font class="keywordflow">return</font>;
00205     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a3">sentLogout</a>() ) <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00206     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00207     <a class="code" href="class_f_i_x_1_1_session.html#a14">disconnect</a>();
00208   }
00209 
<a name="l00210"></a><a class="code" href="class_f_i_x_1_1_session.html#c23">00210</a>   <font class="keywordtype">void</font> Session::nextReject( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; reject )
00211   {
00212     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c37">verify</a>(reject) ) <font class="keywordflow">return</font>;
00213     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00214     <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00215   }
00216 
<a name="l00217"></a><a class="code" href="class_f_i_x_1_1_session.html#c24">00217</a>   <font class="keywordtype">void</font> Session::nextSequenceReset( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; sequenceReset )
00218   {
00219     <font class="keywordtype">bool</font> isGapFill = <font class="keyword">false</font>;
00220     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a> gapFillFlag;
00221     <font class="keywordflow">if</font>( sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a12">isSetField</a>(gapFillFlag) )
00222       {
00223         sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(gapFillFlag);
00224         isGapFill = gapFillFlag;
00225       }
00226 
00227     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c37">verify</a>(sequenceReset, isGapFill, isGapFill) ) <font class="keywordflow">return</font>;
00228 
00229     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a> newSeqNo;
00230     <font class="keywordflow">if</font>(sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a12">isSetField</a>(newSeqNo))
00231       {
00232         sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(newSeqNo);
00233         <font class="keywordflow">if</font>( newSeqNo &gt; <a class="code" href="class_f_i_x_1_1_session.html#a16">getExpectedTargetNum</a>() )
00234           <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a7">setNextTargetMsgSeqNum</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(newSeqNo));
00235         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( newSeqNo &lt; <a class="code" href="class_f_i_x_1_1_session.html#a16">getExpectedTargetNum</a>() )
00236           <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(sequenceReset, 5);
00237       }
00238   }
00239 
<a name="l00240"></a><a class="code" href="class_f_i_x_1_1_session.html#c25">00240</a>   <font class="keywordtype">void</font> Session::nextResendRequest( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; resendRequest )
00241   {
00242     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c37">verify</a>(resendRequest, <font class="keyword">false</font>, <font class="keyword">false</font>) ) <font class="keywordflow">return</font>;
00243     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a11">BeginSeqNo</a> beginSeqNo;
00244     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a20">EndSeqNo</a> endSeqNo;
00245     resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(beginSeqNo);
00246     resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(endSeqNo);
00247     std::vector&lt;Message&gt; messages;
00248 
00249     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a2">get</a>(beginSeqNo, endSeqNo, messages))
00250       {
00251         std::vector&lt;Message&gt;::iterator i;
00252         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00253         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00254         <font class="keywordtype">int</font> begin = 0;
00255 
00256         <font class="keywordflow">for</font>( i = messages.begin(); i != messages.end(); ++i )
00257           {
00258             i-&gt;getHeader().getField(msgSeqNum);
00259             i-&gt;getHeader().getField(msgType);
00260             <font class="keywordflow">if</font>( Message::isAdminMsgType(msgType) )
00261               {
00262                 <font class="keywordflow">if</font>(!begin) begin = msgSeqNum;
00263               }
00264             <font class="keywordflow">else</font>
00265               {
00266                 <font class="keywordflow">if</font>(begin) <a class="code" href="class_f_i_x_1_1_session.html#c29">generateSequenceReset</a>(begin, msgSeqNum);
00267                 <a class="code" href="class_f_i_x_1_1_session.html#c4">resend</a>(*i);
00268                 begin = 0;
00269               }
00270           }
00271         <font class="keywordflow">if</font>(begin) <a class="code" href="class_f_i_x_1_1_session.html#c29">generateSequenceReset</a>(begin, msgSeqNum+1);
00272       }
00273     <font class="keywordflow">else</font>
00274       <a class="code" href="class_f_i_x_1_1_session.html#c29">generateSequenceReset</a>(beginSeqNo, <a class="code" href="class_f_i_x_1_1_session.html#a15">getExpectedSenderNum</a>());
00275 
00276     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00277   }
00278 
<a name="l00279"></a><a class="code" href="class_f_i_x_1_1_session.html#a10">00279</a>   <font class="keywordtype">bool</font> Session::send( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00280   {
00281     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#o16">m_mutex</a>);
00282 
00283     <font class="keywordflow">try</font>
00284       {
00285         <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00286         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a54">SenderSubID</a> senderSubID;
00287         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a60">TargetSubID</a> targetSubID;
00288         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00289         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00290 
00291         <font class="keywordtype">bool</font> hasSenderSubID = header.isSetField(senderSubID);
00292         <font class="keywordtype">bool</font> hasTargetSubID = header.isSetField(targetSubID);
00293         <font class="keywordflow">if</font>(hasSenderSubID) header.getField(senderSubID);
00294         <font class="keywordflow">if</font>(hasTargetSubID) header.getField(targetSubID);
00295 
00296         header.getField(beginString);
00297         header.getField(msgType);
00298 
00299         header.clear();
00300 
00301         header.setField(beginString);
00302         header.setField(msgType);
00303         <font class="keywordflow">if</font>(hasSenderSubID) header.setField(senderSubID);
00304         <font class="keywordflow">if</font>(hasTargetSubID) header.setField(targetSubID);
00305         <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(message);
00306       } <font class="keywordflow">catch</font>(<a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp;) { <font class="keywordflow">return</font> <font class="keyword">false</font>; }
00307   }
00308 
<a name="l00309"></a><a class="code" href="class_f_i_x_1_1_session.html#c3">00309</a>   <font class="keywordtype">bool</font> Session::sendRaw( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keywordtype">int</font> msgSeqNum )
00310   {
00311     <font class="keywordtype">bool</font> result = <font class="keyword">false</font>;
00312     <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00313     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00314     header.getField(msgType);
00315 
00316     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>(header);
00317 
00318     <font class="keywordflow">if</font>(msgSeqNum)
00319       header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(msgSeqNum));
00320 
00321     <font class="keywordflow">if</font>(Message::isAdminMsgType(msgType))
00322     {
00323       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a4">toAdmin</a>(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00324       <font class="keywordflow">if</font>(
00325           msgType == <font class="stringliteral">"A"</font> || msgType == <font class="stringliteral">"5"</font> 
00326           || msgType == <font class="stringliteral">"2"</font> || msgType == <font class="stringliteral">"4"</font>
00327           || <a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()
00328         )
00329         result = <a class="code" href="class_f_i_x_1_1_session.html#a10">send</a>(message.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00330     }
00331     <font class="keywordflow">else</font>
00332     {
00333       <font class="keywordflow">try</font>
00334       {
00335         <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a5">toApp</a>(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00336         <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()) result = <a class="code" href="class_f_i_x_1_1_session.html#a10">send</a>(message.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00337       }
00338       <font class="keywordflow">catch</font>(<a class="code" href="struct_f_i_x_1_1_do_not_send.html">DoNotSend</a>&amp;) {}
00339     }
00340 
00341     <font class="keywordflow">if</font>(!msgSeqNum)
00342     {
00343       <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a1">set</a>(message);
00344       <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a8">incrNextSenderMsgSeqNum</a>();
00345     }
00346     <font class="keywordflow">return</font> result;
00347   }
00348 
<a name="l00349"></a><a class="code" href="class_f_i_x_1_1_session.html#a14">00349</a>   <font class="keywordtype">void</font> Session::disconnect()
00350   {
00351     <font class="keywordflow">if</font>(m_pResponder)
00352       {
00353         <a class="code" href="class_f_i_x_1_1_session.html#o1">m_pResponder</a>-&gt;<a class="code" href="class_f_i_x_1_1_session_1_1_responder.html#a2">disconnect</a>();
00354         <a class="code" href="class_f_i_x_1_1_session.html#o1">m_pResponder</a> = 0;
00355       }
00356 
00357     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() || <a class="code" href="class_f_i_x_1_1_session.html#a2">sentLogon</a>())
00358     {
00359       <a class="code" href="class_f_i_x_1_1_session.html#o6">m_receivedLogon</a> = <font class="keyword">false</font>;
00360       <a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogon</a> = <font class="keyword">false</font>;
00361       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a3">onLogout</a>(<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00362     }
00363 
00364     <a class="code" href="class_f_i_x_1_1_session.html#o7">m_sentLogout</a> = <font class="keyword">false</font>;
00365     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_queue</a>.clear();
00366   }
00367 
<a name="l00368"></a><a class="code" href="class_f_i_x_1_1_session.html#c4">00368</a>   <font class="keywordtype">void</font> Session::resend( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00369   {
00370     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00371     <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00372     header.getField(sendingTime);
00373 
00374     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>(sendingTime));
00375     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a>());
00376     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00377 
00378     <font class="keywordflow">try</font>
00379     {
00380       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a5">toApp</a>(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00381       <a class="code" href="class_f_i_x_1_1_session.html#a10">send</a>(message.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00382     }
00383     <font class="keywordflow">catch</font>(<a class="code" href="struct_f_i_x_1_1_do_not_send.html">DoNotSend</a>&amp;)
00384     {
00385       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00386       header.getField(msgSeqNum);
00387 
00388       <a class="code" href="class_f_i_x_1_1_message.html">Message</a> sequenceReset;
00389       <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00390       sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"4"</font>));
00391       sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00392       sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>(sendingTime));
00393       sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(msgSeqNum);
00394       sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a>(msgSeqNum+1));
00395       sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a>(<font class="keyword">true</font>));
00396       <a class="code" href="class_f_i_x_1_1_session.html#a10">send</a>(sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00397     }
00398   }
00399 
<a name="l00400"></a><a class="code" href="class_f_i_x_1_1_session.html#c26">00400</a>   <font class="keywordtype">void</font> Session::generateLogon()
00401   {
00402     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logon;
00403     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"A"</font>));
00404     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a>(0));
00405     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>);
00406     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00407     <a class="code" href="class_f_i_x_1_1_session.html#o11">m_lastReceivedTime</a>.<a class="code" href="class_f_i_x_1_1_utc_time_stamp.html#a21">setCurrent</a>();
00408     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogon</a> = <font class="keyword">true</font>;
00409     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logon);
00410   }
00411 
<a name="l00412"></a><a class="code" href="class_f_i_x_1_1_session.html#c27">00412</a>   <font class="keywordtype">void</font> Session::generateLogon( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; aLogon )
00413   {
00414     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a> encryptMethod;
00415     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a111">HeartBtInt</a> heartBtInt;
00416     aLogon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(encryptMethod);
00417     aLogon.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(heartBtInt);
00418 
00419     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logon;
00420     logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"A"</font>));
00421     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(encryptMethod);
00422     logon.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(heartBtInt);
00423     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logon.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00424     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logon);
00425     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogon</a> = <font class="keyword">true</font>;
00426   }
00427 
<a name="l00428"></a><a class="code" href="class_f_i_x_1_1_session.html#c28">00428</a>   <font class="keywordtype">void</font> Session::generateResendRequest( <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>&amp; msgSeqNum )
00429   {
00430     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> resendRequest;
00431     resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"2"</font>));
00432     resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a11">BeginSeqNo</a>((<font class="keywordtype">int</font>)<a class="code" href="class_f_i_x_1_1_session.html#a16">getExpectedTargetNum</a>()));
00433     resendRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a20">EndSeqNo</a>(msgSeqNum - 1));
00434     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( resendRequest.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00435     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(resendRequest);
00436   }
00437 
00438   <font class="keywordtype">void</font> Session::generateSequenceReset
<a name="l00439"></a><a class="code" href="class_f_i_x_1_1_session.html#c29">00439</a>   ( <font class="keywordtype">int</font> beginSeqNo, <font class="keywordtype">int</font> endSeqNo )
00440   {
00441     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> sequenceReset;
00442     sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"4"</font>));
00443     sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00444     sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a>(endSeqNo));
00445     fill( sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00446     sequenceReset.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(beginSeqNo));
00447     sequenceReset.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a>(<font class="keyword">true</font>));
00448     sendRaw(sequenceReset, beginSeqNo);
00449   }
00450 
<a name="l00451"></a><a class="code" href="class_f_i_x_1_1_session.html#c30">00451</a>   <font class="keywordtype">void</font> Session::generateHeartbeat()
00452   {
00453     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> heartbeat;
00454     heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"0"</font>));
00455     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00456     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(heartbeat);
00457   }
00458 
<a name="l00459"></a><a class="code" href="class_f_i_x_1_1_session.html#c31">00459</a>   <font class="keywordtype">void</font> Session::generateHeartbeat( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; testRequest )
00460   {
00461     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> heartbeat;
00462     heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"0"</font>));
00463     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( heartbeat.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00464     <font class="keywordflow">try</font>
00465       {
00466         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a115">TestReqID</a> testReqID;
00467         testRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>(testReqID);
00468         heartbeat.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(testReqID);
00469       }
00470     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) {}
00471 
00472     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(heartbeat);
00473   }
00474 
<a name="l00475"></a><a class="code" href="class_f_i_x_1_1_session.html#c32">00475</a>   <font class="keywordtype">void</font> Session::generateTestRequest()
00476   {
00477     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> testRequest;
00478     testRequest.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"1"</font>));
00479     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( testRequest.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00480     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a115">TestReqID</a> testReqID(<font class="stringliteral">"TEST"</font>);
00481     testRequest.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(testReqID);
00482 
00483     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(testRequest);
00484   }
00485 
<a name="l00486"></a><a class="code" href="class_f_i_x_1_1_session.html#c33">00486</a>   <font class="keywordtype">void</font> Session::generateReject( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keywordtype">int</font> err, <font class="keywordtype">int</font> field )
00487   {
00488     std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>();
00489 
00490     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00491     reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"3"</font>));
00492     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00493     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00494     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00495     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00496     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgSeqNum);
00497     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00498     <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00499       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00500     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a336">SessionRejectReason</a>(err));
00501     <font class="keywordflow">if</font>( msgType != <font class="stringliteral">"A"</font> &amp;&amp; msgType != <font class="stringliteral">"4"</font>)
00502       <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00503 
00504     <font class="keywordflow">switch</font>( err )
00505       {
00506       <font class="keywordflow">case</font> 0:
00507         <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00508           reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00509         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Invalid tag number"</font>)); <font class="keywordflow">break</font>;
00510       <font class="keywordflow">case</font> 1:
00511         <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00512           reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00513         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Required tag missing"</font>)); <font class="keywordflow">break</font>;
00514       <font class="keywordflow">case</font> 2:
00515         <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00516           reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00517         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Tag not defined for this message type"</font>));
00518         <font class="keywordflow">break</font>;
00519       <font class="keywordflow">case</font> 4:
00520         <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00521           reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00522         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Tag specified without a value"</font>)); <font class="keywordflow">break</font>;
00523       <font class="keywordflow">case</font> 5:
00524         <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42 &amp;&amp; field)
00525           reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00526         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>
00527           (<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Value is incorrect (out of range) for this tag"</font>));
00528         <font class="keywordflow">break</font>;
00529       <font class="keywordflow">case</font> 6:
00530         <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00531           reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00532         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Incorrect data format for value"</font>)); <font class="keywordflow">break</font>;
00533       <font class="keywordflow">case</font> 9:
00534         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"CompID problem"</font>)); <font class="keywordflow">break</font>;
00535       <font class="keywordflow">case</font> 10:
00536         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"SendingTime accuracy problem"</font>)); <font class="keywordflow">break</font>;
00537       <font class="keywordflow">case</font> 11:
00538         reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Invalid MsgType"</font>)); <font class="keywordflow">break</font>;
00539       };
00540 
00541     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00542   }
00543 
<a name="l00544"></a><a class="code" href="class_f_i_x_1_1_session.html#c34">00544</a>   <font class="keywordtype">void</font> Session::generateReject( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keyword">const</font> std::string&amp; str )
00545   {
00546     std::string beginString = <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>();
00547 
00548     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00549     reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"3"</font>));
00550     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00551     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00552     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00553     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00554     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgSeqNum);
00555     <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00556       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00557     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00558 
00559     <font class="keywordflow">if</font>( msgType != <font class="stringliteral">"A"</font> &amp;&amp; msgType != <font class="stringliteral">"4"</font>)
00560       <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00561     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(str));
00562     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00563   }
00564 
<a name="l00565"></a><a class="code" href="class_f_i_x_1_1_session.html#c35">00565</a>   <font class="keywordtype">void</font> Session::generateBusinessReject( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keywordtype">int</font> err )
00566   {
00567     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> reject;
00568     reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"j"</font>));
00569     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00570     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00571     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00572     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00573     message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgSeqNum);
00574     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00575     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00576     reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a343">BusinessRejectReason</a>(err));
00577     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00578 
00579     <font class="keywordflow">if</font>( err == 3 )
00580       reject.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Unsupported Message Type"</font>));
00581     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00582   }
00583 
<a name="l00584"></a><a class="code" href="class_f_i_x_1_1_session.html#c36">00584</a>   <font class="keywordtype">void</font> Session::generateLogout( <font class="keyword">const</font> std::string&amp; text )
00585   {
00586     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> logout;
00587     logout.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"5"</font>));
00588     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logout.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>() );
00589     <font class="keywordflow">if</font>(text.length())
00590       logout.<a class="code" href="class_f_i_x_1_1_field_map.html#a4">setField</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(text));
00591     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logout);
00592     <a class="code" href="class_f_i_x_1_1_session.html#o7">m_sentLogout</a> = <font class="keyword">true</font>;
00593   }
00594 
<a name="l00595"></a><a class="code" href="class_f_i_x_1_1_session.html#c37">00595</a>   <font class="keywordtype">bool</font> Session::verify( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg, <font class="keywordtype">bool</font> checkTooHigh, 
00596                         <font class="keywordtype">bool</font> checkTooLow )
00597   {
00598     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00599     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00600     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00601     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00602     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00603 
00604     <font class="keywordflow">try</font>
00605       {
00606         <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00607         header.getField(senderCompID);
00608         header.getField(targetCompID);
00609         header.getField(sendingTime);
00610         header.getField(msgType);
00611         header.getField(msgSeqNum);
00612 
00613         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c11">validLogonState</a>(msgType) )
00614           <font class="keywordflow">throw</font> std::exception();
00615         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c6">isGoodTime</a>(sendingTime) )
00616           <a class="code" href="class_f_i_x_1_1_session.html#c13">doBadTime</a>(msg);
00617         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c10">isCorrectCompID</a>(senderCompID, targetCompID) )
00618           <a class="code" href="class_f_i_x_1_1_session.html#c14">doBadCompID</a>(msg);
00619 
00620         <font class="keywordflow">if</font>( checkTooHigh &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#c8">isTargetTooHigh</a>(msgSeqNum) )
00621           {
00622             <a class="code" href="class_f_i_x_1_1_session.html#c17">doTargetTooHigh</a>(msg);
00623             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00624           }
00625         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( checkTooLow &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#c9">isTargetTooLow</a>(msgSeqNum) )
00626           {
00627             <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#c16">doTargetTooLow</a>(msg))
00628               <a class="code" href="class_f_i_x_1_1_session.html#c12">fromCallback</a>(msgType, msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00629             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00630           }
00631 
00632         <a class="code" href="class_f_i_x_1_1_session.html#o11">m_lastReceivedTime</a>.<a class="code" href="class_f_i_x_1_1_utc_time_stamp.html#a21">setCurrent</a>();
00633       }
00634     <font class="keywordflow">catch</font>( std::exception&amp; )
00635       { <a class="code" href="class_f_i_x_1_1_session.html#a14">disconnect</a>(); <font class="keywordflow">return</font> <font class="keyword">false</font>; }
00636 
00637     <a class="code" href="class_f_i_x_1_1_session.html#c12">fromCallback</a>(msgType, msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00638     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00639   }
00640 
<a name="l00641"></a><a class="code" href="class_f_i_x_1_1_session.html#c11">00641</a>   <font class="keywordtype">bool</font> Session::validLogonState(<font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType)
00642   {
00643     <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"A"</font> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>()
00644         || msgType != <font class="stringliteral">"A"</font> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() )
00645       <font class="keywordflow">return</font> <font class="keyword">true</font>;
00646     <font class="keywordflow">if</font>( msgType != <font class="stringliteral">"5"</font> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#a3">sentLogout</a>() )
00647       <font class="keywordflow">return</font> <font class="keyword">true</font>;
00648     <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"4"</font> ) <font class="keywordflow">return</font> <font class="keyword">true</font>;
00649     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00650   }
00651 
<a name="l00652"></a><a class="code" href="class_f_i_x_1_1_session.html#c12">00652</a>   <font class="keywordtype">void</font> Session::fromCallback(<font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>&amp; msgType, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg, 
00653                              <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID)
00654   {
00655     <font class="keywordflow">if</font>(Message::isAdminMsgType(msgType))
00656       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a6">fromAdmin</a>(msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00657     <font class="keywordflow">else</font>
00658       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.<a class="code" href="class_f_i_x_1_1_application.html#a7">fromApp</a>(msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00659   }
00660 
<a name="l00661"></a><a class="code" href="class_f_i_x_1_1_session.html#c13">00661</a>   <font class="keywordtype">void</font> Session::doBadTime(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00662   {
00663     <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(msg, 10);
00664     <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00665   }
00666 
<a name="l00667"></a><a class="code" href="class_f_i_x_1_1_session.html#c14">00667</a>   <font class="keywordtype">void</font> Session::doBadCompID(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00668   {
00669     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() )
00670       <font class="keywordflow">throw</font> std::exception();
00671     <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(msg, 9);
00672     <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00673   }
00674 
<a name="l00675"></a><a class="code" href="class_f_i_x_1_1_session.html#c15">00675</a>   <font class="keywordtype">bool</font> Session::doPossDup(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00676   {
00677     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00678     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a> origSendingTime;
00679     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00680 
00681     <font class="keywordflow">if</font>(!header.isSetField(origSendingTime))
00682       {
00683         <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(msg, 1, origSendingTime.<a class="code" href="class_f_i_x_1_1_field_map.html#a7">getField</a>());
00684         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00685       }
00686     header.getField(origSendingTime);
00687     header.getField(sendingTime);
00688 
00689     <font class="keywordflow">if</font>(origSendingTime &gt; sendingTime)
00690       {
00691         <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(msg, 10);
00692         <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>();
00693         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00694       }
00695     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00696   }
00697 
<a name="l00698"></a><a class="code" href="class_f_i_x_1_1_session.html#c16">00698</a>   <font class="keywordtype">bool</font> Session::doTargetTooLow(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00699   {
00700     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00701     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00702     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a> possDupFlag;
00703     header.getField(msgType);
00704     header.getField(possDupFlag);
00705 
00706     <font class="keywordflow">if</font>(!possDupFlag) <font class="keywordflow">throw</font> std::exception();
00707     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#c15">doPossDup</a>(msg);
00708   }
00709 
<a name="l00710"></a><a class="code" href="class_f_i_x_1_1_session.html#c17">00710</a>   <font class="keywordtype">void</font> Session::doTargetTooHigh(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; msg)
00711   {
00712     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a54">Header</a>&amp; header = msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>();
00713     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00714     header.getField(msgSeqNum);
00715 
00716     <a class="code" href="class_f_i_x_1_1_session.html#c0">queue</a>(msgSeqNum, msg);
00717     <a class="code" href="class_f_i_x_1_1_session.html#c28">generateResendRequest</a>(msgSeqNum);
00718   }
00719 
<a name="l00720"></a><a class="code" href="class_f_i_x_1_1_session.html#c18">00720</a>   <font class="keywordtype">void</font> Session::nextQueued()
00721   {
00722     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> msg;
00723     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00724 
00725     <font class="keywordflow">while</font>(<a class="code" href="class_f_i_x_1_1_session.html#c1">retreive</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(<a class="code" href="class_f_i_x_1_1_session.html#a16">getExpectedTargetNum</a>()), msg))
00726       {
00727         msg.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00728         <font class="keywordflow">if</font>(msgType != <font class="stringliteral">"A"</font>)
00729           <a class="code" href="class_f_i_x_1_1_session.html#a11">next</a>(msg.<a class="code" href="class_f_i_x_1_1_message.html#a5">getString</a>());
00730       }
00731   }
00732 
<a name="l00733"></a><a class="code" href="class_f_i_x_1_1_session.html#a12">00733</a>   <font class="keywordtype">void</font> Session::next( <font class="keyword">const</font> std::string&amp; msg )
00734   {
00735     <a class="code" href="class_f_i_x_1_1_session.html#a11">next</a>(<a class="code" href="class_f_i_x_1_1_message.html">Message</a>(msg, <a class="code" href="class_f_i_x_1_1_session.html#o12">m_dataDictionary</a>));
00736   }
00737 
<a name="l00738"></a><a class="code" href="class_f_i_x_1_1_session.html#a13">00738</a>   <font class="keywordtype">void</font> Session::next( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00739   {
00740     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#o16">m_mutex</a>);
00741 
00742     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c7">checkSessionTime</a>(<a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>()))
00743     { <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); <font class="keywordflow">return</font>; }
00744 
00745     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00746     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00747     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00748     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00749 
00750     <font class="keywordflow">try</font>
00751       {
00752         message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(msgType);
00753         message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(beginString);
00754         message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(senderCompID);
00755         message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(targetCompID);
00756 
00757         <font class="keywordflow">if</font>(beginString != <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.<a class="code" href="class_f_i_x_1_1_session_i_d.html#a1">getBeginString</a>())
00758           <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_unsupported_version.html">UnsupportedVersion</a>();
00759 
00760         <a class="code" href="class_f_i_x_1_1_session.html#o12">m_dataDictionary</a>.<a class="code" href="class_f_i_x_1_1_data_dictionary.html#a25">validate</a>(message);
00761 
00762         <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"A"</font> )
00763           <a class="code" href="class_f_i_x_1_1_session.html#c19">nextLogon</a>(message);
00764         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"0"</font> )
00765           <a class="code" href="class_f_i_x_1_1_session.html#c20">nextHeartbeat</a>(message);
00766         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"1"</font> )
00767           <a class="code" href="class_f_i_x_1_1_session.html#c21">nextTestRequest</a>(message);
00768         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"4"</font> )
00769           <a class="code" href="class_f_i_x_1_1_session.html#c24">nextSequenceReset</a>(message);
00770         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"5"</font> )
00771           <a class="code" href="class_f_i_x_1_1_session.html#c22">nextLogout</a>(message);
00772         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"2"</font> )
00773           <a class="code" href="class_f_i_x_1_1_session.html#c25">nextResendRequest</a>(message);
00774         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"3"</font> )
00775           <a class="code" href="class_f_i_x_1_1_session.html#c23">nextReject</a>(message);
00776         <font class="keywordflow">else</font>
00777           {
00778             <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c37">verify</a>(message)) <font class="keywordflow">return</font>;
00779             <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00780           }
00781         <a class="code" href="class_f_i_x_1_1_session.html#c18">nextQueued</a>();
00782       }
00783     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_message_parse_error.html">MessageParseError</a>&amp; ) {}
00784     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_required_tag_missing.html">RequiredTagMissing</a>&amp; e )
00785       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 1, e.field); }
00786     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; e )
00787       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 1, e.field); 
00788         <font class="keywordflow">if</font>(msgType == <font class="stringliteral">"A"</font>) <a class="code" href="class_f_i_x_1_1_session.html#a14">disconnect</a>();
00789       }
00790     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_invalid_tag_number.html">InvalidTagNumber</a>&amp; e )
00791       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 0, e.field); }
00792     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_no_tag_value.html">NoTagValue</a>&amp; e )
00793       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 4, e.field); }
00794     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_tag_not_defined_for_message.html">TagNotDefinedForMessage</a>&amp; e)
00795       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 2, e.field); }
00796     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_invalid_message_type.html">InvalidMessageType</a>&amp; )
00797       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 11); }
00798     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_unsupported_message_type.html">UnsupportedMessageType</a>&amp; )
00799       { <font class="keywordflow">if</font>(beginString &gt;= FIX::BeginString_FIX42)
00800           <a class="code" href="class_f_i_x_1_1_session.html#c35">generateBusinessReject</a>(message, 3); 
00801         <font class="keywordflow">else</font>
00802           <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, <font class="stringliteral">"Unsupported message type"</font>);
00803       }
00804     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_fields_out_of_order.html">FieldsOutOfOrder</a>&amp; e )
00805       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, e.what()); }
00806     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_incorrect_data_format.html">IncorrectDataFormat</a>&amp; e )
00807       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 6, e.field); }
00808     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_incorrect_tag_value.html">IncorrectTagValue</a>&amp; e )
00809       { <a class="code" href="class_f_i_x_1_1_session.html#c33">generateReject</a>(message, 5, e.field); }
00810     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_invalid_message.html">InvalidMessage</a>&amp; ) {}
00811     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_reject_logon.html">RejectLogon</a>&amp; ) { <a class="code" href="class_f_i_x_1_1_session.html#a14">disconnect</a>(); }
00812     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_unsupported_version.html">UnsupportedVersion</a>&amp; )
00813       {
00814         <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"5"</font> )
00815           <a class="code" href="class_f_i_x_1_1_session.html#c22">nextLogout</a>(message);
00816         <font class="keywordflow">else</font>
00817           {
00818             <a class="code" href="class_f_i_x_1_1_session.html#c36">generateLogout</a>(<font class="stringliteral">"Incorrect BeginString"</font>);
00819             <a class="code" href="class_f_i_x_1_1_session.html#o14">m_pStore</a>-&gt;<a class="code" href="class_f_i_x_1_1_message_store.html#a9">incrNextTargetMsgSeqNum</a>();
00820           }
00821       }
00822   }
00823 
<a name="l00824"></a><a class="code" href="class_f_i_x_1_1_session.html#d0">00824</a>   <font class="keywordtype">bool</font> Session::sendToTarget( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00825     <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp;)
00826   {
00827     <font class="keywordflow">try</font>
00828       {
00829         <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a> sessionID = message.getSessionID();
00830         <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* pSession = lookupSession(sessionID);
00831         <font class="keywordflow">if</font>( !pSession ) <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>();
00832         <font class="keywordtype">bool</font> result = pSession-&gt;<a class="code" href="class_f_i_x_1_1_session.html#a10">send</a>(message);
00833         <font class="keywordflow">return</font> result;
00834       }
00835     <font class="keywordflow">catch</font>( <a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp; ) { <font class="keywordflow">throw</font> <a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>(); }
00836   }
00837 
<a name="l00838"></a><a class="code" href="class_f_i_x_1_1_session.html#d1">00838</a>   <font class="keywordtype">bool</font> Session::sendToTarget( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00839     <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp;)
00840   {
00841     message.setSessionID(sessionID);
00842     <font class="keywordflow">return</font> sendToTarget(message);
00843   }
00844 
00845   <font class="keywordtype">bool</font> Session::sendToTarget
<a name="l00846"></a><a class="code" href="class_f_i_x_1_1_session.html#d2">00846</a>   ( <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message, <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>&amp; senderCompID, 
00847     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>&amp; targetCompID )
00848     <font class="keywordflow">throw</font>(<a class="code" href="struct_f_i_x_1_1_session_not_found.html">SessionNotFound</a>&amp;)
00849   {
00850     message.getHeader().setField(senderCompID);
00851     message.getHeader().setField(targetCompID);
00852     <font class="keywordflow">return</font> sendToTarget(message);
00853   }
00854 
<a name="l00855"></a><a class="code" href="class_f_i_x_1_1_session.html#d3">00855</a>   <font class="keywordtype">bool</font> Session::doesSessionExist( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00856   {
00857     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00858     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( sessionID );
00859   }
00860 
<a name="l00861"></a><a class="code" href="class_f_i_x_1_1_session.html#d4">00861</a>   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::lookupSession( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00862   {
00863     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00864     Sessions::iterator find = <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( sessionID );
00865     <font class="keywordflow">if</font>( find != <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() )
00866       <font class="keywordflow">return</font> find-&gt;second;
00867     <font class="keywordflow">else</font>
00868       <font class="keywordflow">return</font> 0;
00869   }
00870 
<a name="l00871"></a><a class="code" href="class_f_i_x_1_1_session.html#d5">00871</a>   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::lookupSession( <font class="keyword">const</font> std::string&amp; string, <font class="keywordtype">bool</font> reverse )
00872   {
00873     <a class="code" href="class_f_i_x_1_1_message.html">Message</a> message;
00874     <font class="keywordflow">if</font>( !message.<a class="code" href="class_f_i_x_1_1_message.html#a8">setStringHeader</a>(string) )
00875       <font class="keywordflow">return</font> 0;
00876 
00877     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00878     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00879     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00880     <font class="keywordflow">try</font>
00881     {
00882       message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(beginString);
00883       message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(senderCompID);
00884       message.<a class="code" href="class_f_i_x_1_1_message.html#a9">getHeader</a>().getField(targetCompID);
00885     }
00886     <font class="keywordflow">catch</font>(<a class="code" href="struct_f_i_x_1_1_field_not_found.html">FieldNotFound</a>&amp;) { <font class="keywordflow">return</font> 0; }
00887 
00888     <font class="keywordflow">if</font>(reverse)
00889     {
00890       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#d4">lookupSession</a>(<a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>(beginString, <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>(targetCompID), 
00891                           <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>(senderCompID)));
00892     }
00893     <font class="keywordflow">else</font>
00894     {
00895       <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#d4">lookupSession</a>(<a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>(beginString, senderCompID, targetCompID));
00896     }
00897   }
00898 
<a name="l00899"></a><a class="code" href="class_f_i_x_1_1_session.html#d6">00899</a>   <font class="keywordtype">bool</font> Session::isSessionRegistered( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00900   {
00901     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00902     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.find( sessionID );
00903   }
00904 
<a name="l00905"></a><a class="code" href="class_f_i_x_1_1_session.html#d7">00905</a>   <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* Session::registerSession( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00906   {
00907     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00908     <a class="code" href="class_f_i_x_1_1_session.html">Session</a>* pSession = <a class="code" href="class_f_i_x_1_1_session.html#d4">lookupSession</a>(sessionID);
00909     <font class="keywordflow">if</font>(pSession == 0) <font class="keywordflow">return</font> 0;
00910     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#d6">isSessionRegistered</a>(sessionID)) <font class="keywordflow">return</font> 0;
00911     <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>[sessionID] = pSession;
00912     <font class="keywordflow">return</font> pSession;
00913   }
00914 
<a name="l00915"></a><a class="code" href="class_f_i_x_1_1_session.html#d8">00915</a>   <font class="keywordtype">void</font> Session::unregisterSession( <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_session_i_d.html">SessionID</a>&amp; sessionID )
00916   {
00917     <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.erase(sessionID);
00918   }
00919 
<a name="l00920"></a><a class="code" href="class_f_i_x_1_1_session.html#d9">00920</a>   <font class="keywordtype">int</font> Session::numSessions()
00921   {
00922     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00923     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.size();
00924   }
00925 
<a name="l00926"></a><a class="code" href="class_f_i_x_1_1_session.html#f0">00926</a>   <font class="keywordtype">bool</font> Session::addSession( <a class="code" href="class_f_i_x_1_1_session.html">Session</a>&amp; s )
00927   {
00928     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00929     Sessions::iterator it = <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( s.<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a> );
00930     <font class="keywordflow">if</font> (it == <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end())
00931       {
00932         <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>[s.<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>] = &amp;s;
00933         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00934       }
00935     <font class="keywordflow">else</font>
00936       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00937   }
00938 
<a name="l00939"></a><a class="code" href="class_f_i_x_1_1_session.html#f1">00939</a>   <font class="keywordtype">void</font> Session::removeSession( <a class="code" href="class_f_i_x_1_1_session.html">Session</a>&amp; s )
00940   {
00941     <a class="code" href="class_f_i_x_1_1_locker.html">Locker</a> locker(<a class="code" href="class_f_i_x_1_1_session.html#r2">s_mutex</a>);
00942     <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a> );
00943     <a class="code" href="class_f_i_x_1_1_session.html#r1">s_registered</a>.erase( s.<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a> );
00944   }
00945 
<a name="l00946"></a><a class="code" href="class_f_i_x_1_1_session.html#d10">00946</a>   <font class="keywordtype">bool</font> Session::isSessionTime(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; start, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; end,
00947                               <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time )
00948   {
00949     <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a> timeOnly(time);
00950 
00951     <font class="keywordflow">if</font>(start &lt; end)
00952       <font class="keywordflow">return</font>( timeOnly &gt;= start &amp;&amp; timeOnly &lt;= end );
00953     <font class="keywordflow">else</font>
00954       <font class="keywordflow">return</font>( timeOnly &gt;= start || timeOnly &lt;= end );
00955   }
00956 
<a name="l00957"></a><a class="code" href="class_f_i_x_1_1_session.html#d11">00957</a>   <font class="keywordtype">bool</font> Session::isSameSession(<font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; start, 
00958                               <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_only.html">UtcTimeOnly</a>&amp; end,
00959                               <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time1, 
00960                               <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_utc_time_stamp.html">UtcTimeStamp</a>&amp; time2 )
00961   {
00962     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>(start, end, time1)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00963     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#a8">isSessionTime</a>(start, end, time2)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00964 
00965     <font class="keywordflow">if</font>(time1 == time2) <font class="keywordflow">return</font> <font class="keyword">true</font>;
00966 
00967     <a class="code" href="class_f_i_x_1_1_utc_date.html">UtcDate</a> time1Date(time1);
00968     <a class="code" href="class_f_i_x_1_1_utc_date.html">UtcDate</a> time2Date(time2);
00969 
00970     <font class="keywordflow">if</font>(start &lt; end)
00971       <font class="keywordflow">return</font> time1Date == time2Date;
00972     <font class="keywordflow">else</font>
00973       <font class="keywordflow">return</font> abs(time1Date - time2Date) &lt;= 1;
00974       
00975     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00976   }
00977 
<a name="l00978"></a><a class="code" href="class_f_i_x_1_1_session.html#c0">00978</a>   <font class="keywordtype">void</font> Session::queue( <font class="keywordtype">int</font> msgSeqNum, <font class="keyword">const</font> <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00979   {
00980     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_queue</a>[msgSeqNum] = message;
00981   }
00982 
<a name="l00983"></a><a class="code" href="class_f_i_x_1_1_session.html#c1">00983</a>   <font class="keywordtype">bool</font> Session::retreive( <font class="keywordtype">int</font> msgSeqNum, <a class="code" href="class_f_i_x_1_1_message.html">Message</a>&amp; message )
00984   {
00985     Messages::iterator i = <a class="code" href="class_f_i_x_1_1_session.html#o15">m_queue</a>.find(msgSeqNum);
00986     <font class="keywordflow">if</font>( i != <a class="code" href="class_f_i_x_1_1_session.html#o15">m_queue</a>.end() )
00987       {
00988         message = i-&gt;second;
00989         <a class="code" href="class_f_i_x_1_1_session.html#o15">m_queue</a>.erase(i);
00990         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00991       }
00992     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00993   }
00994 }
</pre></div><hr><address><small>
Generated on Tue Jun 11 23:07:24 2002 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.2.16 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
