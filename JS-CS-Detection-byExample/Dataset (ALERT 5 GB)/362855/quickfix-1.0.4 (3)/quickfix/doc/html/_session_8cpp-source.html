<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>C:/release/quickfix/src/C++/Session.cpp Source File</title>
<link href="quickfix.css" rel="stylesheet" type="text/css">
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td><img src="images/outsideTopLeft.gif"></td>
   <td width="100%" class="outsideTop">&nbsp;</td>
   <td><img src="images/outsideTopRight.gif"></td>
  </tr>
  <tr>
   <td class="outsideLeft">&nbsp;</td>
   <td>
	<img src="images/QuickFIX.jpg" align="middle" border=0>
	&nbsp;&nbsp;
	<a href="index.html">Index</a>&nbsp;
	<a href="files.html">Source Files</a>&nbsp;
	<a href="annotated.html">Annotated Class List</a>&nbsp;
	<a href="classes.html">Alphabetical Class List</a>&nbsp;
	<a href="hierarchy.html">Class Hierarchy</a>&nbsp;
	<a href="inherits.html">Graphical Class Hierarchy</a>&nbsp;
   </td>
   <td class="outsideRight">&nbsp;</td>
  </tr>
  <tr>
   <td><img src="images/outsideBottomLeft.gif"></td>
   <td width=100% class="outsideBottom">&nbsp;</td>
   <td><img src="images/outsideBottomRight.gif"></td>
  </tr>
</table>
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.12 -->
<h1>C:/release/quickfix/src/C++/Session.cpp</h1><a href="_session_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* ====================================================================</font>
00002 <font class="comment"> * The QuickFIX Software License, Version 1.0</font>
00003 <font class="comment"> *</font>
00004 <font class="comment"> * Copyright (c) 2001 ThoughtWorks, Inc.  All rights</font>
00005 <font class="comment"> * reserved.</font>
00006 <font class="comment"> *</font>
00007 <font class="comment"> * Redistribution and use in source and binary forms, with or without</font>
00008 <font class="comment"> * modification, are permitted provided that the following conditions</font>
00009 <font class="comment"> * are met:</font>
00010 <font class="comment"> *</font>
00011 <font class="comment"> * 1. Redistributions of source code must retain the above copyright</font>
00012 <font class="comment"> *    notice, this list of conditions and the following disclaimer.</font>
00013 <font class="comment"> *</font>
00014 <font class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</font>
00015 <font class="comment"> *    notice, this list of conditions and the following disclaimer in</font>
00016 <font class="comment"> *    the documentation and/or other materials provided with the</font>
00017 <font class="comment"> *    distribution.</font>
00018 <font class="comment"> *</font>
00019 <font class="comment"> * 3. The end-user documentation included with the redistribution,</font>
00020 <font class="comment"> *    if any, must include the following acknowledgment:</font>
00021 <font class="comment"> *       "This product includes software developed by</font>
00022 <font class="comment"> *        ThoughtWorks, Inc. (http://www.thoughtworks.com/)."</font>
00023 <font class="comment"> *    Alternately, this acknowledgment may appear in the software itself,</font>
00024 <font class="comment"> *    if and wherever such third-party acknowledgments normally appear.</font>
00025 <font class="comment"> *</font>
00026 <font class="comment"> * 4. The names "QuickFIX" and "ThoughtWorks, Inc." must</font>
00027 <font class="comment"> *    not be used to endorse or promote products derived from this</font>
00028 <font class="comment"> *    software without prior written permission. For written</font>
00029 <font class="comment"> *    permission, please contact quickfix-users@lists.sourceforge.net.</font>
00030 <font class="comment"> *</font>
00031 <font class="comment"> * 5. Products derived from this software may not be called "QuickFIX",</font>
00032 <font class="comment"> *    nor may "QuickFIX" appear in their name, without prior written</font>
00033 <font class="comment"> *    permission of ThoughtWorks, Inc.</font>
00034 <font class="comment"> *</font>
00035 <font class="comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</font>
00036 <font class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</font>
00037 <font class="comment"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</font>
00038 <font class="comment"> * DISCLAIMED.  IN NO EVENT SHALL THOUGHTWORKS INC OR</font>
00039 <font class="comment"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</font>
00040 <font class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</font>
00041 <font class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</font>
00042 <font class="comment"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</font>
00043 <font class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</font>
00044 <font class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</font>
00045 <font class="comment"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</font>
00046 <font class="comment"> * SUCH DAMAGE.</font>
00047 <font class="comment"> * ====================================================================</font>
00048 <font class="comment"> */</font>
00049 
00050 <font class="preprocessor">#ifdef _MSC_VER</font>
00051 <font class="preprocessor"></font><font class="preprocessor">#pragma warning( disable : 4503 4355 4786 )</font>
00052 <font class="preprocessor"></font><font class="preprocessor">#include "stdafx.h"</font>
00053 <font class="preprocessor">#else</font>
00054 <font class="preprocessor"></font><font class="preprocessor">#include "config.h"</font>
00055 <font class="preprocessor">#endif</font>
00056 <font class="preprocessor"></font>
00057 <font class="preprocessor">#include "<a class="code" href="_session_8h.html">Session.h</a>"</font>
00058 <font class="preprocessor">#include &lt;algorithm&gt;</font>
00059 <font class="preprocessor">#include &lt;iostream&gt;</font>
00060 
00061 <font class="keyword">namespace </font>FIX
00062 {
<a name="l00063"></a><a class="code" href="class_f_i_x_1_1_session.html#r0">00063</a>   Session::Sessions Session::s_sessions;
<a name="l00064"></a><a class="code" href="class_f_i_x_1_1_session.html#r1">00064</a>   Mutex Session::s_mutex;
00065 
<a name="l00066"></a><a class="code" href="class_f_i_x_1_1_session.html#a0">00066</a>   Session::Session( Application&amp; application,
00067                     MessageStoreFactory&amp; factory,
00068                     <font class="keyword">const</font> SessionID&amp; sessionID,
00069                     <font class="keyword">const</font> std::string&amp; url,
00070                     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a19">UtcTimeOnly</a>&amp; startTime,
00071                     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a19">UtcTimeOnly</a>&amp; endTime,
00072                     <font class="keywordtype">int</font> heartBtInt )
00073   : m_application(application), m_pResponder(0),
00074     m_sessionID(sessionID), m_heartBtInt(heartBtInt), m_url(url),
00075     m_startTime(startTime), m_endTime(endTime),
00076     m_receivedLogon(false), m_sentLogout(false), m_sentLogon(false),
00077     m_factory(factory)
00078   {
00079     <a class="code" href="class_f_i_x_1_1_session.html#o10">m_initiate</a> = (heartBtInt != 0);
00080     <font class="keywordflow">if</font>(url.length()) <a class="code" href="class_f_i_x_1_1_session.html#o13">m_validator</a>.readFromURL(url);
00081     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a> = <a class="code" href="class_f_i_x_1_1_session.html#o14">m_factory</a>.create(sessionID);
00082 
00083     <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a10">UtcTimeStamp</a> creationTime = <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;getCreationTime();
00084     <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a10">UtcTimeStamp</a> now;
00085 
00086     <font class="keywordflow">if</font>(creationTime &gt; now ||
00087       !<a class="code" href="class_f_i_x_1_1_session.html#a11">isSessionTime</a>(startTime, endTime, now) ||
00088       !<a class="code" href="class_f_i_x_1_1_session.html#d7">isSameSession</a>(startTime, endTime, now, creationTime))
00089     {
00090       <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>();
00091     }
00092 
00093     <a class="code" href="class_f_i_x_1_1_session.html#f0">addSession</a>(*<font class="keyword">this</font>);
00094   }
00095 
<a name="l00096"></a><a class="code" href="class_f_i_x_1_1_session.html#a1">00096</a>   Session::~Session()
00097   {
00098     <a class="code" href="class_f_i_x_1_1_session.html#o14">m_factory</a>.destroy(<a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>);
00099     <a class="code" href="class_f_i_x_1_1_session.html#f1">removeSession</a>(*<font class="keyword">this</font>);
00100   }
00101 
<a name="l00102"></a><a class="code" href="class_f_i_x_1_1_session.html#c5">00102</a>   <font class="keywordtype">void</font> Session::fill( <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; header )
00103   {
00104     <a class="code" href="class_f_i_x_1_1_session.html#o11">m_lastSentTime</a>.setCurrent();
00105     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.getBeginString() );
00106     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.getSenderCompID() );
00107     header.setField( <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.getTargetCompID() );
00108     header.setField( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(<a class="code" href="class_f_i_x_1_1_session.html#a7">getExpectedSenderNum</a>()) );
00109     header.setField( <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a>() );
00110   }
00111 
<a name="l00112"></a><a class="code" href="class_f_i_x_1_1_session.html#a13">00112</a>   <font class="keywordtype">void</font> Session::next()
00113   {
00114     Locker locker(<a class="code" href="class_f_i_x_1_1_session.html#o17">m_mutex</a>);
00115 
00116     <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a10">UtcTimeStamp</a> now;
00117     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c7">checkSessionTime</a>(now))
00118     { <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); <font class="keywordflow">return</font>; }
00119     
00120     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() )
00121       {
00122         <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o10">m_initiate</a> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#o9">m_sentLogon</a>)
00123           {
00124             <a class="code" href="class_f_i_x_1_1_session.html#o12">m_lastReceivedTime</a>.setCurrent();
00125             <a class="code" href="class_f_i_x_1_1_session.html#c25">generateLogon</a>();
00126           }
00127         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o10">m_initiate</a> &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#o9">m_sentLogon</a>)
00128           {
00129             <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a10">UtcTimeStamp</a> now;
00130             <font class="keywordflow">if</font>(now - <a class="code" href="class_f_i_x_1_1_session.html#o12">m_lastReceivedTime</a> &gt;= 10)
00131               <a class="code" href="class_f_i_x_1_1_session.html#a15">disconnect</a>();
00132           }
00133         <font class="keywordflow">return</font>;
00134       }
00135 
00136     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a> == 0 ) <font class="keywordflow">return</font>;
00137     
00138     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogout</a> &amp;&amp; (now - <a class="code" href="class_f_i_x_1_1_session.html#o12">m_lastReceivedTime</a> &gt;= 2))
00139       <a class="code" href="class_f_i_x_1_1_session.html#a15">disconnect</a>();
00140 
00141     <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o11">m_lastSentTime</a>) &lt; <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>) <font class="keywordflow">return</font>;
00142 
00143     <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o12">m_lastReceivedTime</a>) &gt;= (5 * <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>))
00144       <a class="code" href="class_f_i_x_1_1_session.html#a15">disconnect</a>();
00145     <font class="keywordflow">else</font>
00146       <font class="keywordflow">if</font>((now - <a class="code" href="class_f_i_x_1_1_session.html#o12">m_lastReceivedTime</a>) &gt;= (1.2 * <a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>))
00147         <a class="code" href="class_f_i_x_1_1_session.html#c31">generateTestRequest</a>();
00148       <font class="keywordflow">else</font>
00149         <a class="code" href="class_f_i_x_1_1_session.html#c29">generateHeartbeat</a>();
00150   }
00151 
<a name="l00152"></a><a class="code" href="class_f_i_x_1_1_session.html#c18">00152</a>   <font class="keywordtype">void</font> Session::nextLogon( <font class="keyword">const</font> Message&amp; logon )
00153   {
00154     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#o10">m_initiate</a> &amp;&amp; !<a class="code" href="class_f_i_x_1_1_session.html#o9">m_sentLogon</a> )
00155       { <a class="code" href="class_f_i_x_1_1_session.html#a15">disconnect</a>(); <font class="keywordflow">return</font>; }
00156 
00157     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00158     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00159     logon.getHeader().getField(senderCompID);
00160     logon.getHeader().getField(targetCompID);
00161 
00162     <font class="keywordtype">bool</font> verified = <a class="code" href="class_f_i_x_1_1_session.html#c36">verify</a>(logon, <font class="keyword">false</font>, <font class="keyword">true</font>);
00163     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#c10">isCorrectCompID</a>(senderCompID, targetCompID))
00164       <a class="code" href="class_f_i_x_1_1_session.html#o7">m_receivedLogon</a> = <font class="keyword">true</font>;
00165     <font class="keywordflow">if</font>(!verified) <font class="keywordflow">return</font>;
00166 
00167     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#o10">m_initiate</a> )
00168       {
00169         logon.getField(<a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>);
00170         <a class="code" href="class_f_i_x_1_1_session.html#c25">generateLogon</a>(logon);
00171       }
00172 
00173     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00174     logon.getHeader().getField(msgSeqNum);
00175     <font class="keywordflow">if</font>( <a class="code" href="class_f_i_x_1_1_session.html#c8">isTargetTooHigh</a>(msgSeqNum) )
00176       {
00177         <a class="code" href="class_f_i_x_1_1_session.html#c16">doTargetTooHigh</a>(logon);
00178       }
00179     <font class="keywordflow">else</font>
00180       {
00181         <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00182         <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00183       }
00184  
00185     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()) 
00186       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.onLogon(<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00187   }
00188 
<a name="l00189"></a><a class="code" href="class_f_i_x_1_1_session.html#c19">00189</a>   <font class="keywordtype">void</font> Session::nextHeartbeat( <font class="keyword">const</font> Message&amp; heartbeat )
00190   {
00191     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c36">verify</a>(heartbeat) ) <font class="keywordflow">return</font>;
00192     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00193     <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00194   }
00195 
<a name="l00196"></a><a class="code" href="class_f_i_x_1_1_session.html#c20">00196</a>   <font class="keywordtype">void</font> Session::nextTestRequest( <font class="keyword">const</font> Message&amp; testRequest )
00197   {
00198     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c36">verify</a>(testRequest) ) <font class="keywordflow">return</font>;
00199     <a class="code" href="class_f_i_x_1_1_session.html#c29">generateHeartbeat</a>( testRequest );
00200     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00201     <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00202   }
00203 
<a name="l00204"></a><a class="code" href="class_f_i_x_1_1_session.html#c21">00204</a>   <font class="keywordtype">void</font> Session::nextLogout( <font class="keyword">const</font> Message&amp; logout )
00205   {
00206     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c36">verify</a>(logout, <font class="keyword">false</font>, <font class="keyword">false</font>) ) <font class="keywordflow">return</font>;
00207     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a3">sentLogout</a>() ) <a class="code" href="class_f_i_x_1_1_session.html#c35">generateLogout</a>();
00208     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00209     <a class="code" href="class_f_i_x_1_1_session.html#a15">disconnect</a>();
00210   }
00211 
<a name="l00212"></a><a class="code" href="class_f_i_x_1_1_session.html#c22">00212</a>   <font class="keywordtype">void</font> Session::nextReject( <font class="keyword">const</font> Message&amp; reject )
00213   {
00214     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c36">verify</a>(reject) ) <font class="keywordflow">return</font>;
00215     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00216     <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00217   }
00218 
<a name="l00219"></a><a class="code" href="class_f_i_x_1_1_session.html#c23">00219</a>   <font class="keywordtype">void</font> Session::nextSequenceReset( <font class="keyword">const</font> Message&amp; sequenceReset )
00220   {
00221     <font class="keywordtype">bool</font> isGapFill = <font class="keyword">false</font>;
00222     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a> gapFillFlag;
00223     <font class="keywordflow">if</font>( sequenceReset.isSetField(gapFillFlag) )
00224       {
00225         sequenceReset.getField(gapFillFlag);
00226         isGapFill = gapFillFlag;
00227       }
00228 
00229     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c36">verify</a>(sequenceReset, isGapFill, isGapFill) ) <font class="keywordflow">return</font>;
00230 
00231     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a> newSeqNo;
00232     <font class="keywordflow">if</font>(sequenceReset.isSetField(newSeqNo))
00233       {
00234         sequenceReset.getField(newSeqNo);
00235         <font class="keywordflow">if</font>( newSeqNo &gt; <a class="code" href="class_f_i_x_1_1_session.html#a8">getExpectedTargetNum</a>() )
00236           <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;setNextTargetMsgSeqNum(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(newSeqNo));
00237         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( newSeqNo &lt; <a class="code" href="class_f_i_x_1_1_session.html#a8">getExpectedTargetNum</a>() )
00238           <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(sequenceReset, 5);
00239       }
00240   }
00241 
<a name="l00242"></a><a class="code" href="class_f_i_x_1_1_session.html#c24">00242</a>   <font class="keywordtype">void</font> Session::nextResendRequest( <font class="keyword">const</font> Message&amp; resendRequest )
00243   {
00244     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c36">verify</a>(resendRequest, <font class="keyword">false</font>, <font class="keyword">false</font>) ) <font class="keywordflow">return</font>;
00245     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a11">BeginSeqNo</a> beginSeqNo;
00246     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a20">EndSeqNo</a> endSeqNo;
00247     resendRequest.getField(beginSeqNo);
00248     resendRequest.getField(endSeqNo);
00249     std::vector&lt;Message&gt; messages;
00250 
00251     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;get(beginSeqNo, endSeqNo, messages))
00252       {
00253         std::vector&lt;Message&gt;::iterator i;
00254         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00255         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00256         <font class="keywordtype">int</font> begin = 0;
00257 
00258         <font class="keywordflow">for</font>( i = messages.begin(); i != messages.end(); ++i )
00259           {
00260             i-&gt;getHeader().getField(msgSeqNum);
00261             i-&gt;getHeader().getField(msgType);
00262             <font class="keywordflow">if</font>( Message::isAdminMsgType(msgType) )
00263               {
00264                 <font class="keywordflow">if</font>(!begin) begin = msgSeqNum;
00265               }
00266             <font class="keywordflow">else</font>
00267               {
00268                 <font class="keywordflow">if</font>(begin) <a class="code" href="class_f_i_x_1_1_session.html#c28">generateSequenceReset</a>(begin, msgSeqNum);
00269                 <a class="code" href="class_f_i_x_1_1_session.html#c4">resend</a>(*i);
00270                 begin = 0;
00271               }
00272           }
00273         <font class="keywordflow">if</font>(begin) <a class="code" href="class_f_i_x_1_1_session.html#c28">generateSequenceReset</a>(begin, msgSeqNum+1);
00274       }
00275     <font class="keywordflow">else</font>
00276       <a class="code" href="class_f_i_x_1_1_session.html#c28">generateSequenceReset</a>(beginSeqNo, <a class="code" href="class_f_i_x_1_1_session.html#a7">getExpectedSenderNum</a>());
00277 
00278     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00279   }
00280 
<a name="l00281"></a><a class="code" href="class_f_i_x_1_1_session.html#a12">00281</a>   <font class="keywordtype">bool</font> Session::send( Message&amp; message )
00282   {
00283     Locker locker(<a class="code" href="class_f_i_x_1_1_session.html#o17">m_mutex</a>);
00284 
00285     <font class="keywordflow">try</font>
00286       {
00287         <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; header = message.getHeader();
00288         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a54">SenderSubID</a> senderSubID;
00289         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a60">TargetSubID</a> targetSubID;
00290         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00291         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00292 
00293         <font class="keywordtype">bool</font> hasSenderSubID = header.isSetField(senderSubID);
00294         <font class="keywordtype">bool</font> hasTargetSubID = header.isSetField(targetSubID);
00295         <font class="keywordflow">if</font>(hasSenderSubID) header.getField(senderSubID);
00296         <font class="keywordflow">if</font>(hasTargetSubID) header.getField(targetSubID);
00297 
00298         header.getField(beginString);
00299         header.getField(msgType);
00300 
00301         header.clear();
00302 
00303         header.setField(beginString);
00304         header.setField(msgType);
00305         <font class="keywordflow">if</font>(hasSenderSubID) header.setField(senderSubID);
00306         <font class="keywordflow">if</font>(hasTargetSubID) header.setField(targetSubID);
00307         <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(message);
00308       } <font class="keywordflow">catch</font>(FieldNotFound&amp;) { <font class="keywordflow">return</font> <font class="keyword">false</font>; }
00309   }
00310 
<a name="l00311"></a><a class="code" href="class_f_i_x_1_1_session.html#c3">00311</a>   <font class="keywordtype">bool</font> Session::sendRaw( Message&amp; message, <font class="keywordtype">int</font> msgSeqNum )
00312   {
00313     <font class="keywordtype">bool</font> result = <font class="keyword">false</font>;
00314     <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; header = message.getHeader();
00315     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00316     header.getField(msgType);
00317 
00318     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>(header);
00319 
00320     <font class="keywordflow">if</font>(msgSeqNum)
00321       header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(msgSeqNum));
00322 
00323     <font class="keywordflow">if</font>(Message::isAdminMsgType(msgType))
00324     {
00325       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.toAdmin(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00326       <font class="keywordflow">if</font>(
00327           msgType == <font class="stringliteral">"A"</font> || msgType == <font class="stringliteral">"5"</font> 
00328           || msgType == <font class="stringliteral">"2"</font> || msgType == <font class="stringliteral">"4"</font>
00329           || <a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()
00330         )
00331         result = <a class="code" href="class_f_i_x_1_1_session.html#a12">send</a>(message.getString());
00332     }
00333     <font class="keywordflow">else</font>
00334     {
00335       <font class="keywordflow">try</font>
00336       {
00337         <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.toApp(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00338         <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a5">isLoggedOn</a>()) result = <a class="code" href="class_f_i_x_1_1_session.html#a12">send</a>(message.getString());
00339       }
00340       <font class="keywordflow">catch</font>(DoNotSend&amp;) {}
00341     }
00342 
00343     <font class="keywordflow">if</font>(!msgSeqNum)
00344     {
00345       <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;set(message);
00346       <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextSenderMsgSeqNum();
00347     }
00348     <font class="keywordflow">return</font> result;
00349   }
00350 
<a name="l00351"></a><a class="code" href="class_f_i_x_1_1_session.html#a15">00351</a>   <font class="keywordtype">void</font> Session::disconnect()
00352   {
00353     <font class="keywordflow">if</font>(m_pResponder)
00354       {
00355         <a class="code" href="class_f_i_x_1_1_session.html#o1">m_pResponder</a>-&gt;<a class="code" href="class_f_i_x_1_1_session_1_1_responder.html#a2">disconnect</a>();
00356         <a class="code" href="class_f_i_x_1_1_session.html#o1">m_pResponder</a> = 0;
00357       }
00358 
00359     <font class="keywordflow">if</font>(<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() || <a class="code" href="class_f_i_x_1_1_session.html#a2">sentLogon</a>())
00360     {
00361       <a class="code" href="class_f_i_x_1_1_session.html#o7">m_receivedLogon</a> = <font class="keyword">false</font>;
00362       <a class="code" href="class_f_i_x_1_1_session.html#o9">m_sentLogon</a> = <font class="keyword">false</font>;
00363       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.onLogout(<a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00364     }
00365 
00366     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogout</a> = <font class="keyword">false</font>;
00367     <a class="code" href="class_f_i_x_1_1_session.html#o16">m_queue</a>.clear();
00368   }
00369 
<a name="l00370"></a><a class="code" href="class_f_i_x_1_1_session.html#c4">00370</a>   <font class="keywordtype">void</font> Session::resend( Message&amp; message )
00371   {
00372     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00373     <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; header = message.getHeader();
00374     header.getField(sendingTime);
00375 
00376     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>(sendingTime));
00377     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a>());
00378     header.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00379 
00380     <font class="keywordflow">try</font>
00381     {
00382       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.toApp(message, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00383       <a class="code" href="class_f_i_x_1_1_session.html#a12">send</a>(message.getString());
00384     }
00385     <font class="keywordflow">catch</font>(DoNotSend&amp;)
00386     {
00387       <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00388       header.getField(msgSeqNum);
00389 
00390       Message sequenceReset;
00391       <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( sequenceReset.getHeader() );
00392       sequenceReset.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"4"</font>));
00393       sequenceReset.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00394       sequenceReset.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a>(sendingTime));
00395       sequenceReset.getHeader().setField(msgSeqNum);
00396       sequenceReset.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a>(msgSeqNum+1));
00397       sequenceReset.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a>(<font class="keyword">true</font>));
00398       <a class="code" href="class_f_i_x_1_1_session.html#a12">send</a>(sequenceReset.getString());
00399     }
00400   }
00401 
<a name="l00402"></a><a class="code" href="class_f_i_x_1_1_session.html#c25">00402</a>   <font class="keywordtype">void</font> Session::generateLogon()
00403   {
00404     Message logon;
00405     logon.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"A"</font>));
00406     logon.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a>(0));
00407     logon.setField(<a class="code" href="class_f_i_x_1_1_session.html#o3">m_heartBtInt</a>);
00408     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logon.getHeader() );
00409     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logon);
00410     <a class="code" href="class_f_i_x_1_1_session.html#o9">m_sentLogon</a> = <font class="keyword">true</font>;
00411   }
00412 
<a name="l00413"></a><a class="code" href="class_f_i_x_1_1_session.html#c26">00413</a>   <font class="keywordtype">void</font> Session::generateLogon( <font class="keyword">const</font> Message&amp; aLogon )
00414   {
00415     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a102">EncryptMethod</a> encryptMethod;
00416     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a111">HeartBtInt</a> heartBtInt;
00417     aLogon.getField(encryptMethod);
00418     aLogon.getField(heartBtInt);
00419 
00420     Message logon;
00421     logon.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"A"</font>));
00422     logon.setField(encryptMethod);
00423     logon.setField(heartBtInt);
00424     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logon.getHeader() );
00425     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logon);
00426     <a class="code" href="class_f_i_x_1_1_session.html#o9">m_sentLogon</a> = <font class="keyword">true</font>;
00427   }
00428 
<a name="l00429"></a><a class="code" href="class_f_i_x_1_1_session.html#c27">00429</a>   <font class="keywordtype">void</font> Session::generateResendRequest( <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>&amp; msgSeqNum )
00430   {
00431     Message resendRequest;
00432     resendRequest.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"2"</font>));
00433     resendRequest.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a11">BeginSeqNo</a>((<font class="keywordtype">int</font>)<a class="code" href="class_f_i_x_1_1_session.html#a8">getExpectedTargetNum</a>()));
00434     resendRequest.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a20">EndSeqNo</a>(msgSeqNum - 1));
00435     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( resendRequest.getHeader() );
00436     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(resendRequest);
00437   }
00438 
00439   <font class="keywordtype">void</font> Session::generateSequenceReset
<a name="l00440"></a><a class="code" href="class_f_i_x_1_1_session.html#c28">00440</a>   ( <font class="keywordtype">int</font> beginSeqNo, <font class="keywordtype">int</font> endSeqNo )
00441   {
00442     Message sequenceReset;
00443     sequenceReset.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"4"</font>));
00444     sequenceReset.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a>(<font class="keyword">true</font>));
00445     sequenceReset.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a40">NewSeqNo</a>(endSeqNo));
00446     fill( sequenceReset.getHeader() );
00447     sequenceReset.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(beginSeqNo));
00448     sequenceReset.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a126">GapFillFlag</a>(<font class="keyword">true</font>));
00449     sendRaw(sequenceReset, beginSeqNo);
00450   }
00451 
<a name="l00452"></a><a class="code" href="class_f_i_x_1_1_session.html#c29">00452</a>   <font class="keywordtype">void</font> Session::generateHeartbeat()
00453   {
00454     Message heartbeat;
00455     heartbeat.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"0"</font>));
00456     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( heartbeat.getHeader() );
00457     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(heartbeat);
00458   }
00459 
<a name="l00460"></a><a class="code" href="class_f_i_x_1_1_session.html#c30">00460</a>   <font class="keywordtype">void</font> Session::generateHeartbeat( <font class="keyword">const</font> Message&amp; testRequest )
00461   {
00462     Message heartbeat;
00463     heartbeat.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"0"</font>));
00464     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( heartbeat.getHeader() );
00465     <font class="keywordflow">try</font>
00466       {
00467         <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a115">TestReqID</a> testReqID;
00468         testRequest.getField(testReqID);
00469         heartbeat.setField(testReqID);
00470       }
00471     <font class="keywordflow">catch</font>( FieldNotFound&amp; ) {}
00472 
00473     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(heartbeat);
00474   }
00475 
<a name="l00476"></a><a class="code" href="class_f_i_x_1_1_session.html#c31">00476</a>   <font class="keywordtype">void</font> Session::generateTestRequest()
00477   {
00478     Message testRequest;
00479     testRequest.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"1"</font>));
00480     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( testRequest.getHeader() );
00481     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a115">TestReqID</a> testReqID(<font class="stringliteral">"TEST"</font>);
00482     testRequest.setField(testReqID);
00483 
00484     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(testRequest);
00485   }
00486 
<a name="l00487"></a><a class="code" href="class_f_i_x_1_1_session.html#c32">00487</a>   <font class="keywordtype">void</font> Session::generateReject( <font class="keyword">const</font> Message&amp; message, <font class="keywordtype">int</font> err, <font class="keywordtype">int</font> field )
00488   {
00489     Message reject;
00490     reject.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"3"</font>));
00491     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.getHeader() );
00492     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00493     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00494     message.getHeader().getField(msgType);
00495     message.getHeader().getField(msgSeqNum);
00496     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00497     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00498     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a336">SessionRejectReason</a>(err));
00499     <font class="keywordflow">if</font>( msgType != <font class="stringliteral">"A"</font> &amp;&amp; msgType != <font class="stringliteral">"4"</font>)
00500       <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00501 
00502     <font class="keywordflow">switch</font>( err )
00503       {
00504       <font class="keywordflow">case</font> 0:
00505         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00506         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Invalid tag number"</font>)); <font class="keywordflow">break</font>;
00507       <font class="keywordflow">case</font> 1:
00508         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00509         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Required tag missing"</font>)); <font class="keywordflow">break</font>;
00510       <font class="keywordflow">case</font> 2:
00511         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00512         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Tag not defined for this message type"</font>));
00513         <font class="keywordflow">break</font>;
00514       <font class="keywordflow">case</font> 4:
00515         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00516         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Tag specified without a value"</font>)); <font class="keywordflow">break</font>;
00517       <font class="keywordflow">case</font> 5:
00518         <font class="keywordflow">if</font>(field) reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00519         reject.setField
00520           (<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Value is incorrect (out of range) for this tag"</font>));
00521         <font class="keywordflow">break</font>;
00522       <font class="keywordflow">case</font> 6:
00523         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a334">RefTagID</a>(field));
00524         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Incorrect data format for value"</font>)); <font class="keywordflow">break</font>;
00525       <font class="keywordflow">case</font> 9:
00526         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"CompID problem"</font>)); <font class="keywordflow">break</font>;
00527       <font class="keywordflow">case</font> 10:
00528         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"SendingTime accuracy problem"</font>)); <font class="keywordflow">break</font>;
00529       <font class="keywordflow">case</font> 11:
00530         reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Invalid MsgType"</font>)); <font class="keywordflow">break</font>;
00531       };
00532 
00533     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00534   }
00535 
<a name="l00536"></a><a class="code" href="class_f_i_x_1_1_session.html#c33">00536</a>   <font class="keywordtype">void</font> Session::generateReject( <font class="keyword">const</font> Message&amp; message, <font class="keyword">const</font> std::string&amp; str )
00537   {
00538     Message reject;
00539     reject.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"3"</font>));
00540     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.getHeader() );
00541     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00542     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00543     message.getHeader().getField(msgType);
00544     message.getHeader().getField(msgSeqNum);
00545     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00546     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00547 
00548     <font class="keywordflow">if</font>( msgType != <font class="stringliteral">"A"</font> &amp;&amp; msgType != <font class="stringliteral">"4"</font>)
00549       <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00550     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(str));
00551     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00552   }
00553 
<a name="l00554"></a><a class="code" href="class_f_i_x_1_1_session.html#c34">00554</a>   <font class="keywordtype">void</font> Session::generateBusinessReject( <font class="keyword">const</font> Message&amp; message, <font class="keywordtype">int</font> err )
00555   {
00556     Message reject;
00557     reject.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"j"</font>));
00558     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( reject.getHeader() );
00559     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00560     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00561     message.getHeader().getField(msgType);
00562     message.getHeader().getField(msgSeqNum);
00563     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a335">RefMsgType</a>(msgType));
00564     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a49">RefSeqNum</a>(msgSeqNum));
00565     reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a343">BusinessRejectReason</a>(err));
00566     <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00567 
00568     <font class="keywordflow">if</font>( err == 3 )
00569       reject.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(<font class="stringliteral">"Unsupported Message Type"</font>));
00570     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(reject);
00571   }
00572 
<a name="l00573"></a><a class="code" href="class_f_i_x_1_1_session.html#c35">00573</a>   <font class="keywordtype">void</font> Session::generateLogout( <font class="keyword">const</font> std::string&amp; text )
00574   {
00575     Message logout;
00576     logout.getHeader().setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a>(<font class="stringliteral">"5"</font>));
00577     <a class="code" href="class_f_i_x_1_1_session.html#c5">fill</a>( logout.getHeader() );
00578     <font class="keywordflow">if</font>(text.length())
00579       logout.setField(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a61">Text</a>(text));
00580     <a class="code" href="class_f_i_x_1_1_session.html#c3">sendRaw</a>(logout);
00581     <a class="code" href="class_f_i_x_1_1_session.html#o8">m_sentLogout</a> = <font class="keyword">true</font>;
00582   }
00583 
<a name="l00584"></a><a class="code" href="class_f_i_x_1_1_session.html#c36">00584</a>   <font class="keywordtype">bool</font> Session::verify( <font class="keyword">const</font> Message&amp; msg, <font class="keywordtype">bool</font> checkTooHigh, <font class="keywordtype">bool</font> checkTooLow )
00585   {
00586     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00587     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00588     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00589     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00590     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00591 
00592     <font class="keywordflow">try</font>
00593       {
00594         <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; header = msg.getHeader();
00595         header.getField(senderCompID);
00596         header.getField(targetCompID);
00597         header.getField(sendingTime);
00598         header.getField(msgType);
00599         header.getField(msgSeqNum);
00600 
00601         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c11">validLogonState</a>(msgType) )
00602           <font class="keywordflow">throw</font> std::exception();
00603         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c6">isGoodTime</a>(sendingTime) )
00604           <a class="code" href="class_f_i_x_1_1_session.html#c12">doBadTime</a>(msg);
00605         <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#c10">isCorrectCompID</a>(senderCompID, targetCompID) )
00606           <a class="code" href="class_f_i_x_1_1_session.html#c13">doBadCompID</a>(msg);
00607 
00608         <font class="keywordflow">if</font>( checkTooHigh &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#c8">isTargetTooHigh</a>(msgSeqNum) )
00609           {
00610             <a class="code" href="class_f_i_x_1_1_session.html#c16">doTargetTooHigh</a>(msg);
00611             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00612           }
00613         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( checkTooLow &amp;&amp; <a class="code" href="class_f_i_x_1_1_session.html#c9">isTargetTooLow</a>(msgSeqNum) )
00614           {
00615             <a class="code" href="class_f_i_x_1_1_session.html#c15">doTargetTooLow</a>(msg);
00616             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00617           }
00618 
00619         <a class="code" href="class_f_i_x_1_1_session.html#o12">m_lastReceivedTime</a>.setCurrent();
00620       }
00621     <font class="keywordflow">catch</font>( std::exception&amp; )
00622       { <a class="code" href="class_f_i_x_1_1_session.html#a15">disconnect</a>(); <font class="keywordflow">return</font> <font class="keyword">false</font>; }
00623 
00624     <font class="keywordflow">if</font>(Message::isAdminMsgType(msgType))
00625       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.fromAdmin(msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00626     <font class="keywordflow">else</font>
00627       <a class="code" href="class_f_i_x_1_1_session.html#o0">m_application</a>.fromApp(msg, <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>);
00628 
00629     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00630   }
00631 
<a name="l00632"></a><a class="code" href="class_f_i_x_1_1_session.html#c12">00632</a>   <font class="keywordtype">void</font> Session::doBadTime(<font class="keyword">const</font> Message&amp; msg)
00633   {
00634     <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(msg, 10);
00635     <a class="code" href="class_f_i_x_1_1_session.html#c35">generateLogout</a>();
00636   }
00637 
<a name="l00638"></a><a class="code" href="class_f_i_x_1_1_session.html#c13">00638</a>   <font class="keywordtype">void</font> Session::doBadCompID(<font class="keyword">const</font> Message&amp; msg)
00639   {
00640     <font class="keywordflow">if</font>( !<a class="code" href="class_f_i_x_1_1_session.html#a4">receivedLogon</a>() )
00641       <font class="keywordflow">throw</font> std::exception();
00642     <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(msg, 9);
00643     <a class="code" href="class_f_i_x_1_1_session.html#c35">generateLogout</a>();
00644   }
00645 
<a name="l00646"></a><a class="code" href="class_f_i_x_1_1_session.html#c14">00646</a>   <font class="keywordtype">bool</font> Session::doPossDup(<font class="keyword">const</font> Message&amp; msg)
00647   {
00648     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; header = msg.getHeader();
00649     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a125">OrigSendingTime</a> origSendingTime;
00650     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a55">SendingTime</a> sendingTime;
00651 
00652     <font class="keywordflow">if</font>(!header.isSetField(origSendingTime))
00653       {
00654         <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(msg, 1, origSendingTime.getField());
00655         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00656       }
00657     header.getField(origSendingTime);
00658     header.getField(sendingTime);
00659 
00660     <font class="keywordflow">if</font>(origSendingTime &gt; sendingTime)
00661       {
00662         <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(msg, 10);
00663         <a class="code" href="class_f_i_x_1_1_session.html#c35">generateLogout</a>();
00664         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00665       }
00666     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00667   }
00668 
<a name="l00669"></a><a class="code" href="class_f_i_x_1_1_session.html#c15">00669</a>   <font class="keywordtype">bool</font> Session::doTargetTooLow(<font class="keyword">const</font> Message&amp; msg)
00670   {
00671     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; header = msg.getHeader();
00672     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a47">PossDupFlag</a> possDupFlag;
00673     header.getField(possDupFlag);
00674 
00675     <font class="keywordflow">if</font>(!possDupFlag) <font class="keywordflow">throw</font> std::exception();
00676     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#c14">doPossDup</a>(msg);
00677   }
00678 
<a name="l00679"></a><a class="code" href="class_f_i_x_1_1_session.html#c16">00679</a>   <font class="keywordtype">void</font> Session::doTargetTooHigh(<font class="keyword">const</font> Message&amp; msg)
00680   {
00681     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x.html#a53">Header</a>&amp; header = msg.getHeader();
00682     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a> msgSeqNum;
00683     header.getField(msgSeqNum);
00684 
00685     <a class="code" href="class_f_i_x_1_1_session.html#c0">queue</a>(msgSeqNum, msg);
00686     <a class="code" href="class_f_i_x_1_1_session.html#c27">generateResendRequest</a>(msgSeqNum);
00687   }
00688 
<a name="l00689"></a><a class="code" href="class_f_i_x_1_1_session.html#c17">00689</a>   <font class="keywordtype">void</font> Session::nextQueued()
00690   {
00691     Message msg;
00692     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00693 
00694     <font class="keywordflow">while</font>(<a class="code" href="class_f_i_x_1_1_session.html#c1">retreive</a>(<a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a38">MsgSeqNum</a>(<a class="code" href="class_f_i_x_1_1_session.html#a8">getExpectedTargetNum</a>()), msg))
00695       {
00696         msg.getHeader().getField(msgType);
00697         <font class="keywordflow">if</font>(msgType != <font class="stringliteral">"A"</font>)
00698           <a class="code" href="class_f_i_x_1_1_session.html#a13">next</a>(msg.getString());
00699       }
00700   }
00701 
<a name="l00702"></a><a class="code" href="class_f_i_x_1_1_session.html#a14">00702</a>   <font class="keywordtype">void</font> Session::next( <font class="keyword">const</font> Message&amp; message )
00703   {
00704     Locker locker(<a class="code" href="class_f_i_x_1_1_session.html#o17">m_mutex</a>);
00705 
00706     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c7">checkSessionTime</a>(<a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a10">UtcTimeStamp</a>()))
00707     { <a class="code" href="class_f_i_x_1_1_session.html#a6">reset</a>(); <font class="keywordflow">return</font>; }
00708 
00709     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a39">MsgType</a> msgType;
00710     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a12">BeginString</a> beginString;
00711     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a> senderCompID;
00712     <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a> targetCompID;
00713 
00714     <font class="keywordflow">try</font>
00715       {
00716         message.getHeader().getField(msgType);
00717         message.getHeader().getField(beginString);
00718         message.getHeader().getField(senderCompID);
00719         message.getHeader().getField(targetCompID);
00720 
00721         <font class="keywordflow">if</font>(beginString != <a class="code" href="class_f_i_x_1_1_session.html#o2">m_sessionID</a>.getBeginString())
00722           <font class="keywordflow">throw</font> UnsupportedVersion();
00723 
00724         <a class="code" href="class_f_i_x_1_1_session.html#o13">m_validator</a>.validate(message);
00725 
00726         <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"A"</font> )
00727           <a class="code" href="class_f_i_x_1_1_session.html#c18">nextLogon</a>(message);
00728         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"0"</font> )
00729           <a class="code" href="class_f_i_x_1_1_session.html#c19">nextHeartbeat</a>(message);
00730         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"1"</font> )
00731           <a class="code" href="class_f_i_x_1_1_session.html#c20">nextTestRequest</a>(message);
00732         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"4"</font> )
00733           <a class="code" href="class_f_i_x_1_1_session.html#c23">nextSequenceReset</a>(message);
00734         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"5"</font> )
00735           <a class="code" href="class_f_i_x_1_1_session.html#c21">nextLogout</a>(message);
00736         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"2"</font> )
00737           <a class="code" href="class_f_i_x_1_1_session.html#c24">nextResendRequest</a>(message);
00738         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"3"</font> )
00739           <a class="code" href="class_f_i_x_1_1_session.html#c22">nextReject</a>(message);
00740         <font class="keywordflow">else</font>
00741           {
00742             <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#c36">verify</a>(message)) <font class="keywordflow">return</font>;
00743             <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00744           }
00745         <a class="code" href="class_f_i_x_1_1_session.html#c17">nextQueued</a>();
00746       }
00747     <font class="keywordflow">catch</font>( MessageParseError&amp; ) {}
00748     <font class="keywordflow">catch</font>( RequiredTagMissing&amp; e )
00749       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, 1, e.field); }
00750     <font class="keywordflow">catch</font>( FieldNotFound&amp; e )
00751       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, 1, e.field); 
00752         <font class="keywordflow">if</font>(msgType == <font class="stringliteral">"A"</font>) <a class="code" href="class_f_i_x_1_1_session.html#a15">disconnect</a>();
00753       }
00754     <font class="keywordflow">catch</font>( InvalidTagNumber&amp; e )
00755       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, 0, e.field); }
00756     <font class="keywordflow">catch</font>( NoTagValue&amp; e )
00757       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, 4, e.field); }
00758     <font class="keywordflow">catch</font>( TagNotDefinedForMessage&amp; e)
00759       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, 2, e.field); }
00760     <font class="keywordflow">catch</font>( InvalidMessageType&amp; )
00761       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, 11); }
00762     <font class="keywordflow">catch</font>( UnsupportedMessageType&amp; )
00763       { <a class="code" href="class_f_i_x_1_1_session.html#c34">generateBusinessReject</a>(message, 3); }
00764     <font class="keywordflow">catch</font>( FieldsOutOfOrder&amp; e )
00765       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, e.what()); }
00766     <font class="keywordflow">catch</font>( IncorrectDataFormat&amp; e )
00767       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, 6, e.field); }
00768     <font class="keywordflow">catch</font>( IncorrectTagValue&amp; e )
00769       { <a class="code" href="class_f_i_x_1_1_session.html#c32">generateReject</a>(message, 5, e.field); }
00770     <font class="keywordflow">catch</font>( InvalidMessage&amp; ) {}
00771     <font class="keywordflow">catch</font>( RejectLogon&amp; ) { <a class="code" href="class_f_i_x_1_1_session.html#a15">disconnect</a>(); }
00772     <font class="keywordflow">catch</font>( UnsupportedVersion&amp; )
00773       {
00774         <font class="keywordflow">if</font>( msgType == <font class="stringliteral">"5"</font> )
00775           <a class="code" href="class_f_i_x_1_1_session.html#c21">nextLogout</a>(message);
00776         <font class="keywordflow">else</font>
00777           {
00778             <a class="code" href="class_f_i_x_1_1_session.html#c35">generateLogout</a>(<font class="stringliteral">"Incorrect BeginString"</font>);
00779             <a class="code" href="class_f_i_x_1_1_session.html#o15">m_pStore</a>-&gt;incrNextTargetMsgSeqNum();
00780           }
00781       }
00782   }
00783 
<a name="l00784"></a><a class="code" href="class_f_i_x_1_1_session.html#d0">00784</a>   <font class="keywordtype">bool</font> Session::sendToTarget( Message&amp; message )
00785     <font class="keywordflow">throw</font>(SessionNotFound&amp;)
00786   {
00787     Locker locker(s_mutex);
00788     <font class="keywordflow">try</font>
00789       {
00790         SessionID sessionID = message.getSessionID();
00791         Session* pSession = lookupSession(sessionID);
00792         <font class="keywordflow">if</font>( !pSession ) <font class="keywordflow">throw</font> SessionNotFound();
00793         <font class="keywordtype">bool</font> result = pSession-&gt;send(message);
00794         <font class="keywordflow">return</font> result;
00795       }
00796     <font class="keywordflow">catch</font>( FieldNotFound&amp; ) { <font class="keywordflow">throw</font> SessionNotFound(); }
00797   }
00798 
<a name="l00799"></a><a class="code" href="class_f_i_x_1_1_session.html#d1">00799</a>   <font class="keywordtype">bool</font> Session::sendToTarget( Message&amp; message, <font class="keyword">const</font> SessionID&amp; sessionID )
00800     <font class="keywordflow">throw</font>(SessionNotFound&amp;)
00801   {
00802     message.setSessionID(sessionID);
00803     <font class="keywordflow">return</font> sendToTarget(message);
00804   }
00805 
00806   <font class="keywordtype">bool</font> Session::sendToTarget
<a name="l00807"></a><a class="code" href="class_f_i_x_1_1_session.html#d2">00807</a>   ( Message&amp; message, <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a53">SenderCompID</a>&amp; senderCompID, 
00808     <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_f_i_e_l_d.html#a413a59">TargetCompID</a>&amp; targetCompID )
00809     <font class="keywordflow">throw</font>(SessionNotFound&amp;)
00810   {
00811     message.getHeader().setField(senderCompID);
00812     message.getHeader().setField(targetCompID);
00813     <font class="keywordflow">return</font> sendToTarget(message);
00814   }
00815 
<a name="l00816"></a><a class="code" href="class_f_i_x_1_1_session.html#d3">00816</a>   <font class="keywordtype">bool</font> Session::doesSessionExist( <font class="keyword">const</font> SessionID&amp; sessionID )
00817   {
00818     Locker locker(<a class="code" href="class_f_i_x_1_1_session.html#r1">s_mutex</a>);
00819     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() != <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( sessionID );
00820   }
00821 
<a name="l00822"></a><a class="code" href="class_f_i_x_1_1_session.html#d4">00822</a>   Session* Session::lookupSession( <font class="keyword">const</font> SessionID&amp; sessionID )
00823   {
00824     Locker locker(<a class="code" href="class_f_i_x_1_1_session.html#r1">s_mutex</a>);
00825     Sessions::iterator find = <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( sessionID );
00826     <font class="keywordflow">if</font>( find != <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end() )
00827       <font class="keywordflow">return</font> find-&gt;second;
00828     <font class="keywordflow">else</font>
00829       <font class="keywordflow">return</font> 0;
00830   }
00831 
<a name="l00832"></a><a class="code" href="class_f_i_x_1_1_session.html#d5">00832</a>   <font class="keywordtype">int</font> Session::numSessions()
00833   {
00834     Locker locker(<a class="code" href="class_f_i_x_1_1_session.html#r1">s_mutex</a>);
00835     <font class="keywordflow">return</font> <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.size();
00836   }
00837 
<a name="l00838"></a><a class="code" href="class_f_i_x_1_1_session.html#f0">00838</a>   <font class="keywordtype">bool</font> Session::addSession( Session&amp; s )
00839   {
00840     Locker locker(<a class="code" href="class_f_i_x_1_1_session.html#r1">s_mutex</a>);
00841     Sessions::iterator it = <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.find( s.m_sessionID );
00842     <font class="keywordflow">if</font> (it == <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.end())
00843       {
00844         <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>[s.m_sessionID] = &amp;s;
00845         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00846       }
00847     <font class="keywordflow">else</font>
00848       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00849   }
00850 
<a name="l00851"></a><a class="code" href="class_f_i_x_1_1_session.html#f1">00851</a>   <font class="keywordtype">void</font> Session::removeSession( Session&amp; s )
00852   {
00853     Locker locker(<a class="code" href="class_f_i_x_1_1_session.html#r1">s_mutex</a>);
00854     <a class="code" href="class_f_i_x_1_1_session.html#r0">s_sessions</a>.erase( s.m_sessionID );
00855   }
00856 
<a name="l00857"></a><a class="code" href="class_f_i_x_1_1_session.html#d6">00857</a>   <font class="keywordtype">bool</font> Session::isSessionTime(<font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a19">UtcTimeOnly</a>&amp; start, <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a19">UtcTimeOnly</a>&amp; end,
00858                               <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a10">UtcTimeStamp</a>&amp; time )
00859   {
00860     <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a19">UtcTimeOnly</a> timeOnly(time);
00861 
00862     <font class="keywordflow">if</font>(start &lt; end)
00863       <font class="keywordflow">return</font>( timeOnly &gt;= start &amp;&amp; timeOnly &lt;= end );
00864     <font class="keywordflow">else</font>
00865       <font class="keywordflow">return</font>( timeOnly &gt;= start || timeOnly &lt;= end );
00866   }
00867 
<a name="l00868"></a><a class="code" href="class_f_i_x_1_1_session.html#d7">00868</a>   <font class="keywordtype">bool</font> Session::isSameSession(<font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a19">UtcTimeOnly</a>&amp; start, <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a19">UtcTimeOnly</a>&amp; end,
00869                               <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a10">UtcTimeStamp</a>&amp; time1, <font class="keyword">const</font> <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a10">UtcTimeStamp</a>&amp; time2 )
00870   {
00871     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#a11">isSessionTime</a>(start, end, time1)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00872     <font class="keywordflow">if</font>(!<a class="code" href="class_f_i_x_1_1_session.html#a11">isSessionTime</a>(start, end, time2)) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00873 
00874     <font class="keywordflow">if</font>(time1 == time2) <font class="keywordflow">return</font> <font class="keyword">true</font>;
00875 
00876     <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a18">UtcDate</a> time1Date(time1);
00877     <a class="code" href="namespace_f_i_x_1_1_t_y_p_e.html#a20a18">UtcDate</a> time2Date(time2);
00878 
00879     <font class="keywordflow">if</font>(start &lt; end)
00880       <font class="keywordflow">return</font> time1Date == time2Date;
00881     <font class="keywordflow">else</font>
00882       <font class="keywordflow">return</font> abs(time1Date - time2Date) &lt;= 1;
00883       
00884     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00885   }
00886 
<a name="l00887"></a><a class="code" href="class_f_i_x_1_1_session.html#c0">00887</a>   <font class="keywordtype">void</font> Session::queue( <font class="keywordtype">int</font> msgSeqNum, <font class="keyword">const</font> Message&amp; message )
00888   {
00889     <a class="code" href="class_f_i_x_1_1_session.html#o16">m_queue</a>[msgSeqNum] = message;
00890   }
00891 
<a name="l00892"></a><a class="code" href="class_f_i_x_1_1_session.html#c1">00892</a>   <font class="keywordtype">bool</font> Session::retreive( <font class="keywordtype">int</font> msgSeqNum, Message&amp; message )
00893   {
00894     Messages::iterator i = <a class="code" href="class_f_i_x_1_1_session.html#o16">m_queue</a>.find(msgSeqNum);
00895     <font class="keywordflow">if</font>( i != <a class="code" href="class_f_i_x_1_1_session.html#o16">m_queue</a>.end() )
00896       {
00897         message = i-&gt;second;
00898         <a class="code" href="class_f_i_x_1_1_session.html#o16">m_queue</a>.erase(i);
00899         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00900       }
00901     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00902   }
00903 }
</pre></div><hr><address><small>
Generated on Fri Mar 29 15:45:34 2002 for QuickFIX by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.2.12 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
