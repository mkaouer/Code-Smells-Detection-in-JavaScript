<target name="prepare">
  <mkdir dir="${buildsrc}"/>
  <mkdir dir="${classes}"/>
</target>

<target name="copy-src" depends="prepare">
  <copy todir="${buildsrc}">
    <fileset dir="${source}">
      <include name="**/*.java" />
    </fileset>
  </copy>
</target>

<target name="copy-src2master" depends="copy-src,generate">
  <copy todir="${masterbuild.build}/src">
    <fileset dir="${buildsrc}">
      <include name="**/*.java" />
    </fileset>
  </copy>
</target>

<target name="clean" description="Remove build directories">
  <delete dir="${build}"/>
</target>

<target name="xdoclet-uptodate" depends="copy-src">
  <uptodate property="xdoclet-generate">
    <srcfiles dir="${buildsrc}" includesfile="${mbeans}"/>
    <mapper type="glob" from="*.java" to="*MBean.java"/>
  </uptodate>
</target>

<target name="generate" depends="xdoclet-uptodate" unless="xdoclet-generate">
  <taskdef name="jmxdoclet" classname="xdoclet.modules.jmx.JMXDocletTask">
    <classpath refid="xdoclet.classpath"/>
  </taskdef>

  <jmxdoclet destdir="${buildsrc}" force="yes" verbose="false">
    <fileset dir="${buildsrc}" includesfile="${mbeans}"/>
    <mbeaninterface/>
    <!-- mx4jdescription/ -->
  </jmxdoclet>
</target>

<target name="compile" depends="copy-src,generate">
  <javac srcdir="${buildsrc}" destdir="${classes}"
    debug="${debug}" deprecation="${deprecation}">
      <classpath refid="lib.classpath" />
  </javac>
</target>

<target name="jar" depends="copy-src,generate,compile">
    <delete file="${build}/${project}.jar" />
    <copy file="MANIFEST.MF" tofile="${classes}/MANIFEST.MF" />
    <replace file="${classes}/MANIFEST.MF" 
             token="$$VERSION$$" value="${version}"/>
    <copy file="LICENSE" tofile="${classes}/LICENSE" />
    <copy file="README"  tofile="${classes}/README" />
    <copy file="ChangeLog" tofile="${classes}/ChangeLog" />

    <jar jarfile="${masterdist}/${project}.jar" 
         basedir="${classes}"
         manifest="${classes}/MANIFEST.MF" 
	 includes="LICENSE,README,ChangeLog,org/**,com/**" />
</target>

